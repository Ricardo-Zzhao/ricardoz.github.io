<!doctype html><html lang=zh-cn dir=content/zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=content-security-policy content="upgrade-insecure-requests"><title>以太坊开发8-Truffle框架安装使用 - 书藏的博客</title><meta name=keywords content="博客,程序员,区块链，思考,读书,笔记,生活,电影,旅游,"><meta name=author content="书藏"><meta property="og:title" content="以太坊开发8-Truffle框架安装使用"><meta property="og:site_name" content="书藏的博客"><meta property="og:image" content="/img/avatar.png"><meta name=title content="以太坊开发8-Truffle框架安装使用 - 书藏的博客"><meta name=description content="书藏的个人博客，记录学习的东西，以月刊记录生活"><link rel="shortcut icon" href=/img/favicon.ico><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png><link href=//cdn.bootcdn.net/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css rel=stylesheet type=text/css><link href=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.css rel=stylesheet><link href=/css/main.css rel=stylesheet type=text/css><link href=/css/syntax.css rel=stylesheet type=text/css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-209130979-1"></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-209130979-1 ');</script></head><body itemscope itemtype=http://schema.org/WebPage lang=zh-hans><div class="container one-collumn sidebar-position-left page-home"><div class=headband></div><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle role=button style=opacity:1;top:0><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><div class=multi-lang-switch><i class="fa fa-fw fa-language" style=margin-right:5px></i><a class=lang-link id=zh-cn href=#>中文</a></div><div class=custom-logo-site-title><a href=/ class=brand rel=start><span class=logo-line-before><i></i></span><span class=site-title>书藏的博客</span>
<span class=logo-line-after><i></i></span></a></div><p class=site-subtitle>凡心所向，素履以往</p></div><div class=site-nav-right><div class="toggle popup-trigger" style=opacity:1;top:0><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul id=menu class=menu><li class=menu-item><a href=/ rel=section><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class=menu-item><a href=/post rel=section><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class=menu-item><a href=/about.html rel=section><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于我</a></li><li class=menu-item><a href=/404.html rel=section><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益404</a></li><li class="menu-item menu-item-search"><a href=javascript:; class=popup-trigger><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class=site-search><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class=search-icon><i class="fa fa-search"></i></span><span class=popup-btn-close><i class="fa fa-times-circle"></i></span><div class=local-search-input-wrapper><input autocomplete=off placeholder=搜索关键字... spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off></div></div><div id=local-search-result></div></div></div></nav></div></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><section id=posts class=posts-expand><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline"><a class=post-title-link href=https://shuzang.github.io/2019/11/use-truffle-develop-ethereum-project/ itemprop=url>以太坊开发8-Truffle框架安装使用</a></h1><div class=post-meta><span class=post-time><i class="fa fa-calendar-o fa-fw"></i><span class=post-meta-item-text>时间：</span>
<time itemprop=dateCreated datetime=2016-03-22T13:04:35+08:00 content="2019-11-06">2019-11-06</time></span>
<span class=post-category>&nbsp; | &nbsp;
<i class="fa fa-folder-o fa-fw"></i><span class=post-meta-item-text>分类：</span>
<span itemprop=about itemscope itemtype=https://schema.org/Thing><a href=/categories/%E7%A0%94%E7%A9%B6%E7%94%9F%E7%9A%84%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF itemprop=url rel=index style=text-decoration:underline><span itemprop=name>研究生的区块链学习之路</span></a>
&nbsp;</span></span>
<span>|
<i class="fa fa-file-word-o fa-fw"></i><span class=post-meta-item-text>字数：</span>
<span class=leancloud-world-count>2422 字</span></span>
<span>|
<i class="fa fa-eye fa-fw"></i><span class=post-meta-item-text>阅读：</span>
<span class=leancloud-view-count>5分钟</span></span>
<span id=/2019/11/use-truffle-develop-ethereum-project/ class=leancloud_visitors data-flag-title=以太坊开发8-Truffle框架安装使用>|
<i class="fa fa-binoculars fa-fw"></i><span class=post-meta-item-text>阅读次数：</span>
<span class=leancloud-visitors-count></span></span></div></header><div class=post-body itemprop=articleBody><p>Truffle和Ganache的安装使用</p><h3 id=1-安装truffle>1. 安装Truffle</h3><p>在Ubuntu18.04 下安装运行，要求Node.js版本高于v8.9.4</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo apt-get install npm
$ sudo npm install npm@latest -g
$ sudo npm install n -g
$ sudo n lts
</code></pre></div><p>安装Truffle</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo npm install -g truffle
</code></pre></div><h3 id=2-创建项目>2. 创建项目</h3><p>以<a href=https://www.trufflesuite.com/boxes>Truffle Boxes</a>中的<a href=https://www.trufflesuite.com/boxes/metacoin>MetaCoin</a>项目为例</p><p>首先为 Truffle 项目创建新目录</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ mkdir MetaCoin <span style=color:#666>&amp;&amp;</span> <span style=color:#a2f>cd</span> MetaCoin
</code></pre></div><p>下载MetaCoin box</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ truffle unbox metacoin

✔ Preparing to download
✔ Downloading
✔ Cleaning up temporary files
✔ Setting up box

Unbox successful. Sweet!

Commands:

  Compile contracts: truffle compile
  Migrate contracts: truffle migrate
  Test contracts:    truffle <span style=color:#a2f>test</span>
</code></pre></div><p>下载完成后的项目目录如下</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ tree
.
├── contracts
│   ├── ConvertLib.sol
│   ├── MetaCoin.sol
│   └── Migrations.sol
├── LICENSE
├── migrations
│   ├── 1_initial_migration.js
│   └── 2_deploy_contracts.js
├── <span style=color:#a2f>test</span>
│   ├── metacoin.js
│   └── TestMetaCoin.sol
└── truffle-config.js

<span style=color:#666>3</span> directories, <span style=color:#666>9</span> files
</code></pre></div><p><code>contracts</code>是solidity编写的合约存放的文件夹</p><ul><li><code>MetaCoin.sol</code>创建了一种简单的代币，它引用了<code>ConvertLib.sol</code>合约</li><li><code>Migrations.sol</code>是一个单独的合约文件，用来管理所部署合约的状态，每个Truffle项目中都有该文件，而且通常不需要更改</li></ul><p><code>migrations</code>是部署脚本存放的文件夹</p><ul><li><code>1_initial_migration.js</code>是<code>Migrations.sol</code>合约的迁移和部署脚本</li><li><code>2_deploy_contracts.js</code>是<code>MetaCoin.sol</code>合约的迁移和部署脚本</li><li>所有的脚本按文件名开头的序号按顺序执行</li></ul><p><code>test</code>是测试应用和合约的测试文件存放的目录</p><ul><li><code>TestMetaCoin.sol</code>是合约形式的测试文件</li><li><code>metacoin.js</code>是JS脚本形式的测试文件</li><li>两者的功能是一样的，只是使用了不同方式做测试</li></ul><p><code>truffle.js</code>是Truffle的配置文件，用于配置网络信息和其它项目相关的信息</p><h3 id=3-编译>3. 编译</h3><p>编译合约</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ truffle compile

Compiling your contracts...
<span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span>
&gt; Compiling ./contracts/ConvertLib.sol
&gt; Compiling ./contracts/MetaCoin.sol
&gt; Compiling ./contracts/Migrations.sol
&gt; Artifacts written to /home/shuzang/MetaCoin/build/contracts
&gt; Compiled successfully using:
   - solc: 0.5.8+commit.23d335f2.Emscripten.clang
</code></pre></div><h3 id=4-测试>4. 测试</h3><p>在终端中运行合约形式的测试文件</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ truffle <span style=color:#a2f>test</span> ./test/TestMetaCoin.sol

Compiling your contracts...
<span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span>
&gt; Compiling ./contracts/ConvertLib.sol
&gt; Compiling ./contracts/MetaCoin.sol
&gt; Compiling ./contracts/Migrations.sol
&gt; Compiling ./test/TestMetaCoin.sol



  TestMetaCoin
    ✓ testInitialBalanceUsingDeployedContract <span style=color:#666>(</span>83ms<span style=color:#666>)</span>
    ✓ testInitialBalanceWithNewMetaCoin <span style=color:#666>(</span>76ms<span style=color:#666>)</span>


  <span style=color:#666>2</span> passing <span style=color:#666>(</span>6s<span style=color:#666>)</span>
</code></pre></div><p>在终端中运行JS脚本形式的测试文件</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ truffle <span style=color:#a2f>test</span> ./test/metacoin.js

Compiling your contracts...
<span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span>
&gt; Compiling ./contracts/ConvertLib.sol
&gt; Compiling ./contracts/MetaCoin.sol
&gt; Compiling ./contracts/Migrations.sol



  Contract: MetaCoin
    ✓ should put <span style=color:#666>10000</span> MetaCoin in the first account
    ✓ should call a <span style=color:#a2f;font-weight:700>function</span> that depends on a linked library <span style=color:#666>(</span>60ms<span style=color:#666>)</span>
    ✓ should send coin correctly <span style=color:#666>(</span>154ms<span style=color:#666>)</span>


  <span style=color:#666>3</span> passing <span style=color:#666>(</span>271ms<span style=color:#666>)</span>
</code></pre></div><h3 id=5-与ganache关联使用>5. 与Ganache关联使用</h3><p>为了部署合约我们需要连到区块链，Truffle提供这方面的功能，但是目前我们使用Ganache来模拟区块链做部署测试</p><p>首先在<a href=https://github.com/trufflesuite/ganache/releases>Download</a>页面下载对应操作系统的Ganache软件包，Linux系统下该软件包点击即可启动，无需安装</p><p>然后编辑<code>truffle-config.js</code>文件，替换为如下内容，这些配置参数将允许Ganache以默认参数连接</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>module.exports <span style=color:#666>=</span> {
  networks<span style=color:#666>:</span> {
    development<span style=color:#666>:</span> {
      host<span style=color:#666>:</span> <span style=color:#b44>&#34;127.0.0.1&#34;</span>,
      port<span style=color:#666>:</span> <span style=color:#666>7545</span>,
      network_id<span style=color:#666>:</span> <span style=color:#b44>&#34;*&#34;</span>
    }
  }
};
</code></pre></div><p>保存并关闭文件，打开Ganache</p><p><img src=https://www.trufflesuite.com/img/docs/ganache/quickstart/accounts.png alt=Ganache></p><p>执行迁移命令，将合约部署到Ganache创建的区块链</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ truffle migrate

Compiling your contracts...
<span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span>
&gt; Everything is up to date, there is nothing to compile.



Starting migrations...
<span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span>
&gt; Network name:    <span style=color:#b44>&#39;development&#39;</span>
&gt; Network id:      <span style=color:#666>5777</span>
&gt; Block gas limit: 0x6691b7


1_initial_migration.js
<span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span>

   Deploying <span style=color:#b44>&#39;Migrations&#39;</span>
   ----------------------
   &gt; transaction hash:    0x58a9f65031802c841183fc99a46d647870a99de5a717e27791f7ea13e9ccd47c
   &gt; Blocks: <span style=color:#666>0</span>            Seconds: <span style=color:#666>0</span>
   &gt; contract address:    0x03A587F157700FBdDff5195F22Eeab32c030424e
   &gt; block number:        <span style=color:#666>1</span>
   &gt; block timestamp:     <span style=color:#666>1573040253</span>
   &gt; account:             0x6c9d11d64bDC226d3d143b228d1019cB187c962d
   &gt; balance:             99.99477214
   &gt; gas used:            <span style=color:#666>261393</span>
   &gt; gas price:           <span style=color:#666>20</span> gwei
   &gt; value sent:          <span style=color:#666>0</span> ETH
   &gt; total cost:          0.00522786 ETH


   &gt; Saving migration to chain.
   &gt; Saving artifacts
   -------------------------------------
   &gt; Total cost:          0.00522786 ETH


2_deploy_contracts.js
<span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span>

   Deploying <span style=color:#b44>&#39;ConvertLib&#39;</span>
   ----------------------
   &gt; transaction hash:    0x1685578d778d127196ce3b7d915b44e6433049f2a250e4384f836161cba8b75c
   &gt; Blocks: <span style=color:#666>0</span>            Seconds: <span style=color:#666>0</span>
   &gt; contract address:    0x741be30b7E4F5160026A0882f15763E623Fbcd66
   &gt; block number:        <span style=color:#666>3</span>
   &gt; block timestamp:     <span style=color:#666>1573040254</span>
   &gt; account:             0x6c9d11d64bDC226d3d143b228d1019cB187c962d
   &gt; balance:             99.99185922
   &gt; gas used:            <span style=color:#666>103623</span>
   &gt; gas price:           <span style=color:#666>20</span> gwei
   &gt; value sent:          <span style=color:#666>0</span> ETH
   &gt; total cost:          0.00207246 ETH


   Linking
   -------
   * Contract: MetaCoin &lt;--&gt; Library: ConvertLib <span style=color:#666>(</span>at address: 0x741be30b7E4F5160026A0882f15763E623Fbcd66<span style=color:#666>)</span>

   Deploying <span style=color:#b44>&#39;MetaCoin&#39;</span>
   --------------------
   &gt; transaction hash:    0x8800cc6fecf73a8d247fad63d5e739cccbd5e9f8dd350bbb709eb258396b96e4
   &gt; Blocks: <span style=color:#666>0</span>            Seconds: <span style=color:#666>0</span>
   &gt; contract address:    0xBfc5d417c17fc15E837aCA46063F6b5403ad469e
   &gt; block number:        <span style=color:#666>4</span>
   &gt; block timestamp:     <span style=color:#666>1573040254</span>
   &gt; account:             0x6c9d11d64bDC226d3d143b228d1019cB187c962d
   &gt; balance:             99.98509224
   &gt; gas used:            <span style=color:#666>338349</span>
   &gt; gas price:           <span style=color:#666>20</span> gwei
   &gt; value sent:          <span style=color:#666>0</span> ETH
   &gt; total cost:          0.00676698 ETH


   &gt; Saving migration to chain.
   &gt; Saving artifacts
   -------------------------------------
   &gt; Total cost:          0.00883944 ETH


<span style=color:#b8860b>Summary</span>
<span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span>
&gt; Total deployments:   <span style=color:#666>3</span>
&gt; Final cost:          0.0140673 ETH
</code></pre></div><p>输出记录中显示了交易ID，部署的合约地址，总花费，实时状态等诸多信息。</p><p>在Ganache中点击<code>Transactions</code>按钮可以看到执行的交易的详细信息。</p><p>之后，使用Truffle控制台还可以和合约交互</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ truffle console
truffle<span style=color:#666>(</span>development<span style=color:#666>)</span>&gt;
</code></pre></div><h3 id=6-与合约交互>6. 与合约交互</h3><p>truffle v5以后，控制台支持使用<code>async</code>或<code>await</code>函数，以下是一些合约交互的示例</p><p>首先部署合约并获取账户地址</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>truffle(development)<span style=color:#666>&gt;</span> <span style=color:#a2f;font-weight:700>let</span> instance <span style=color:#666>=</span> await MetaCoin.deployed()
truffle(development)<span style=color:#666>&gt;</span> <span style=color:#a2f;font-weight:700>let</span> accounts <span style=color:#666>=</span> await web3.eth.getAccounts()
</code></pre></div><p>检查部署合约的账户余额</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>truffle(development)<span style=color:#666>&gt;</span> <span style=color:#a2f;font-weight:700>let</span> balance <span style=color:#666>=</span> await instance.getBalance(accounts[<span style=color:#666>0</span>])
truffle(development)<span style=color:#666>&gt;</span> balance.toNumber()
<span style=color:#666>10000</span>
</code></pre></div><p>检查余额值多少ether，合约定义1单位余额值2ether</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>truffle(development)<span style=color:#666>&gt;</span> <span style=color:#a2f;font-weight:700>let</span> ether <span style=color:#666>=</span> await instance.getBalanceInEth(accounts[<span style=color:#666>0</span>])
truffle(development)<span style=color:#666>&gt;</span> ether.toNumber()
<span style=color:#666>20000</span>
</code></pre></div><p>向另一个账户发送货币</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>truffle(development)<span style=color:#666>&gt;</span> instance.sendCoin(accounts[<span style=color:#666>1</span>], <span style=color:#666>500</span>)
{ tx<span style=color:#666>:</span>
   <span style=color:#b44>&#39;0xf392891ee029f6bc6f970b9e5ae91cfd2e92baa4e141f0a94f6c6fbf5942c8a8&#39;</span>,
  receipt<span style=color:#666>:</span>
   { transactionHash<span style=color:#666>:</span>
      <span style=color:#b44>&#39;0xf392891ee029f6bc6f970b9e5ae91cfd2e92baa4e141f0a94f6c6fbf5942c8a8&#39;</span>,
     transactionIndex<span style=color:#666>:</span> <span style=color:#666>0</span>,
     blockHash<span style=color:#666>:</span>
      <span style=color:#b44>&#39;0x14d49b375d485ae98860383d3483174995f019f349e9fdf5fd1d669be35a4791&#39;</span>,
     blockNumber<span style=color:#666>:</span> <span style=color:#666>6</span>,
     from<span style=color:#666>:</span> <span style=color:#b44>&#39;0x6c9d11d64bdc226d3d143b228d1019cb187c962d&#39;</span>,
     to<span style=color:#666>:</span> <span style=color:#b44>&#39;0xbfc5d417c17fc15e837aca46063f6b5403ad469e&#39;</span>,
     gasUsed<span style=color:#666>:</span> <span style=color:#666>51072</span>,
     cumulativeGasUsed<span style=color:#666>:</span> <span style=color:#666>51072</span>,
     contractAddress<span style=color:#666>:</span> <span style=color:#a2f;font-weight:700>null</span>,
     logs<span style=color:#666>:</span> [ [<span style=color:#a2f>Object</span>] ],
     status<span style=color:#666>:</span> <span style=color:#a2f;font-weight:700>true</span>,
     logsBloom<span style=color:#666>:</span>
      <span style=color:#b44>&#39;0x00008000000000000000000000000000000000000000000400000000000000000400000010000000000000000000000000000000000002000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000010000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000800000000000&#39;</span>,
     v<span style=color:#666>:</span> <span style=color:#b44>&#39;0x1b&#39;</span>,
     r<span style=color:#666>:</span>
      <span style=color:#b44>&#39;0x6ad89e5e88194468c9d8f82891c7839b9c4d92ee01bd689ce080e35e99e74d1d&#39;</span>,
     s<span style=color:#666>:</span>
      <span style=color:#b44>&#39;0x77f2bc1452799a94cfaec2a9400f85393794ff96b285447a3407371b2d991978&#39;</span>,
     rawLogs<span style=color:#666>:</span> [ [<span style=color:#a2f>Object</span>] ] },
  logs<span style=color:#666>:</span>
   [ { logIndex<span style=color:#666>:</span> <span style=color:#666>0</span>,
       transactionIndex<span style=color:#666>:</span> <span style=color:#666>0</span>,
       transactionHash<span style=color:#666>:</span>
        <span style=color:#b44>&#39;0xf392891ee029f6bc6f970b9e5ae91cfd2e92baa4e141f0a94f6c6fbf5942c8a8&#39;</span>,
       blockHash<span style=color:#666>:</span>
        <span style=color:#b44>&#39;0x14d49b375d485ae98860383d3483174995f019f349e9fdf5fd1d669be35a4791&#39;</span>,
       blockNumber<span style=color:#666>:</span> <span style=color:#666>6</span>,
       address<span style=color:#666>:</span> <span style=color:#b44>&#39;0xBfc5d417c17fc15E837aCA46063F6b5403ad469e&#39;</span>,
       type<span style=color:#666>:</span> <span style=color:#b44>&#39;mined&#39;</span>,
       id<span style=color:#666>:</span> <span style=color:#b44>&#39;log_c14235e4&#39;</span>,
       event<span style=color:#666>:</span> <span style=color:#b44>&#39;Transfer&#39;</span>,
       args<span style=color:#666>:</span> [Result] } ] }
</code></pre></div><p>检查接收账户的余额</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>truffle(development)<span style=color:#666>&gt;</span> <span style=color:#a2f;font-weight:700>let</span> received <span style=color:#666>=</span> await instance.getBalance(accounts[<span style=color:#666>1</span>])
truffle(development)<span style=color:#666>&gt;</span> received.toNumber()
<span style=color:#666>500</span>
</code></pre></div><p>检查发送账户的余额</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>truffle(development)<span style=color:#666>&gt;</span> <span style=color:#a2f;font-weight:700>let</span> newBalance <span style=color:#666>=</span> await instance.getBalance(accounts[<span style=color:#666>0</span>])
truffle(development)<span style=color:#666>&gt;</span> newBalance.toNumber()
<span style=color:#666>9500</span>
</code></pre></div><h3 id=7-使用truffle-develop>7. 使用truffle develop</h3><p>之前部署合约使用了Ganache，也可以使用truffle develop。这一工具是Truffle内置的测试用私链，运行在本地。</p><p>运行truffle develop</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ truffle develop
Truffle Develop started at http://127.0.0.1:9545/

Accounts:
<span style=color:#666>(</span>0<span style=color:#666>)</span> 0xfc166345efd307d6c22bde2cc8f4e4e345c49495
<span style=color:#666>(</span>1<span style=color:#666>)</span> 0x7b06844a7accc66d34294557d98224c39c496c81
<span style=color:#666>(</span>2<span style=color:#666>)</span> 0x49bb2bd5e7506708b1c458d0b6331916180c091b
<span style=color:#666>(</span>3<span style=color:#666>)</span> 0x6ee54be55b95845c3c00cf1fb34cff053b619f44
<span style=color:#666>(</span>4<span style=color:#666>)</span> 0xeb259672501d8a16c954d09a8fdf84291d67cad2
<span style=color:#666>(</span>5<span style=color:#666>)</span> 0xb924f911ae293488043f6cc1d534654213db498f
<span style=color:#666>(</span>6<span style=color:#666>)</span> 0x02ce17094c74a5062ac6a2cd432a4948b7adba26
<span style=color:#666>(</span>7<span style=color:#666>)</span> 0x2e8e85efcefb3e96f09f2ca4d3d4342ef88a0b2c
<span style=color:#666>(</span>8<span style=color:#666>)</span> 0xd773abd9401ac8973cfcf5d8957bde6121347a92
<span style=color:#666>(</span>9<span style=color:#666>)</span> 0x0fcbde05930c09ecac70f9eeddb92d8b7ddec845

Private Keys:
<span style=color:#666>(</span>0<span style=color:#666>)</span> 328523fee9c143c97a93d27c2ef67a37e57143591e584bcbbdc6de71a0f92d8e
<span style=color:#666>(</span>1<span style=color:#666>)</span> 640e66ab0c0b9e775b32d5dfc00d71decc6c96006d71d6729abe336f88ef3c57
<span style=color:#666>(</span>2<span style=color:#666>)</span> c819551e120e1de0785f4476f7221d9d656a3b7c0e0fbce1de4eef986b2384bc
<span style=color:#666>(</span>3<span style=color:#666>)</span> 648892c4e7896ab4c1d26242ecda4de7f39a46cd2822451557c2910ce7b4be7f
<span style=color:#666>(</span>4<span style=color:#666>)</span> 8902380d9dd0dd8d6d97e59c694944a95829776db1dcb61406baec815649cb03
<span style=color:#666>(</span>5<span style=color:#666>)</span> f7d2341f7fbcde003d92e1a8ff3d3972fae00aff6a7568595e7bef03490efde9
<span style=color:#666>(</span>6<span style=color:#666>)</span> e4d11c8069bfaa777f666817d2d5f6b30a33dd75fb960b6e95abfd368286ef37
<span style=color:#666>(</span>7<span style=color:#666>)</span> 7af6c87f895b9c2a661748138a3bee82aff36439bcb43346f0285aa9dfb5aa04
<span style=color:#666>(</span>8<span style=color:#666>)</span> c810feb901d3bbeb57c9fadeba4e9da6bb61d61f1512fdabf5b0363264dd6336
<span style=color:#666>(</span>9<span style=color:#666>)</span> eb21927033d555614606e545e176c9584d8d673db404b70cc8fa4124cbee5438

Mnemonic: merry wrong fruit carry rifle phrase catalog describe mail traffic rate act

⚠️  Important ⚠️  : This mnemonic was created <span style=color:#a2f;font-weight:700>for</span> you by Truffle. It is not secure.
Ensure you <span style=color:#a2f;font-weight:700>do</span> not use it on production blockchains, or <span style=color:#a2f;font-weight:700>else</span> you risk losing funds.

truffle<span style=color:#666>(</span>develop<span style=color:#666>)</span>&gt; 
</code></pre></div><p>以上显示了生成的十个账户和它们的私钥，可用于之后与区块链的交互。</p><p>在出现的<code>truffle(develop)></code>提示符下，可以省略<code>truffle</code>前缀而执行truffle的相关命令，依次执行编译和迁移命令</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>truffle<span style=color:#666>(</span>develop<span style=color:#666>)</span>&gt; compile

Compiling your contracts...
<span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span>
&gt; Everything is up to date, there is nothing to compile.

truffle<span style=color:#666>(</span>develop<span style=color:#666>)</span>&gt; migrate

Compiling your contracts...
<span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span>
&gt; Everything is up to date, there is nothing to compile.



Starting migrations...
<span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span>
&gt; Network name:    <span style=color:#b44>&#39;develop&#39;</span>
&gt; Network id:      <span style=color:#666>5777</span>
&gt; Block gas limit: 0x6691b7


1_initial_migration.js
<span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span>

   Replacing <span style=color:#b44>&#39;Migrations&#39;</span>
   ----------------------
   &gt; transaction hash:    0x5cf8f2d9154c8c579535788af12bf153cba4dfe5f2e980b774f7a41cfe795089
   &gt; Blocks: <span style=color:#666>0</span>            Seconds: <span style=color:#666>0</span>
   &gt; contract address:    0x199Fb2370bb84f3eE5CacfF079D8478b67Cfba08
   &gt; block number:        <span style=color:#666>1</span>
   &gt; block timestamp:     <span style=color:#666>1573044347</span>
   &gt; account:             0xFc166345EFd307D6c22bdE2cC8f4e4E345c49495
   &gt; balance:             99.99477214
   &gt; gas used:            <span style=color:#666>261393</span>
   &gt; gas price:           <span style=color:#666>20</span> gwei
   &gt; value sent:          <span style=color:#666>0</span> ETH
   &gt; total cost:          0.00522786 ETH


   &gt; Saving migration to chain.
   &gt; Saving artifacts
   -------------------------------------
   &gt; Total cost:          0.00522786 ETH


2_deploy_contracts.js
<span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span>

   Replacing <span style=color:#b44>&#39;ConvertLib&#39;</span>
   ----------------------
   &gt; transaction hash:    0x8bb95067ae3d85e519a37fa49feb0bca0b39ecd471f6626399b75c66592d5cb7
   &gt; Blocks: <span style=color:#666>0</span>            Seconds: <span style=color:#666>0</span>
   &gt; contract address:    0x3f2dF366aC8C3356516C53B14610DE53309F7CCA
   &gt; block number:        <span style=color:#666>3</span>
   &gt; block timestamp:     <span style=color:#666>1573044347</span>
   &gt; account:             0xFc166345EFd307D6c22bdE2cC8f4e4E345c49495
   &gt; balance:             99.99185922
   &gt; gas used:            <span style=color:#666>103623</span>
   &gt; gas price:           <span style=color:#666>20</span> gwei
   &gt; value sent:          <span style=color:#666>0</span> ETH
   &gt; total cost:          0.00207246 ETH


   Linking
   -------
   * Contract: MetaCoin &lt;--&gt; Library: ConvertLib <span style=color:#666>(</span>at address: 0x3f2dF366aC8C3356516C53B14610DE53309F7CCA<span style=color:#666>)</span>

   Replacing <span style=color:#b44>&#39;MetaCoin&#39;</span>
   --------------------
   &gt; transaction hash:    0x88213b424d793c5e8d04cce4f34789a38b5c318a3782da511eee51c73fc97da6
   &gt; Blocks: <span style=color:#666>0</span>            Seconds: <span style=color:#666>0</span>
   &gt; contract address:    0xBADc6F515922344a53675A348ccBEeec6A96a37a
   &gt; block number:        <span style=color:#666>4</span>
   &gt; block timestamp:     <span style=color:#666>1573044347</span>
   &gt; account:             0xFc166345EFd307D6c22bdE2cC8f4e4E345c49495
   &gt; balance:             99.98509224
   &gt; gas used:            <span style=color:#666>338349</span>
   &gt; gas price:           <span style=color:#666>20</span> gwei
   &gt; value sent:          <span style=color:#666>0</span> ETH
   &gt; total cost:          0.00676698 ETH


   &gt; Saving migration to chain.
   &gt; Saving artifacts
   -------------------------------------
   &gt; Total cost:          0.00883944 ETH


<span style=color:#b8860b>Summary</span>
<span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span><span style=color:#666>=</span>
&gt; Total deployments:   <span style=color:#666>3</span>
&gt; Final cost:          0.0140673 ETH
</code></pre></div><p>接下来同样可以在提示符下直接进行合约交互，而不必退出使用<code>truffle console</code></p><h3 id=8-truffle-develop和truffle-console>8. Truffle develop和Truffle console</h3><p>两者都可以用于测试合约交互和手动执行交易，但Truffle develop同时还可以用来发起一个区块链</p><p>两者的使用场景为</p><p>Truffle Console</p><ul><li>已经有正在使用的客户端，如Ganache或geth</li><li>想要部署到测试网络或以太坊主网络</li><li>想要使用具体的助记符或账户列表</li></ul><p>Truffle develop</p><ul><li>正在测试项目，该项目不会马上部署</li><li>不需要使用指定的账户，使用默认提供的账户足够</li><li>不想安装或管理额外的区块链客户端</li></ul><h3 id=参考>参考</h3><p>[1] Truffle Quickstart, <a href=https://www.trufflesuite.com/docs/truffle/quickstart>https://www.trufflesuite.com/docs/truffle/quickstart</a></p><p>[2] Using Truffle Develop and The Console, <a href=https://www.trufflesuite.com/docs/truffle/getting-started/using-truffle-develop-and-the-console#truffle-develop>https://www.trufflesuite.com/docs/truffle/getting-started/using-truffle-develop-and-the-console#truffle-develop</a></p></div><footer class=post-footer><div class=post-tags><a href=/tags/%e5%8c%ba%e5%9d%97%e9%93%be rel=tag title=区块链>#区块链#</a></div><div class=addthis_inline_share_toolbox></div><div class=post-nav><div class=article-copyright><div class=article-copyright-info><p><span>声明：</span>以太坊开发8-Truffle框架安装使用</p><p><span>链接：</span>https://shuzang.github.io/2019/11/use-truffle-develop-ethereum-project/</p><p><span>作者：</span>书藏</p><p><span>声明： </span>本博客文章除特别声明外，均采用 <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank style=text-decoration:underline>CC BY-NC-SA 3.0</a>许可协议，转载请注明出处！</p></div></div><div class=clear></div></div><div class=reward-qr-info><div>创作实属不易，如有帮助，那就打赏博主些许茶钱吧 ^_^</div><button id=rewardButton disable=enable onclick="var qr=document.getElementById('QR');if(qr.style.display==='none'){qr.style.display='block';}else{qr.style.display='none'}">
<span>赏</span></button><div id=QR style=display:none><div id=wechat style=display:inline-block><img id=wechat_qr src=/img/wechat-pay.png alt="WeChat Pay"><p>微信打赏</p></div><div id=alipay style=display:inline-block><img id=alipay_qr src=/img/ali-pay.png alt=Alipay><p>支付宝打赏</p></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=https://shuzang.github.io/2019/11/medicine-and-health-3-first-aid-knowledge/ rel=next title=医药健康4-急救知识><i class="fa fa-chevron-left"></i>医药健康4-急救知识</a></div><div class="post-nav-prev post-nav-item"><a href=https://shuzang.github.io/2019/10/summary-of-problems-and-optimization-considerations-about-prototype-system/ rel=prev title=研究记录8-原始论文问题总结及优化考虑>研究记录8-原始论文问题总结及优化考虑
<i class="fa fa-chevron-right"></i></a></div></div><div id=wcomments></div></footer></article></section></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><section class="site-overview sidebar-panel sidebar-panel-active"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src=/images/avatar.png alt=书藏><p class=site-author-name itemprop=name>书藏</p><p class="site-description motion-element" itemprop=description></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=/post/><span class=site-state-item-count>334</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>7</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>23</span>
<span class=site-state-item-name>标签</span></a></div></nav><div class="links-of-author motion-element"><span class=links-of-author-item><a href=https://github.com/shuzang/ target=_blank title=GitHub><i class="fa fa-fw fa-github"></i>GitHub</a></span></div><div class="tagcloud-of-blogroll motion-element tagcloud-of-blogroll-inline"><div class=tagcloud-of-blogroll-title><i class="fa fa-fw fa-tags"></i>标签云</div><ul class=tagcloud-of-blogroll-list><li class=tagcloud-of-blogroll-item><a href=/tags/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0>论文笔记</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E4%B9%A6%E8%97%8F%E7%9A%84%E7%94%9F%E6%B4%BB%E5%91%A8%E5%88%8A>书藏的生活周刊</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E7%A7%91%E7%A0%94%E8%AE%B0%E5%BD%95>科研记录</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/go%E8%AF%AD%E6%B3%95>Go语法</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80>计算机基础</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E6%9D%82%E8%B0%88>杂谈</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E5%8C%BA%E5%9D%97%E9%93%BE>区块链</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95>数据结构与算法</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E7%94%9F%E6%B4%BB%E6%8A%80%E8%83%BD>生活技能</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/go%E5%AE%9E%E6%88%98>Go实战</a></li></ul></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=copyright><span class=copyright-year>&copy; 2018 - 2022</span>
<span class=with-love><i class="fa fa-heart"></i></span><span class=copyright-author>书藏的博客</span></div><div class=powered-info><span class=powered-by>Powered by - <a class=powered-link href=//gohugo.io target=_blank title=hugo>Hugo v0.63.2</a></span>
<span class=separator-line>/</span>
<span class=theme-info>Theme by - <a class=powered-link href=//github.com/elkan1788/hugo-theme-next target=_blank>NexT</a></span></div><div class=vistor-info><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><span class=site-uv><i class="fa fa-user"></i><span class=busuanzi-value id=busuanzi_value_site_uv></span></span><span class=separator-line>/</span>
<span class=site-pv><i class="fa fa-eye"></i><span class=busuanzi-value id=busuanzi_value_site_pv></span></span></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i><span id=scrollpercent><span>0</span>%</span></div></div><script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/2.1.4/jquery.min.js></script><script type=text/javascript src=/js/search.js></script><script type=text/javascript src=/js/affix.js></script><script type=text/javascript src=/js/scrollspy.js></script><script type=text/javascript>function detectIE(){var ua=window.navigator.userAgent;var msie=ua.indexOf('MSIE ');var trident=ua.indexOf('Trident/');var edge=ua.indexOf('Edge/');if(msie>0||trident>0||edge>0){return-1;}
return 1;}
function getCntViewHeight(){var docHeight=$('#content').height(),winHeight=$(window).height(),cntViewHeight=(docHeight>winHeight)?(docHeight-winHeight):($(document).height()-winHeight);return cntViewHeight;}
function getScrollbarWidth(){var $div=$('<div />').addClass('scrollbar-measure').prependTo('body');var div=$div[0];var scrollbarWidth=div.offsetWidth-div.clientWidth;$div.remove();return scrollbarWidth;}
function registerBackTop(){var THRESHOLD=50;var $top=$('.back-to-top');$(window).on('scroll',function(){$top.toggleClass('back-to-top-on',window.pageYOffset>THRESHOLD);var scrollTop=$(window).scrollTop();var cntViewHeight=getCntViewHeight();var scrollPercent=(scrollTop)/(cntViewHeight);var scrollPercentRounded=Math.round(scrollPercent*100);var scrollPercentMaxed=(scrollPercentRounded>100)?100:scrollPercentRounded;$('#scrollpercent>span').html(scrollPercentMaxed);});$top.on('click',function(){$("html,body").animate({scrollTop:0,screenLeft:0,},800);});}
function initScrollSpy(){var tocSelector='.post-toc';var $tocElement=$(tocSelector);var activeCurrentSelector='.active-current';$tocElement.on('activate.bs.scrollspy',function(){var $currentActiveElement=$(tocSelector+' .active').last();removeCurrentActiveClass();$currentActiveElement.addClass('active-current');}).on('clear.bs.scrollspy',removeCurrentActiveClass);$('body').scrollspy({target:tocSelector});function removeCurrentActiveClass(){$(tocSelector+' '+activeCurrentSelector).removeClass(activeCurrentSelector.substring(1));}}
function initAffix(){var headerHeight=$('.header-inner').height();var footerOffset=parseInt($('.main').css('padding-bottom'),10);var sidebarTop=headerHeight+10;$('.sidebar-inner').affix({offset:{top:sidebarTop,bottom:footerOffset}});$(document).on('affixed.bs.affix',function(){updateTOCHeight(document.body.clientHeight-100);});}
function initTOCDimension(){var updateTOCHeightTimer;$(window).on('resize',function(){updateTOCHeightTimer&&clearTimeout(updateTOCHeightTimer);updateTOCHeightTimer=setTimeout(function(){var tocWrapperHeight=document.body.clientHeight-100;updateTOCHeight(tocWrapperHeight);},0);});updateTOCHeight(document.body.clientHeight-100);var scrollbarWidth=getScrollbarWidth();$('.post-toc').css('width','calc(100% + '+scrollbarWidth+'px)');}
function updateTOCHeight(height){height=height||'auto';$('.post-toc').css('max-height',height);}
$(function(){var sidebarTop=$('.header-inner').height()+10;$('#sidebar').css({'margin-top':sidebarTop}).show();var sidebarMt=parseInt($('#sidebar').css('margin-top'));var sidebarInHeight=parseInt($('.sidebar-inner').css('height'));var sideHeight=sidebarMt+sidebarInHeight;var contentHeight=$('.content-wrap').height();if(contentHeight<sideHeight){$('.content-wrap').css('min-height',sideHeight);}
$('.site-nav-toggle').on('click',function(){var $siteNav=$('.site-nav');var $toggleLine=$('.toggle');var ON_CLASS_NAME='site-nav-on';var CLOSE_CLASS_NAME='toggle-close';var isSiteNavOn=$siteNav.hasClass(ON_CLASS_NAME);var animateAction=isSiteNavOn?'slideUp':'slideDown';var animateCallback=isSiteNavOn?'removeClass':'addClass';$siteNav.stop()[animateAction]('normal',function(){$siteNav[animateCallback](ON_CLASS_NAME);$toggleLine[animateCallback](CLOSE_CLASS_NAME);});});registerBackTop();initScrollSpy();initAffix();initTOCDimension();$('.sidebar-nav-toc').click(function(){$(this).addClass('sidebar-nav-active');$(this).next().removeClass('sidebar-nav-active');$('.'+$(this).next().attr('data-target')).toggle(500);$('.'+$(this).attr('data-target')).toggle(500);});$('.sidebar-nav-overview').click(function(){$(this).addClass('sidebar-nav-active');$(this).prev().removeClass('sidebar-nav-active');$('.'+$(this).prev().attr('data-target')).toggle(500);$('.'+$(this).attr('data-target')).toggle(500);});});</script><script src=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.js></script><script type=text/javascript>$(function(){$('.post-body').viewer();});</script><script type=text/javascript>$(function(){if(detectIE()>0){$.getScript(document.location.protocol+'//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js',function(){new Waline({el:'#wcomments',visitor:true,avatar:'wavatar',avatarCDN:'https://sdn.geekzu.org/avatar/',avatarForce:!1,wordLimit:'200',placeholder:' 欢迎留下您的宝贵建议，请填写您的昵称和邮箱便于后续交流. ^_^ ',requiredFields:['nick','mail'],serverURL:"Your WalineSerURL",lang:"zh-cn"});});}else{$('#wcomments').html('抱歉，Waline插件不支持IE或Edge，建议使用Chrome浏览器。');}});</script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=Your%20AddthisId"></script><script>(function(){var bp=document.createElement('script');var curProtocol=window.location.protocol.split(':')[0];if(curProtocol==='https'){bp.src='https://zz.bdstatic.com/linksubmit/push.js';}
else{bp.src='http://push.zhanzhang.baidu.com/push.js';}
var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script></body></html>