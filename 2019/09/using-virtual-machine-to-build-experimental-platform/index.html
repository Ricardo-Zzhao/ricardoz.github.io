<!doctype html><html lang=zh-cn dir=content/zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=content-security-policy content="upgrade-insecure-requests"><title>研究记录4-利用虚拟机搭建实验平台(失败) - 书藏的博客</title><meta name=keywords content="博客,程序员,区块链，思考,读书,笔记,生活,电影,旅游,"><meta name=author content="书藏"><meta property="og:title" content="研究记录4-利用虚拟机搭建实验平台(失败)"><meta property="og:site_name" content="书藏的博客"><meta property="og:image" content="/img/avatar.png"><meta name=title content="研究记录4-利用虚拟机搭建实验平台(失败) - 书藏的博客"><meta name=description content="书藏的个人博客，记录学习的东西，以月刊记录生活"><link rel="shortcut icon" href=/img/favicon.ico><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png><link href=//cdn.bootcdn.net/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css rel=stylesheet type=text/css><link href=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.css rel=stylesheet><link href=/css/main.css rel=stylesheet type=text/css><link href=/css/syntax.css rel=stylesheet type=text/css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-209130979-1"></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-209130979-1 ');</script></head><body itemscope itemtype=http://schema.org/WebPage lang=zh-hans><div class="container one-collumn sidebar-position-left page-home"><div class=headband></div><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle role=button style=opacity:1;top:0><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><div class=multi-lang-switch><i class="fa fa-fw fa-language" style=margin-right:5px></i><a class=lang-link id=zh-cn href=#>中文</a></div><div class=custom-logo-site-title><a href=/ class=brand rel=start><span class=logo-line-before><i></i></span><span class=site-title>书藏的博客</span>
<span class=logo-line-after><i></i></span></a></div><p class=site-subtitle>凡心所向，素履以往</p></div><div class=site-nav-right><div class="toggle popup-trigger" style=opacity:1;top:0><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul id=menu class=menu><li class=menu-item><a href=/ rel=section><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class=menu-item><a href=/post rel=section><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class=menu-item><a href=/about.html rel=section><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于我</a></li><li class="menu-item menu-item-search"><a href=javascript:; class=popup-trigger><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class=site-search><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class=search-icon><i class="fa fa-search"></i></span><span class=popup-btn-close><i class="fa fa-times-circle"></i></span><div class=local-search-input-wrapper><input autocomplete=off placeholder=搜索关键字... spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off></div></div><div id=local-search-result></div></div></div></nav></div></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><section id=posts class=posts-expand><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline"><a class=post-title-link href=https://shuzang.github.io/2019/09/using-virtual-machine-to-build-experimental-platform/ itemprop=url>研究记录4-利用虚拟机搭建实验平台(失败)</a></h1><div class=post-meta><span class=post-time><i class="fa fa-calendar-o fa-fw"></i><span class=post-meta-item-text>时间：</span>
<time itemprop=dateCreated datetime=2016-03-22T13:04:35+08:00 content="2019-09-13">2019-09-13</time></span>
<span class=post-category>&nbsp; | &nbsp;
<i class="fa fa-folder-o fa-fw"></i><span class=post-meta-item-text>分类：</span>
<span itemprop=about itemscope itemtype=https://schema.org/Thing><a href=/categories/%E7%A0%94%E7%A9%B6%E7%94%9F%E7%9A%84%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF itemprop=url rel=index style=text-decoration:underline><span itemprop=name>研究生的区块链学习之路</span></a>
&nbsp;</span></span>
<span>|
<i class="fa fa-file-word-o fa-fw"></i><span class=post-meta-item-text>字数：</span>
<span class=leancloud-world-count>8823 字</span></span>
<span>|
<i class="fa fa-eye fa-fw"></i><span class=post-meta-item-text>阅读：</span>
<span class=leancloud-view-count>18分钟</span></span>
<span id=/2019/09/using-virtual-machine-to-build-experimental-platform/ class=leancloud_visitors data-flag-title=研究记录4-利用虚拟机搭建实验平台(失败)>|
<i class="fa fa-binoculars fa-fw"></i><span class=post-meta-item-text>阅读次数：</span>
<span class=leancloud-visitors-count></span></span></div></header><div class=post-body itemprop=articleBody><p>先声明结论：最后由于网络原因没有成功，这种在多台电脑中安装虚拟机来联网的方式是存在一定问题的，其次，本篇所述的搭建方法过于繁琐，稍有不慎需要全部从头再来，在后面的实验中我们使用了简化的搭建流程。</p><h2 id=一-前言>一. 前言</h2><p>为了设计一个对物联网的访问控制方案，首先利用两台树莓派和两台计算机搭建完成了一个 Quorum 区块链实验平台，并采用了 Istanbul-BFT 共识算法，但未启用隐私管理器。之后将在该实验平台上部署编写的访问控制合约。实验平台的网络拓扑如下：</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/YJS_20190913_%E5%88%A9%E7%94%A8%E8%B7%AF%E7%94%B1%E5%99%A8%E5%BB%BA%E7%AB%8B%E5%B1%80%E5%9F%9F%E7%BD%91.png alt=利用路由器建立局域网></p><p>IBFT 共识允许的最小节点数量为 4，所以设置了 4 个节点，其中，两台电脑作为管理者或者用户的角色，能比较容易的和区块链交互，因为传感器和执行器本身没有足够的能力运行区块链节点，两台树莓派作为 IoT 设备的网关，我们所验证的是其中一台树莓派管理的设备向另一台树莓派管理的设备发起的访问。这里要注意两点：</p><ol><li>系统中不止设备对设备的访问，一定还包括用户通过 PC 或移动设备对 IoT 设备的访问；</li><li>使用树莓派的原因是尽量模拟实际的环境，但事实上，树莓派依然与实际环境相差巨大，更多的是验证当前方案在资源受限的网关设备上运行的可能性及对设备造成的运行压力。</li></ol><p>下面介绍平台的搭建过程，主要分为以下几步</p><ol><li>计算机环境配置</li><li>树莓派启动和环境配置</li><li>Quorum 私链网络搭建和测试运行</li></ol><h2 id=二-计算机环境配置>二. 计算机环境配置</h2><h3 id=1-设备和操作系统选择>1. 设备和操作系统选择</h3><p>实验平台共使用了两台计算机和两台树莓派。设备和操作系统的详细信息如下：</p><table><thead><tr><th>设备</th><th>CPU</th><th>操作系统</th><th>内存</th><th>硬盘</th></tr></thead><tbody><tr><td>清华同方</td><td>Intel Core i5-4460, 3.2GHz</td><td>Ubuntu 18.04 LTS(虚拟机)</td><td>2GB</td><td>50GB</td></tr><tr><td>华硕A550</td><td>Intel Core i5-4200, 2.8GHz</td><td>Ubuntu 18.04 LTS(虚拟机)</td><td>2GB</td><td>50GB</td></tr><tr><td>Raspberry Pi 3 Model B Plus</td><td>quad-core ARM Cortex A53, 1.4GHz</td><td>Raspbian Buster</td><td>1GB</td><td>32GB(microSD card)</td></tr><tr><td>Raspberry Pi 3 Model B</td><td>quad-core ARM Cortex A53, 1.2GHz</td><td>Raspbian Buster</td><td>1GB</td><td>16GB(microSD card)</td></tr></tbody></table><h3 id=2-静态ip分配>2. 静态ip分配</h3><p>两台计算机的操作环境是在虚拟机上完成的，涉及到网络相关操作，这里事先对各设备进行静态ip的分配</p><table><thead><tr><th>设备</th><th>主机名</th><th>IP地址</th><th>操作系统</th></tr></thead><tbody><tr><td>清华同方（PC）</td><td>NodeA</td><td>192.168.191.2</td><td>Ubuntu 18.04 LTS</td></tr><tr><td>华硕（Laptop)</td><td>NodeB</td><td>192.168.191.3</td><td>Ubuntu 18.04 LTS</td></tr><tr><td>Pi 3B+</td><td>NodeC</td><td>192.168.191.4</td><td>Raspbian Buster</td></tr><tr><td>Pi 3B</td><td>NodeD</td><td>192.168.191.5</td><td>Raspbian Buster</td></tr></tbody></table><p>注：以下以 PC 为例进行相关配置，Laptop 配置操作基本相同。</p><h3 id=3-操作系统设置>3. 操作系统设置</h3><p>在 VM ware 中安装 Ubuntu 18.04 虚拟机，安装完成后完成如下基础配置操作：</p><p><strong>(1) 更新源和系统</strong></p><p>根据自己需要选择是否更换软件源，此处我使用了原生的源</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo apt-get update
$ sudo apt-get upgrade
</code></pre></div><p><strong>(2) 调整系统时间</strong></p><p>查看系统时区是否正确</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ timedatectl
                      Local time: 五 2019-09-13 11:07:13 +08
                  Universal time: 五 2019-09-13 03:07:13 UTC
                        RTC time: 五 2019-09-13 03:07:13
                       Time zone: Asia/Ulaanbaatar <span style=color:#666>(</span>+08, +0800<span style=color:#666>)</span>
       System clock synchronized: yes
systemd-timesyncd.service active: yes
                 RTC in <span style=color:#a2f>local</span> TZ: no
</code></pre></div><p>若不正确，使用下列命令设置时区，时区根据自己所处位置调整</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ timedatectl set-timezone Asia/Shanghai
</code></pre></div><p><strong>(3) 设置主机名</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo hostnamectl set-hostname NodeA
</code></pre></div><p>重启终端查看新的主机名</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ hostnamectl
   Static hostname: NodeA
         Icon name: computer-vm
           Chassis: vm
        Machine ID: d16107a02250422baa2e04fb10c98558
           Boot ID: ea8fbdb520774a52a205281b4034f8b0
    Virtualization: vmware
  Operating System: Ubuntu 18.04.3 LTS
            Kernel: Linux 4.15.0-20-generic
      Architecture: x86-64
</code></pre></div><p><strong>(4) 设置静态ip</strong></p><p>安装 <code>net-tools</code> 工具</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo apt-get install net-tools
</code></pre></div><p>设置虚拟机网络为桥接模式，桥接到无线网卡。在<code>/etc/netplan</code>目录下创建配置文件</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo nano /etc/netplan/02_config.yaml
</code></pre></div><p>在配置文件中添加如下信息</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#a2f;font-weight:700>network</span>:<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>version</span>:<span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb>
</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>renderer</span>:<span style=color:#bbb> </span>networkd<span style=color:#bbb>
</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>ethernets</span>:<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#bbb>   </span><span style=color:#a2f;font-weight:700>ens33</span>:<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#bbb>     </span><span style=color:#a2f;font-weight:700>addresses</span>:<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#bbb>       </span>- <span style=color:#666>192.168</span><span style=color:#666>.191</span><span style=color:#666>.2</span>/<span style=color:#666>24</span><span style=color:#bbb>
</span><span style=color:#bbb>     </span><span style=color:#a2f;font-weight:700>gateway4</span>:<span style=color:#bbb> </span><span style=color:#666>192.168</span><span style=color:#666>.191</span><span style=color:#666>.1</span><span style=color:#bbb>
</span><span style=color:#bbb>     </span><span style=color:#a2f;font-weight:700>nameservers</span>:<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#bbb>         </span><span style=color:#a2f;font-weight:700>search</span>:<span style=color:#bbb> </span>[mydomain,<span style=color:#bbb> </span>otherdomain]<span style=color:#bbb>
</span><span style=color:#bbb>         </span><span style=color:#a2f;font-weight:700>addresses</span>:<span style=color:#bbb> </span>[<span style=color:#666>1.1</span><span style=color:#666>.1</span><span style=color:#666>.1</span>,<span style=color:#bbb> </span><span style=color:#666>8.8</span><span style=color:#666>.8</span><span style=color:#666>.8</span>]<span style=color:#bbb>
</span></code></pre></div><p><code>ens33</code>是网卡名，<code>addresses</code>下的内容为自定义的静态ip，<code>gateway4</code>为网关地址。保存退出，使用<code>netplan</code>启用设置，并查询更改后的ip地址</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo netplan apply
$ ifconfig
ens33: <span style=color:#b8860b>flags</span><span style=color:#666>=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span style=color:#666>1500</span>
        inet 192.168.191.2  netmask 255.255.255.0  broadcast 192.168.191.255
        inet6 fe80::94ff:42f8:57d5:a20f  prefixlen <span style=color:#666>64</span>  scopeid 0x20&lt;link&gt;
        ether 00:0c:29:09:08:33  txqueuelen <span style=color:#666>1000</span>  <span style=color:#666>(</span>以太网<span style=color:#666>)</span>
        RX packets <span style=color:#666>155321</span>  bytes <span style=color:#666>207407688</span> <span style=color:#666>(</span>207.4 MB<span style=color:#666>)</span>
        RX errors <span style=color:#666>0</span>  dropped <span style=color:#666>0</span>  overruns <span style=color:#666>0</span>  frame <span style=color:#666>0</span>
        TX packets <span style=color:#666>76320</span>  bytes <span style=color:#666>4839627</span> <span style=color:#666>(</span>4.8 MB<span style=color:#666>)</span>
        TX errors <span style=color:#666>0</span>  dropped <span style=color:#666>0</span> overruns <span style=color:#666>0</span>  carrier <span style=color:#666>0</span>  collisions <span style=color:#666>0</span>
lo: ...
</code></pre></div><p><strong>(5) 重新安装VMware tools</strong></p><p>只有安装 VMware tools 之后，虚拟机界面才会自动调整全屏，并且能在虚拟机和主机之间互传文件。</p><h3 id=4-区块链环境配置>4. 区块链环境配置</h3><p>使用的是 Quorum 区块链，共识是 Istanbul BFT。</p><p><strong>(1) 安装golang</strong></p><p>获取与安装 go1.13</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ wget https://dl.google.com/go/go1.13.linux-amd64.tar.gz
$ sudo tar -xzf go1.13.linux-amd64.tar.gz -C /usr/local
$ rm go1.13.linux-amd64.tar.gz
</code></pre></div><p>设置环境变量</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo nano /etc/profile
<span style=color:#080;font-style:italic># 在打开的文件末尾添加下列语句</span>
<span style=color:#a2f>export</span> <span style=color:#b8860b>PATH</span><span style=color:#666>=</span><span style=color:#b8860b>$PATH</span>:/usr/local/go/bin
</code></pre></div><p>更新的环境变量在下一次登录之前不会生效，但可以通过下面的命令使其直接生效</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ <span style=color:#a2f>source</span> /etc/profile
<span style=color:#080;font-style:italic># 查看生效后的环境变量设置</span>
$ go version
go version go1.13 linux/amd64
</code></pre></div><p>注：真正生效必须重启系统</p><p><strong>(2) 安装geth for quorum</strong></p><p>获取编译后的二进制包</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ wget https://bintray.com/quorumengineering/quorum/download_file?file_path<span style=color:#666>=</span>v2.2.5/geth_v2.2.5_linux_amd64.tar.gz
</code></pre></div><p>解压缩并安装</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo tar -xzf download_file?file_path<span style=color:#666>=</span>v2.2.5%2Fgeth_v2.2.5_linux_amd64.tar.gz -C /usr/local/bin
$ rm download_file?file_path<span style=color:#666>=</span>v2.2.5%2Fgeth_v2.2.5_linux_amd64.tar.gz
</code></pre></div><p>测试安装</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ geth version
WARN <span style=color:#666>[</span>09-13|16:03:38.966<span style=color:#666>]</span> Sanitizing cache to Go<span>&#39;</span>s GC limits       <span style=color:#b8860b>provided</span><span style=color:#666>=</span><span style=color:#666>1024</span> <span style=color:#b8860b>updated</span><span style=color:#666>=</span><span style=color:#666>655</span>
Geth
Version: 1.8.18-stable
Git Commit: c894c2d70eacf30740d03b53ed2fb39e42641295
Quorum Version: 2.2.5
Architecture: amd64
Protocol Versions: <span style=color:#666>[</span><span style=color:#666>63</span> 62<span style=color:#666>]</span>
Network Id: <span style=color:#666>1337</span>
Go Version: go1.11.12
Operating System: linux
<span style=color:#b8860b>GOPATH</span><span style=color:#666>=</span>
<span style=color:#b8860b>GOROOT</span><span style=color:#666>=</span>/home/travis/.gimme/versions/go1.11.12.linux.amd64
</code></pre></div><p><strong>(3) 获取并编译istanbul-tools</strong></p><p>istanbul-tools 用来初始化 istanbul-BFT 共识网络及进行网络测试</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo apt-get install git
$ mkdir istanbul <span style=color:#666>&amp;&amp;</span> <span style=color:#a2f>cd</span> istanbul
$ git clone https://github.com/jpmorganchase/istanbul-tools.git
$ <span style=color:#a2f>cd</span> istanbul-tools
</code></pre></div><p>执行编译</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo apt-get install -y build-essential
$ make
</code></pre></div><p>编译后的文件位于/build/bin目录下，执行测试</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ./build/bin/istanbul istanbul --version
istanbul version v1.0.1
</code></pre></div><h2 id=三-树莓派启动及环境配置>三. 树莓派启动及环境配置</h2><p>以Pi 3B+为例，Pi3B 配置操作基本相同</p><h3 id=1-树莓派启动>1. 树莓派启动</h3><p>将 Raspbian Buster 镜像写入准备好的SD卡，重新加载在电脑中的SD卡会出现boot盘，同时也是树莓派的<code>/boot</code>目录。在boot盘根目录新建名为<code>ssh</code>的文件，开启SSH连接。同时新建<code>wpa_supplicant.conf</code>文件，编辑其内容如下：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
country=CN
 
network={
    ssid=&#34;WiFi名&#34;
    psk=&#34;密码&#34;
    priority=10
}
</code></pre></div><p>将其中的ssid和psk更改为自己无线网络的网络名和密码。将配置好的SD卡卸载并插入树莓派，通电启动。使用Advanced IP Scanner扫描无线网络的网段，获取树莓派ip，本实验无线网络网段为192.168.191.1-254。</p><p>使用扫描到的ip通过Putty利用SSH协议进行登录。</p><h3 id=2-树莓派基本配置>2. 树莓派基本配置</h3><p><strong>(1) 更新源及系统</strong></p><p>编辑/etc/apt/sources.list文件</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo nano /etc/apt/sources.list
</code></pre></div><p>注释掉原来的源，将源更新为：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>deb http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main contrib non-free rpi
deb-src http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main contrib non-free rpi
</code></pre></div><p>保存退出，编辑/etc/apt/sources.list.d/raspi.list文件</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo nano /etc/apt/sources.list.d/raspi.list
</code></pre></div><p>将源更新为：</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>deb http://mirror.tuna.tsinghua.edu.cn/raspberrypi/ buster main ui
deb-src http://mirror.tuna.tsinghua.edu.cn/raspberrypi/ buster main ui
</code></pre></div><p>更新源文件列表，更新软件</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo apt-get update
$ sudo apt-get upgrade
</code></pre></div><p><strong>(2) 安装xrdp供远程连接</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo apt-get install xrdp
</code></pre></div><p><strong>(3) 开启ftp供文件传输</strong></p><p>安装vsftpd</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo apt-get install vsftpd
</code></pre></div><p>编辑配置文件</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo nano /etc/vsftpd.conf
</code></pre></div><p>启用对树莓派的写入权限</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#080;font-style:italic># Uncomment this to enable any form of FTP</span> 
write command.write_enable<span style=color:#666>=</span>YES
</code></pre></div><p>保存退出，启用vsftpd</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo service vsftpd start
</code></pre></div><p><strong>(4) 修改pi账户密码，时区和主机名</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo raspi-config
</code></pre></div><p>选择第一项<code>Change User Password</code>，键入新密码并确定，</p><p>选择第四项<code>Localisation Options</code>，选择<code>Change Timezone</code>，将时区更改为<code>Asia/Shanghai</code></p><p>全部设置完成后选择<code>Finish</code>退出，终端将看到如下输出</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>Current default <span style=color:#a2f>time</span> zone: <span style=color:#b44>&#39;Asia/Shanghai&#39;</span>
Local <span style=color:#a2f>time</span> is now:      Fri Sep <span style=color:#666>13</span> 18:40:56 CST 2019.
Universal Time is now:  Fri Sep <span style=color:#666>13</span> 10:40:56 UTC 2019.

New password:
Retype new password:
passwd: password updated successfully
OK
</code></pre></div><p>设置主机名</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo hostnamectl set-hostname NodeC
</code></pre></div><p>编辑/etc/hosts文件，将127.0.1.1对应的raspberry更改为NodeC</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>127.0.0.1       localhost
::1             localhost ip6-localhost ip6-loopback
ff02::1         ip6-allnodes
ff02::2         ip6-allrouters

127.0.1.1       NodeC
</code></pre></div><p>退出终端并使用新密码重新登录，主机名将更改为NodeC。注意此时用户名仍为pi。</p><p><strong>(5) 设置静态ip</strong></p><p>编辑<code>/etc/dhcpcd.conf</code>文件</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo nano /etc/dhcpcd.conf
</code></pre></div><p>在末尾添加如下内容</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>interface wlan0
 
static ip_address=192.168.191.4/24
static routers=192.168.191.1
static domain_name_servers=192.168.191.1
</code></pre></div><p>重启并以新的ip登录树莓派。</p><p>(6) 获取并安装geth</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ git clone -b gethonly https://github.com/shuzang/quorum-raspbian.git
$ <span style=color:#a2f>cd</span> quorum-raspbian
$ sudo cp geth /usr/local/bin
$ sudo chmod +x /usr/local/bin/geth
</code></pre></div><p>测试安装是否成功</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ geth version
WARN <span style=color:#666>[</span>09-13|19:51:40.051<span style=color:#666>]</span> Sanitizing cache to Go<span>&#39;</span>s GC limits       <span style=color:#b8860b>provided</span><span style=color:#666>=</span><span style=color:#666>1024</span> <span style=color:#b8860b>updated</span><span style=color:#666>=</span><span style=color:#666>308</span>
Geth
Version: 1.8.18-stable
Quorum Version: 2.2.5
Architecture: arm
Protocol Versions: <span style=color:#666>[</span><span style=color:#666>63</span> 62<span style=color:#666>]</span>
Network Id: <span style=color:#666>1337</span>
Go Version: go1.11.6
Operating System: linux
<span style=color:#b8860b>GOPATH</span><span style=color:#666>=</span>
<span style=color:#b8860b>GOROOT</span><span style=color:#666>=</span>/usr/lib/go-1.11

</code></pre></div><h2 id=四-私链网络搭建及测试运行>四. 私链网络搭建及测试运行</h2><p>各节点数据和相关文件的前期生成都在NodeA中由istanbul-tools工具完成。切换到NodeA节点的PC，在istanbul目录下创建四个节点的工作目录</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ <span style=color:#a2f>cd</span> ~/istanbul
$ mkdir NodeA NodeB NodeC NodeD
</code></pre></div><p>进入领导节点（这里是NodeA）目录，使用istanbul-tools工具为四个节点生成安装玩家，该命令会为所有的初始验证者节点生成 <code>static-nodes.json</code>, <code>genesis.json</code>和 nodekeys三种文件。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ <span style=color:#a2f>cd</span> NodeA
$ ../istanbul-tools/build/bin/istanbul setup --num <span style=color:#666>4</span> --nodes --quorum --save --verbose
</code></pre></div><p>将输出生成的文件信息</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span>v</span><span>a</span><span>l</span><span>i</span><span>d</span><span>a</span><span>t</span><span>o</span><span>r</span><span>s</span>
{
	<span style=color:green;font-weight:700>&#34;Address&#34;</span>: <span style=color:#b44>&#34;0x93c20b1ffa9bf8738bf194d5203e3d2e2a48428d&#34;</span>,
	<span style=color:green;font-weight:700>&#34;Nodekey&#34;</span>: <span style=color:#b44>&#34;6f17ec19de39281ea72a6d91d1e780bf5a0e35602f0e844e82dcc9d6a9ba7716&#34;</span>,
	<span style=color:green;font-weight:700>&#34;NodeInfo&#34;</span>: <span style=color:#b44>&#34;enode://faa50654f681a890c28be2faeef9211afaf1563c08ddb8990f6b39c561e002ea687707be68c16363f65c0755f785cb16e3b7be84e5e4eb260b0d4a6f6f83ef87@0.0.0.0:30303?discport=0&#34;</span>
}
{
	<span style=color:green;font-weight:700>&#34;Address&#34;</span>: <span style=color:#b44>&#34;0xff75bd429c43de6719c2983c1e991b0279909559&#34;</span>,
	<span style=color:green;font-weight:700>&#34;Nodekey&#34;</span>: <span style=color:#b44>&#34;b7c11c512d33e3c1de97abd8a690cdbcfac9c6802a43a6ff850b244d90258908&#34;</span>,
	<span style=color:green;font-weight:700>&#34;NodeInfo&#34;</span>: <span style=color:#b44>&#34;enode://c286de4e89f4f209a6b32284b31829251ccb23bf5ab3bbe57ba08754392635ae755848dd6c4f367c7d92284e54e4b9f0d1a896924309380eb947e3b8c6641392@0.0.0.0:30303?discport=0&#34;</span>
}
{
	<span style=color:green;font-weight:700>&#34;Address&#34;</span>: <span style=color:#b44>&#34;0xf22670e572a42729a2c10fb26f57bba46cbc3a42&#34;</span>,
	<span style=color:green;font-weight:700>&#34;Nodekey&#34;</span>: <span style=color:#b44>&#34;9b3740640431f0d6543f730308509fb9bc35307f826b1dd838b6812a6067f477&#34;</span>,
	<span style=color:green;font-weight:700>&#34;NodeInfo&#34;</span>: <span style=color:#b44>&#34;enode://cb50baa67204df2246b143e2982e40a89b2924e5c19e2834876c34042f0a81a2e2604ab210d19a048762f5355258d9840932ba868227857d928495d398c04af0@0.0.0.0:30303?discport=0&#34;</span>
}
{
	<span style=color:green;font-weight:700>&#34;Address&#34;</span>: <span style=color:#b44>&#34;0x350686ae7615e87a046fc4261fe58fda3872aa65&#34;</span>,
	<span style=color:green;font-weight:700>&#34;Nodekey&#34;</span>: <span style=color:#b44>&#34;b6fd16bc88c8f96430b9ec0c4f6991c0f958e70026fce1abc959b295774f4e94&#34;</span>,
	<span style=color:green;font-weight:700>&#34;NodeInfo&#34;</span>: <span style=color:#b44>&#34;enode://214dce3278a2b45fb0bf2a1d53c24eb213c5cbb08307e842feab0202cad4f685c5c62a4197d29318f07eb813bf4189db05096b551849039bf81fb74f0211320f@0.0.0.0:30303?discport=0&#34;</span>
}



<span>s</span><span>t</span><span>a</span><span>t</span><span>i</span><span>c</span><span>-</span><span>n</span><span>o</span><span>d</span><span>e</span><span>s</span><span>.</span><span>j</span><span>s</span><span>o</span><span>n</span>
[
	<span style=color:#b44>&#34;enode://faa50654f681a890c28be2faeef9211afaf1563c08ddb8990f6b39c561e002ea687707be68c16363f65c0755f785cb16e3b7be84e5e4eb260b0d4a6f6f83ef87@0.0.0.0:30303?discport=0&#34;</span>,
	<span style=color:#b44>&#34;enode://c286de4e89f4f209a6b32284b31829251ccb23bf5ab3bbe57ba08754392635ae755848dd6c4f367c7d92284e54e4b9f0d1a896924309380eb947e3b8c6641392@0.0.0.0:30303?discport=0&#34;</span>,
	<span style=color:#b44>&#34;enode://cb50baa67204df2246b143e2982e40a89b2924e5c19e2834876c34042f0a81a2e2604ab210d19a048762f5355258d9840932ba868227857d928495d398c04af0@0.0.0.0:30303?discport=0&#34;</span>,
	<span style=color:#b44>&#34;enode://214dce3278a2b45fb0bf2a1d53c24eb213c5cbb08307e842feab0202cad4f685c5c62a4197d29318f07eb813bf4189db05096b551849039bf81fb74f0211320f@0.0.0.0:30303?discport=0&#34;</span>
]



<span>g</span><span>e</span><span>n</span><span>e</span><span>s</span><span>i</span><span>s</span><span>.</span><span>j</span><span>s</span><span>o</span><span>n</span>
{
    <span style=color:green;font-weight:700>&#34;config&#34;</span>: {
        <span style=color:green;font-weight:700>&#34;chainId&#34;</span>: <span style=color:#666>10</span>,
        <span style=color:green;font-weight:700>&#34;homesteadBlock&#34;</span>: <span style=color:#666>0</span>,
        <span style=color:green;font-weight:700>&#34;eip150Block&#34;</span>: <span style=color:#666>0</span>,
        <span style=color:green;font-weight:700>&#34;eip150Hash&#34;</span>: <span style=color:#b44>&#34;0x0000000000000000000000000000000000000000000000000000000000000000&#34;</span>,
        <span style=color:green;font-weight:700>&#34;eip155Block&#34;</span>: <span style=color:#666>0</span>,
        <span style=color:green;font-weight:700>&#34;eip158Block&#34;</span>: <span style=color:#666>0</span>,
        <span style=color:green;font-weight:700>&#34;byzantiumBlock&#34;</span>: <span style=color:#666>0</span>,
        <span style=color:green;font-weight:700>&#34;constantinopleBlock&#34;</span>: <span style=color:#666>0</span>,
        <span style=color:green;font-weight:700>&#34;istanbul&#34;</span>: {
            <span style=color:green;font-weight:700>&#34;epoch&#34;</span>: <span style=color:#666>30000</span>,
            <span style=color:green;font-weight:700>&#34;policy&#34;</span>: <span style=color:#666>0</span>
        },
        <span style=color:green;font-weight:700>&#34;txnSizeLimit&#34;</span>: <span style=color:#666>64</span>,
        <span style=color:green;font-weight:700>&#34;isQuorum&#34;</span>: <span style=color:#a2f;font-weight:700>true</span>
    },
    <span style=color:green;font-weight:700>&#34;nonce&#34;</span>: <span style=color:#b44>&#34;0x0&#34;</span>,
    <span style=color:green;font-weight:700>&#34;timestamp&#34;</span>: <span style=color:#b44>&#34;0x5d7c4ae8&#34;</span>,
    <span style=color:green;font-weight:700>&#34;extraData&#34;</span>: <span style=color:#b44>&#34;0x0000000000000000000000000000000000000000000000000000000000000000f89af8549493c20b1ffa9bf8738bf194d5203e3d2e2a48428d94ff75bd429c43de6719c2983c1e991b027990955994f22670e572a42729a2c10fb26f57bba46cbc3a4294350686ae7615e87a046fc4261fe58fda3872aa65b8410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0&#34;</span>,
    <span style=color:green;font-weight:700>&#34;gasLimit&#34;</span>: <span style=color:#b44>&#34;0xe0000000&#34;</span>,
    <span style=color:green;font-weight:700>&#34;difficulty&#34;</span>: <span style=color:#b44>&#34;0x1&#34;</span>,
    <span style=color:green;font-weight:700>&#34;mixHash&#34;</span>: <span style=color:#b44>&#34;0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365&#34;</span>,
    <span style=color:green;font-weight:700>&#34;coinbase&#34;</span>: <span style=color:#b44>&#34;0x0000000000000000000000000000000000000000&#34;</span>,
    <span style=color:green;font-weight:700>&#34;alloc&#34;</span>: {
        <span style=color:green;font-weight:700>&#34;350686ae7615e87a046fc4261fe58fda3872aa65&#34;</span>: {
            <span style=color:green;font-weight:700>&#34;balance&#34;</span>: <span style=color:#b44>&#34;0x446c3b15f9926687d2c40534fdb564000000000000&#34;</span>
        },
        <span style=color:green;font-weight:700>&#34;93c20b1ffa9bf8738bf194d5203e3d2e2a48428d&#34;</span>: {
            <span style=color:green;font-weight:700>&#34;balance&#34;</span>: <span style=color:#b44>&#34;0x446c3b15f9926687d2c40534fdb564000000000000&#34;</span>
        },
        <span style=color:green;font-weight:700>&#34;f22670e572a42729a2c10fb26f57bba46cbc3a42&#34;</span>: {
            <span style=color:green;font-weight:700>&#34;balance&#34;</span>: <span style=color:#b44>&#34;0x446c3b15f9926687d2c40534fdb564000000000000&#34;</span>
        },
        <span style=color:green;font-weight:700>&#34;ff75bd429c43de6719c2983c1e991b0279909559&#34;</span>: {
            <span style=color:green;font-weight:700>&#34;balance&#34;</span>: <span style=color:#b44>&#34;0x446c3b15f9926687d2c40534fdb564000000000000&#34;</span>
        }
    },
    <span style=color:green;font-weight:700>&#34;number&#34;</span>: <span style=color:#b44>&#34;0x0&#34;</span>,
    <span style=color:green;font-weight:700>&#34;gasUsed&#34;</span>: <span style=color:#b44>&#34;0x0&#34;</span>,
    <span style=color:green;font-weight:700>&#34;parentHash&#34;</span>: <span style=color:#b44>&#34;0x0000000000000000000000000000000000000000000000000000000000000000&#34;</span>
}
</code></pre></div><p>查看生成的文件</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ls -l
total <span style=color:#666>24</span>
drwxr-xr-x <span style=color:#666>2</span> shuzang shuzang <span style=color:#666>4096</span> Sep <span style=color:#666>14</span> 10:05 <span style=color:#666>0</span>
drwxr-xr-x <span style=color:#666>2</span> shuzang shuzang <span style=color:#666>4096</span> Sep <span style=color:#666>14</span> 10:05 <span style=color:#666>1</span>
drwxr-xr-x <span style=color:#666>2</span> shuzang shuzang <span style=color:#666>4096</span> Sep <span style=color:#666>14</span> 10:05 <span style=color:#666>2</span>
drwxr-xr-x <span style=color:#666>2</span> shuzang shuzang <span style=color:#666>4096</span> Sep <span style=color:#666>14</span> 10:05 <span style=color:#666>3</span>
-rwxr-xr-x <span style=color:#666>1</span> shuzang shuzang <span style=color:#666>1792</span> Sep <span style=color:#666>14</span> 10:05 genesis.json
-rwxr-xr-x <span style=color:#666>1</span> shuzang shuzang  <span style=color:#666>666</span> Sep <span style=color:#666>14</span> 10:05 static-nodes.json
</code></pre></div><p>使用预定的IP(端口号不改，使用默认的30303即可）为所有验证者节点更新 <code>static-nodes.json</code> 文件。 在 <code>static-nodes.json</code>中，每个节点占据一行，第几行即代表第几个节点。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ cat static-nodes.json
....更新ip如下
<span style=color:#666>[</span>	<span style=color:#b44>&#34;enode://faa50654f681a890c28be2faeef9211afaf1563c08ddb8990f6b39c561e002ea687707be68c16363f65c0755f785cb16e3b7be84e5e4eb260b0d4a6f6f83ef87@192.168.191.2:30303?discport=0&#34;</span>,
	<span style=color:#b44>&#34;enode://c286de4e89f4f209a6b32284b31829251ccb23bf5ab3bbe57ba08754392635ae755848dd6c4f367c7d92284e54e4b9f0d1a896924309380eb947e3b8c6641392@192.168.191.3:30303?discport=0&#34;</span>,
	<span style=color:#b44>&#34;enode://cb50baa67204df2246b143e2982e40a89b2924e5c19e2834876c34042f0a81a2e2604ab210d19a048762f5355258d9840932ba868227857d928495d398c04af0@192.168.191.4:30303?discport=0&#34;</span>,
	<span style=color:#b44>&#34;enode://214dce3278a2b45fb0bf2a1d53c24eb213c5cbb08307e842feab0202cad4f685c5c62a4197d29318f07eb813bf4189db05096b551849039bf81fb74f0211320f@192.168.191.5:30303?discport=0&#34;</span>
<span style=color:#666>]</span>
</code></pre></div><p>在每个节点的工作目录创建名为<code>data</code>的数据目录，在<code>data</code>目录创建<code>geth</code>目录</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ <span style=color:#a2f>cd</span> ..
$ mkdir -p NodeA/data/geth
$ mkdir -p NodeB/data/geth
$ mkdir -p NodeC/data/geth
$ mkdir -p NodeD/data/geth
</code></pre></div><p>在四个节点的工作目录中分别为各自节点生成初始账户，账户地址会显示在终端，记住为每个节点账户所设的密码</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ geth --datadir NodeA/data account new
WARN <span style=color:#666>[</span>09-14|10:18:26.738<span style=color:#666>]</span> Sanitizing cache to Go<span style=color:#b44>&#39;s GC limits       provided=1024 updated=655
</span><span style=color:#b44>INFO [09-14|10:18:26.748] Maximum peer count                       ETH=25 LES=0 total=25
</span><span style=color:#b44>Your new account is locked with a password. Please give a password. Do not forget this password.
</span><span style=color:#b44>Passphrase: 
</span><span style=color:#b44>Repeat passphrase: 
</span><span style=color:#b44>Address: {b619ead9d3d72b675a471b3d8ff67673de8ae7f4}
</span><span style=color:#b44>$ geth --datadir NodeB/data account new
</span><span style=color:#b44>WARN [09-14|10:18:41.953] Sanitizing cache to Go&#39;</span>s GC limits       <span style=color:#b8860b>provided</span><span style=color:#666>=</span><span style=color:#666>1024</span> <span style=color:#b8860b>updated</span><span style=color:#666>=</span><span style=color:#666>655</span>
INFO <span style=color:#666>[</span>09-14|10:18:41.954<span style=color:#666>]</span> Maximum peer count                       <span style=color:#b8860b>ETH</span><span style=color:#666>=</span><span style=color:#666>25</span> <span style=color:#b8860b>LES</span><span style=color:#666>=</span><span style=color:#666>0</span> <span style=color:#b8860b>total</span><span style=color:#666>=</span><span style=color:#666>25</span>
Your new account is locked with a password. Please give a password. Do not forget this password.
Passphrase: 
Repeat passphrase: 
Address: <span style=color:#666>{</span>4cd5ae20dba37c96717f328dc6c02e1c1927be1c<span style=color:#666>}</span>
$ geth --datadir NodeC/data account new
WARN <span style=color:#666>[</span>09-14|10:18:56.231<span style=color:#666>]</span> Sanitizing cache to Go<span style=color:#b44>&#39;s GC limits       provided=1024 updated=655
</span><span style=color:#b44>INFO [09-14|10:18:56.232] Maximum peer count                       ETH=25 LES=0 total=25
</span><span style=color:#b44>Your new account is locked with a password. Please give a password. Do not forget this password.
</span><span style=color:#b44>Passphrase: 
</span><span style=color:#b44>Repeat passphrase: 
</span><span style=color:#b44>Address: {461d9bc69d4a32cb599310843bf5bf88342cc03c}
</span><span style=color:#b44>$ geth --datadir NodeD/data account new
</span><span style=color:#b44>WARN [09-14|10:19:09.591] Sanitizing cache to Go&#39;</span>s GC limits       <span style=color:#b8860b>provided</span><span style=color:#666>=</span><span style=color:#666>1024</span> <span style=color:#b8860b>updated</span><span style=color:#666>=</span><span style=color:#666>655</span>
INFO <span style=color:#666>[</span>09-14|10:19:09.592<span style=color:#666>]</span> Maximum peer count                       <span style=color:#b8860b>ETH</span><span style=color:#666>=</span><span style=color:#666>25</span> <span style=color:#b8860b>LES</span><span style=color:#666>=</span><span style=color:#666>0</span> <span style=color:#b8860b>total</span><span style=color:#666>=</span><span style=color:#666>25</span>
Your new account is locked with a password. Please give a password. Do not forget this password.
Passphrase: 
Repeat passphrase: 
Address: <span style=color:#666>{</span>51ef0c6536e69e2ea46f5ec5e150da423305c63d<span style=color:#666>}</span>
</code></pre></div><p>为了添加账户到初始区块，使用上述产生的账户地址更新<code>genesis.json</code>文件的<code>alloc</code>字段内容。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ cat NodeA/genesis.json
<span style=color:#666>{</span>
    <span style=color:#b44>&#34;config&#34;</span>: <span style=color:#666>{</span>
        <span style=color:#b44>&#34;chainId&#34;</span>: 10,
        <span style=color:#b44>&#34;homesteadBlock&#34;</span>: 0,
        <span style=color:#b44>&#34;eip150Block&#34;</span>: 0,
        <span style=color:#b44>&#34;eip150Hash&#34;</span>: <span style=color:#b44>&#34;0x0000000000000000000000000000000000000000000000000000000000000000&#34;</span>,
        <span style=color:#b44>&#34;eip155Block&#34;</span>: 0,
        <span style=color:#b44>&#34;eip158Block&#34;</span>: 0,
        <span style=color:#b44>&#34;byzantiumBlock&#34;</span>: 0,
        <span style=color:#b44>&#34;constantinopleBlock&#34;</span>: 0,
        <span style=color:#b44>&#34;istanbul&#34;</span>: <span style=color:#666>{</span>
            <span style=color:#b44>&#34;epoch&#34;</span>: 30000,
            <span style=color:#b44>&#34;policy&#34;</span>: <span style=color:#666>0</span>
        <span style=color:#666>}</span>,
        <span style=color:#b44>&#34;txnSizeLimit&#34;</span>: 64,
        <span style=color:#b44>&#34;isQuorum&#34;</span>: <span style=color:#a2f>true</span>
    <span style=color:#666>}</span>,
    <span style=color:#b44>&#34;nonce&#34;</span>: <span style=color:#b44>&#34;0x0&#34;</span>,
    <span style=color:#b44>&#34;timestamp&#34;</span>: <span style=color:#b44>&#34;0x5d7c4ae8&#34;</span>,
    <span style=color:#b44>&#34;extraData&#34;</span>: <span style=color:#b44>&#34;0x0000000000000000000000000000000000000000000000000000000000000000f89af8549493c20b1ffa9bf8738bf194d5203e3d2e2a48428d94ff75bd429c43de6719c2983c1e991b027990955994f22670e572a42729a2c10fb26f57bba46cbc3a4294350686ae7615e87a046fc4261fe58fda3872aa65b8410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0&#34;</span>,
    <span style=color:#b44>&#34;gasLimit&#34;</span>: <span style=color:#b44>&#34;0xe0000000&#34;</span>,
    <span style=color:#b44>&#34;difficulty&#34;</span>: <span style=color:#b44>&#34;0x1&#34;</span>,
    <span style=color:#b44>&#34;mixHash&#34;</span>: <span style=color:#b44>&#34;0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365&#34;</span>,
    <span style=color:#b44>&#34;coinbase&#34;</span>: <span style=color:#b44>&#34;0x0000000000000000000000000000000000000000&#34;</span>,
    <span style=color:#b44>&#34;alloc&#34;</span>: <span style=color:#666>{</span>
        <span style=color:#b44>&#34;b619ead9d3d72b675a471b3d8ff67673de8ae7f4&#34;</span>: <span style=color:#666>{</span>
            <span style=color:#b44>&#34;balance&#34;</span>: <span style=color:#b44>&#34;0x446c3b15f9926687d2c40534fdb564000000000000&#34;</span>
        <span style=color:#666>}</span>,
        <span style=color:#b44>&#34;4cd5ae20dba37c96717f328dc6c02e1c1927be1c&#34;</span>: <span style=color:#666>{</span>
            <span style=color:#b44>&#34;balance&#34;</span>: <span style=color:#b44>&#34;0x446c3b15f9926687d2c40534fdb564000000000000&#34;</span>
        <span style=color:#666>}</span>,
        <span style=color:#b44>&#34;461d9bc69d4a32cb599310843bf5bf88342cc03c&#34;</span>: <span style=color:#666>{</span>
            <span style=color:#b44>&#34;balance&#34;</span>: <span style=color:#b44>&#34;0x446c3b15f9926687d2c40534fdb564000000000000&#34;</span>
        <span style=color:#666>}</span>,
        <span style=color:#b44>&#34;51ef0c6536e69e2ea46f5ec5e150da423305c63d&#34;</span>: <span style=color:#666>{</span>
            <span style=color:#b44>&#34;balance&#34;</span>: <span style=color:#b44>&#34;0x446c3b15f9926687d2c40534fdb564000000000000&#34;</span>
        <span style=color:#666>}</span>
    <span style=color:#666>}</span>,
    <span style=color:#b44>&#34;number&#34;</span>: <span style=color:#b44>&#34;0x0&#34;</span>,
    <span style=color:#b44>&#34;gasUsed&#34;</span>: <span style=color:#b44>&#34;0x0&#34;</span>,
    <span style=color:#b44>&#34;parentHash&#34;</span>: <span style=color:#b44>&#34;0x0000000000000000000000000000000000000000000000000000000000000000&#34;</span>
<span style=color:#666>}</span>
</code></pre></div><p>将之前步骤中产生的初始化文件移动到相应节点的工作目录。这些文件现在位于领导节点的工作目录。<code>genesis.json</code>放到每个节点的工作目录, <code>static-nodes.json</code>放到每个节点的<code>data</code>目录。<code>X/nodekey</code>放到对应节点的<code>data/geth</code></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ cp NodeA/genesis.json NodeB
$ cp NodeA/genesis.json NodeC
$ cp NodeA/genesis.json NodeD
$ cp NodeA/static-nodes.json NodeA/data/
$ cp NodeA/static-nodes.json NodeB/data/
$ cp NodeA/static-nodes.json NodeC/data/
$ cp NodeA/static-nodes.json NodeD/data/
$ cp NodeA/0/nodekey NodeA/data/geth
$ cp NodeA/1/nodekey NodeB/data/geth
$ cp NodeA/2/nodekey NodeC/data/geth
$ cp NodeA/3/nodekey NodeD/data/geth
</code></pre></div><p>将NodeB，NodeC，NodeD文件夹使用ftp文件传输协议分别移动到对应的三个设备的用户主目录下，使用的软件是FileZilla。</p><p>分别在各自设备的迁移过去的Node文件夹根目录执行节点初始化工作</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#080;font-style:italic># 在NodeA设备</span>
$ <span style=color:#a2f>cd</span> NodeA
$ geth --datadir data init genesis.json
WARN <span style=color:#666>[</span>09-14|10:42:06.033<span style=color:#666>]</span> Sanitizing cache to Go<span style=color:#b44>&#39;s GC limits       provided=1024 updated=655
</span><span style=color:#b44>INFO [09-14|10:42:06.049] Maximum peer count                       ETH=25 LES=0 total=25
</span><span style=color:#b44>INFO [09-14|10:42:06.056] Allocated cache and file handles         database=/home/shuzang/istanbul/NodeA/data/geth/chaindata cache=16 handles=16
</span><span style=color:#b44>INFO [09-14|10:42:06.079] Writing custom genesis block 
</span><span style=color:#b44>INFO [09-14|10:42:06.088] Persisted trie from memory database      nodes=5 size=819.00B time=224.043µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
</span><span style=color:#b44>INFO [09-14|10:42:06.088] Successfully wrote genesis state         database=chaindata                                        hash=7d00b6…27b2d4
</span><span style=color:#b44>INFO [09-14|10:42:06.088] Allocated cache and file handles         database=/home/shuzang/istanbul/NodeA/data/geth/lightchaindata cache=16 handles=16
</span><span style=color:#b44>INFO [09-14|10:42:06.091] Writing custom genesis block 
</span><span style=color:#b44>INFO [09-14|10:42:06.091] Persisted trie from memory database      nodes=5 size=819.00B time=48.242µs  gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
</span><span style=color:#b44>INFO [09-14|10:42:06.091] Successfully wrote genesis state         database=lightchaindata                                        hash=7d00b6…27b2d4
</span><span style=color:#b44>
</span><span style=color:#b44># 在NodeB设备
</span><span style=color:#b44>$ cd ~/NodeB
</span><span style=color:#b44>$ geth --datadir data init genesis.json
</span><span style=color:#b44>
</span><span style=color:#b44>
</span><span style=color:#b44># 在NodeC设备
</span><span style=color:#b44>$ cd ~/NodeC
</span><span style=color:#b44>$ geth --datadir data init genesis.json
</span><span style=color:#b44>WARN [09-14|10:44:13.570] Sanitizing cache to Go&#39;</span>s GC limits       <span style=color:#b8860b>provided</span><span style=color:#666>=</span><span style=color:#666>1024</span> <span style=color:#b8860b>updated</span><span style=color:#666>=</span><span style=color:#666>308</span>
INFO <span style=color:#666>[</span>09-14|10:44:13.594<span style=color:#666>]</span> Maximum peer count                       <span style=color:#b8860b>ETH</span><span style=color:#666>=</span><span style=color:#666>25</span> <span style=color:#b8860b>LES</span><span style=color:#666>=</span><span style=color:#666>0</span> <span style=color:#b8860b>total</span><span style=color:#666>=</span><span style=color:#666>25</span>
INFO <span style=color:#666>[</span>09-14|10:44:13.607<span style=color:#666>]</span> Allocated cache and file handles         <span style=color:#b8860b>database</span><span style=color:#666>=</span>/home/pi/NodeC/data/geth/chaindata <span style=color:#b8860b>cache</span><span style=color:#666>=</span><span style=color:#666>16</span> <span style=color:#b8860b>handles</span><span style=color:#666>=</span><span style=color:#666>16</span>
INFO <span style=color:#666>[</span>09-14|10:44:13.659<span style=color:#666>]</span> Writing custom genesis block
INFO <span style=color:#666>[</span>09-14|10:44:13.663<span style=color:#666>]</span> Persisted trie from memory database      <span style=color:#b8860b>nodes</span><span style=color:#666>=</span><span style=color:#666>5</span> <span style=color:#b8860b>size</span><span style=color:#666>=</span>819.00B <span style=color:#b8860b>time</span><span style=color:#666>=</span>679.667µs <span style=color:#b8860b>gcnodes</span><span style=color:#666>=</span><span style=color:#666>0</span> <span style=color:#b8860b>gcsize</span><span style=color:#666>=</span>0.00B <span style=color:#b8860b>gctime</span><span style=color:#666>=</span>0s <span style=color:#b8860b>livenodes</span><span style=color:#666>=</span><span style=color:#666>1</span> <span style=color:#b8860b>livesize</span><span style=color:#666>=</span>0.00B
INFO <span style=color:#666>[</span>09-14|10:44:13.666<span style=color:#666>]</span> Successfully wrote genesis state         <span style=color:#b8860b>database</span><span style=color:#666>=</span>chaindata                          <span style=color:#b8860b>hash</span><span style=color:#666>=</span>7d00b6…27b2d4
INFO <span style=color:#666>[</span>09-14|10:44:13.666<span style=color:#666>]</span> Allocated cache and file handles         <span style=color:#b8860b>database</span><span style=color:#666>=</span>/home/pi/NodeC/data/geth/lightchaindata <span style=color:#b8860b>cache</span><span style=color:#666>=</span><span style=color:#666>16</span> <span style=color:#b8860b>handles</span><span style=color:#666>=</span><span style=color:#666>16</span>
INFO <span style=color:#666>[</span>09-14|10:44:13.694<span style=color:#666>]</span> Writing custom genesis block
INFO <span style=color:#666>[</span>09-14|10:44:13.697<span style=color:#666>]</span> Persisted trie from memory database      <span style=color:#b8860b>nodes</span><span style=color:#666>=</span><span style=color:#666>5</span> <span style=color:#b8860b>size</span><span style=color:#666>=</span>819.00B <span style=color:#b8860b>time</span><span style=color:#666>=</span>573.516µs <span style=color:#b8860b>gcnodes</span><span style=color:#666>=</span><span style=color:#666>0</span> <span style=color:#b8860b>gcsize</span><span style=color:#666>=</span>0.00B <span style=color:#b8860b>gctime</span><span style=color:#666>=</span>0s <span style=color:#b8860b>livenodes</span><span style=color:#666>=</span><span style=color:#666>1</span> <span style=color:#b8860b>livesize</span><span style=color:#666>=</span>0.00B
INFO <span style=color:#666>[</span>09-14|10:44:13.699<span style=color:#666>]</span> Successfully wrote genesis state         <span style=color:#b8860b>database</span><span style=color:#666>=</span>lightchaindata                          <span style=color:#b8860b>hash</span><span style=color:#666>=</span>7d00b6…27b2d4

<span style=color:#080;font-style:italic># 在NodeD设备</span>
$ <span style=color:#a2f>cd</span> ~/NodeD
$ geth --datadir data init genesis.json
WARN <span style=color:#666>[</span>09-14|10:45:59.139<span style=color:#666>]</span> Sanitizing cache to Go<span>&#39;</span>s GC limits       <span style=color:#b8860b>provided</span><span style=color:#666>=</span><span style=color:#666>1024</span> <span style=color:#b8860b>updated</span><span style=color:#666>=</span><span style=color:#666>308</span>
INFO <span style=color:#666>[</span>09-14|10:45:59.155<span style=color:#666>]</span> Maximum peer count                       <span style=color:#b8860b>ETH</span><span style=color:#666>=</span><span style=color:#666>25</span> <span style=color:#b8860b>LES</span><span style=color:#666>=</span><span style=color:#666>0</span> <span style=color:#b8860b>total</span><span style=color:#666>=</span><span style=color:#666>25</span>
INFO <span style=color:#666>[</span>09-14|10:45:59.166<span style=color:#666>]</span> Allocated cache and file handles         <span style=color:#b8860b>database</span><span style=color:#666>=</span>/home/pi/NodeD/data/geth/chaindata <span style=color:#b8860b>cache</span><span style=color:#666>=</span><span style=color:#666>16</span> <span style=color:#b8860b>handles</span><span style=color:#666>=</span><span style=color:#666>16</span>
INFO <span style=color:#666>[</span>09-14|10:45:59.215<span style=color:#666>]</span> Writing custom genesis block 
INFO <span style=color:#666>[</span>09-14|10:45:59.234<span style=color:#666>]</span> Persisted trie from memory database      <span style=color:#b8860b>nodes</span><span style=color:#666>=</span><span style=color:#666>5</span> <span style=color:#b8860b>size</span><span style=color:#666>=</span>819.00B <span style=color:#b8860b>time</span><span style=color:#666>=</span>16.193125ms <span style=color:#b8860b>gcnodes</span><span style=color:#666>=</span><span style=color:#666>0</span> <span style=color:#b8860b>gcsize</span><span style=color:#666>=</span>0.00B <span style=color:#b8860b>gctime</span><span style=color:#666>=</span>0s <span style=color:#b8860b>livenodes</span><span style=color:#666>=</span><span style=color:#666>1</span> <span style=color:#b8860b>livesize</span><span style=color:#666>=</span>0.00B
INFO <span style=color:#666>[</span>09-14|10:45:59.239<span style=color:#666>]</span> Successfully wrote genesis state         <span style=color:#b8860b>database</span><span style=color:#666>=</span>chaindata                          <span style=color:#b8860b>hash</span><span style=color:#666>=</span>7d00b6…27b2d4
INFO <span style=color:#666>[</span>09-14|10:45:59.240<span style=color:#666>]</span> Allocated cache and file handles         <span style=color:#b8860b>database</span><span style=color:#666>=</span>/home/pi/NodeD/data/geth/lightchaindata <span style=color:#b8860b>cache</span><span style=color:#666>=</span><span style=color:#666>16</span> <span style=color:#b8860b>handles</span><span style=color:#666>=</span><span style=color:#666>16</span>
INFO <span style=color:#666>[</span>09-14|10:45:59.265<span style=color:#666>]</span> Writing custom genesis block 
INFO <span style=color:#666>[</span>09-14|10:45:59.269<span style=color:#666>]</span> Persisted trie from memory database      <span style=color:#b8860b>nodes</span><span style=color:#666>=</span><span style=color:#666>5</span> <span style=color:#b8860b>size</span><span style=color:#666>=</span>819.00B <span style=color:#b8860b>time</span><span style=color:#666>=</span>596.146µs   <span style=color:#b8860b>gcnodes</span><span style=color:#666>=</span><span style=color:#666>0</span> <span style=color:#b8860b>gcsize</span><span style=color:#666>=</span>0.00B <span style=color:#b8860b>gctime</span><span style=color:#666>=</span>0s <span style=color:#b8860b>livenodes</span><span style=color:#666>=</span><span style=color:#666>1</span> <span style=color:#b8860b>livesize</span><span style=color:#666>=</span>0.00B
INFO <span style=color:#666>[</span>09-14|10:45:59.271<span style=color:#666>]</span> Successfully wrote genesis state         <span style=color:#b8860b>database</span><span style=color:#666>=</span>lightchaindata                          <span style=color:#b8860b>hash</span><span style=color:#666>=</span>7d00b6…27b2d4
</code></pre></div><p><strong>以下步骤在四个设备上都要执行</strong></p><p>在各自设备Node目录下创建start.sh脚本用于启动节点，脚本基本内容如下</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#080>#!/bin/bash
</span><span style=color:#080></span><span style=color:#b8860b>PRIVATE_CONFIG</span><span style=color:#666>=</span>ignore nohup geth --datadir data --nodiscover --istanbul.blockperiod <span style=color:#666>5</span> --syncmode full --mine --minerthreads <span style=color:#666>1</span> --verbosity <span style=color:#666>5</span> --networkid <span style=color:#666>10</span> --rpc --rpcaddr 0.0.0.0 --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum,istanbul --ws --wsorigins<span style=color:#666>=</span><span style=color:#b44>&#34;*&#34;</span> --wsaddr 0.0.0.0 --emitcheckpoints --port <span style=color:#666>30303</span> 2&gt;&gt;node.log &amp;
</code></pre></div><p>查找是否有残留启动的geth进程，若有，杀掉该进程</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>See <span style=color:#a2f;font-weight:700>if</span> the any geth nodes are running.
$ ps | grep geth
Kill geth processes
$ killall -INT geth
</code></pre></div><p>授予start.sh脚本执行权限，执行该脚本</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>.... 跳转到脚本所在目录
$ chmod +x start.sh
$ ./start.sh
</code></pre></div><p>执行完后查找geth进程是否启动，并执行<code>geth attach</code>命令接入geth控制台</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ps | grep geth
 <span style=color:#666>16877</span> pts/0    00:00:01 geth
</code></pre></div><p>接下来可在任一设备的节点目录下使用<code>geth attach</code>命令接入geth控制台执行操作</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ geth attach data/geth.ipc
WARN <span style=color:#666>[</span>09-14|11:00:13.142<span style=color:#666>]</span> Sanitizing cache to Go<span>&#39;</span>s GC limits       <span style=color:#b8860b>provided</span><span style=color:#666>=</span><span style=color:#666>1024</span> <span style=color:#b8860b>updated</span><span style=color:#666>=</span><span style=color:#666>655</span>
Welcome to the Geth JavaScript console!

instance: Geth/v1.8.18-stable-c894c2d7<span style=color:#666>(</span>quorum-v2.2.5<span style=color:#666>)</span>/linux-amd64/go1.11.12
coinbase: 0x93c20b1ffa9bf8738bf194d5203e3d2e2a48428d
at block: <span style=color:#666>0</span> <span style=color:#666>(</span>Sat, <span style=color:#666>14</span> Sep <span style=color:#666>2019</span> 10:05:28 CST<span style=color:#666>)</span>
 datadir: /home/shuzang/istanbul/NodeA/data
 modules: admin:1.0 debug:1.0 eth:1.0 istanbul:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0

&gt; 
</code></pre></div><p>在NodeA的geth控制台使用<code>admin.peers</code>命令查看已连接节点，可以看到NodeC和NodeD都已接入。NodeB设备此时未启动，所以没有接入。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span>&gt;</span> <span>a</span><span>d</span><span>m</span><span>i</span><span>n</span><span>.</span><span>p</span><span>e</span><span>e</span><span>r</span><span>s</span>
[{
    <span>c</span><span>a</span><span>p</span><span>s</span><span>:</span> <span>[</span><span style=color:green;font-weight:700>&#34;istanbul/64&#34;</span><span>]</span>,
    <span>e</span><span>n</span><span>o</span><span>d</span><span>e</span><span>:</span> <span style=color:green;font-weight:700>&#34;enode://214dce3278a2b45fb0bf2a1d53c24eb213c5cbb08307e842feab0202cad4f685c5c62a4197d29318f07eb813bf4189db05096b551849039bf81fb74f0211320f@192.168.191.5:45822&#34;</span>,
    <span>i</span><span>d</span><span>:</span> <span style=color:green;font-weight:700>&#34;5e62fd3b39e5ae259d604f90350686ae7615e87a046fc4261fe58fda3872aa65&#34;</span>,
    <span>n</span><span>a</span><span>m</span><span>e</span><span>:</span> <span style=color:green;font-weight:700>&#34;Geth/v1.8.18-stable(quorum-v2.2.5)/linux-arm/go1.11.6&#34;</span>,
    <span>n</span><span>e</span><span>t</span><span>w</span><span>o</span><span>r</span><span>k</span><span>:</span> <span>{</span>
      <span>i</span><span>n</span><span>b</span><span>o</span><span>u</span><span>n</span><span>d</span><span>:</span> <span>t</span><span>r</span><span>u</span><span>e</span><span>,</span>
      <span>l</span><span>o</span><span>c</span><span>a</span><span>l</span><span>A</span><span>d</span><span>d</span><span>r</span><span>e</span><span>s</span><span>s</span><span>:</span> <span style=color:green;font-weight:700>&#34;192.168.191.2:30303&#34;</span>,
      <span>r</span><span>e</span><span>m</span><span>o</span><span>t</span><span>e</span><span>A</span><span>d</span><span>d</span><span>r</span><span>e</span><span>s</span><span>s</span><span>:</span> <span style=color:green;font-weight:700>&#34;192.168.191.5:45822&#34;</span>,
      <span>s</span><span>t</span><span>a</span><span>t</span><span>i</span><span>c</span><span>:</span> <span>f</span><span>a</span><span>l</span><span>s</span><span>e</span><span>,</span>
      <span>t</span><span>r</span><span>u</span><span>s</span><span>t</span><span>e</span><span>d</span><span>:</span> <span>f</span><span>a</span><span>l</span><span>s</span><span>e</span>
    },
    <span>p</span><span>r</span><span>o</span><span>t</span><span>o</span><span>c</span><span>o</span><span>l</span><span>s</span><span>:</span> {
      <span>i</span><span>s</span><span>t</span><span>a</span><span>n</span><span>b</span><span>u</span><span>l</span><span>:</span> <span>{</span>
        <span>d</span><span>i</span><span>f</span><span>f</span><span>i</span><span>c</span><span>u</span><span>l</span><span>t</span><span>y</span><span>:</span> <span>1</span><span>,</span>
        <span>h</span><span>e</span><span>a</span><span>d</span><span>:</span> <span style=color:green;font-weight:700>&#34;0x7d00b604f84c3962821cecbf007d8cf0c3e185d6c3b12a901ec4d996d927b2d4&#34;</span>,
        <span>v</span><span>e</span><span>r</span><span>s</span><span>i</span><span>o</span><span>n</span><span>:</span> <span>6</span><span>4</span>
      }
    <span>}</span>
<span>}</span>, {
    <span>c</span><span>a</span><span>p</span><span>s</span><span>:</span> <span>[</span><span style=color:green;font-weight:700>&#34;istanbul/64&#34;</span><span>]</span>,
    <span>e</span><span>n</span><span>o</span><span>d</span><span>e</span><span>:</span> <span style=color:green;font-weight:700>&#34;enode://cb50baa67204df2246b143e2982e40a89b2924e5c19e2834876c34042f0a81a2e2604ab210d19a048762f5355258d9840932ba868227857d928495d398c04af0@192.168.191.4:47390&#34;</span>,
    <span>i</span><span>d</span><span>:</span> <span style=color:green;font-weight:700>&#34;c31b4abe77e8a91a1a03d06ff22670e572a42729a2c10fb26f57bba46cbc3a42&#34;</span>,
    <span>n</span><span>a</span><span>m</span><span>e</span><span>:</span> <span style=color:green;font-weight:700>&#34;Geth/v1.8.18-stable(quorum-v2.2.5)/linux-arm/go1.11.6&#34;</span>,
    <span>n</span><span>e</span><span>t</span><span>w</span><span>o</span><span>r</span><span>k</span><span>:</span> <span>{</span>
      <span>i</span><span>n</span><span>b</span><span>o</span><span>u</span><span>n</span><span>d</span><span>:</span> <span>t</span><span>r</span><span>u</span><span>e</span><span>,</span>
      <span>l</span><span>o</span><span>c</span><span>a</span><span>l</span><span>A</span><span>d</span><span>d</span><span>r</span><span>e</span><span>s</span><span>s</span><span>:</span> <span style=color:green;font-weight:700>&#34;192.168.191.2:30303&#34;</span>,
      <span>r</span><span>e</span><span>m</span><span>o</span><span>t</span><span>e</span><span>A</span><span>d</span><span>d</span><span>r</span><span>e</span><span>s</span><span>s</span><span>:</span> <span style=color:green;font-weight:700>&#34;192.168.191.4:47390&#34;</span>,
      <span>s</span><span>t</span><span>a</span><span>t</span><span>i</span><span>c</span><span>:</span> <span>f</span><span>a</span><span>l</span><span>s</span><span>e</span><span>,</span>
      <span>t</span><span>r</span><span>u</span><span>s</span><span>t</span><span>e</span><span>d</span><span>:</span> <span>f</span><span>a</span><span>l</span><span>s</span><span>e</span>
    },
    <span>p</span><span>r</span><span>o</span><span>t</span><span>o</span><span>c</span><span>o</span><span>l</span><span>s</span><span>:</span> {
      <span>i</span><span>s</span><span>t</span><span>a</span><span>n</span><span>b</span><span>u</span><span>l</span><span>:</span> <span>{</span>
        <span>d</span><span>i</span><span>f</span><span>f</span><span>i</span><span>c</span><span>u</span><span>l</span><span>t</span><span>y</span><span>:</span> <span>1</span><span>,</span>
        <span>h</span><span>e</span><span>a</span><span>d</span><span>:</span> <span style=color:green;font-weight:700>&#34;0x7d00b604f84c3962821cecbf007d8cf0c3e185d6c3b12a901ec4d996d927b2d4&#34;</span>,
        <span>v</span><span>e</span><span>r</span><span>s</span><span>i</span><span>o</span><span>n</span><span>:</span> <span>6</span><span>4</span>
      }
    <span>}</span>
<span>}</span>]
</code></pre></div><p>至此私链网络搭建完毕，之后交易和合约部署都可通过geth控制台进行</p><h2 id=五-总结>五. 总结</h2><p>由于网络质量问题，区块链共识无法正常运行，合约部署无法完成。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>INFO <span style=color:#666>[</span>09-14|10:56:00.419<span style=color:#666>]</span> Commit new mining work                   <span style=color:#b8860b>number</span><span style=color:#666>=</span><span style=color:#666>1</span> <span style=color:#b8860b>sealhash</span><span style=color:#666>=</span>1305ae…019d90 <span style=color:#b8860b>uncles</span><span style=color:#666>=</span><span style=color:#666>0</span> <span style=color:#b8860b>txs</span><span style=color:#666>=</span><span style=color:#666>0</span> <span style=color:#b8860b>gas</span><span style=color:#666>=</span><span style=color:#666>0</span> <span style=color:#b8860b>fees</span><span style=color:#666>=</span><span style=color:#666>0</span> <span style=color:#b8860b>elapsed</span><span style=color:#666>=</span>556.954µs
TRACE<span style=color:#666>[</span>09-14|10:56:00.420<span style=color:#666>]</span> Dial error                               <span style=color:#b8860b>task</span><span style=color:#666>=</span><span style=color:#b44>&#34;staticdial 5e62fd3b39e5ae25 192.168.191.5:30303&#34;</span> <span style=color:#b8860b>err</span><span style=color:#666>=</span><span style=color:#b44>&#34;dial tcp 192.168.191.5:30303: connect: connection refused&#34;</span>
DEBUG<span style=color:#666>[</span>09-14|10:56:00.421<span style=color:#666>]</span> Can<span>&#39;</span>t resolve node                       <span style=color:#b8860b>id</span><span style=color:#666>=</span>0x8e6a40         <span style=color:#b8860b>err</span><span style=color:#666>=</span><span style=color:#b44>&#34;discovery is disabled&#34;</span>
TRACE<span style=color:#666>[</span>09-14|10:56:00.421<span style=color:#666>]</span> Dial task <span style=color:#a2f;font-weight:700>done</span>                           <span style=color:#b8860b>task</span><span style=color:#666>=</span><span style=color:#b44>&#34;staticdial 5e62fd3b39e5ae25 192.168.191.5:30303&#34;</span>
TRACE<span style=color:#666>[</span>09-14|10:56:00.420<span style=color:#666>]</span> handleRequest                            <span style=color:#b8860b>address</span><span style=color:#666>=</span>0x93C20b1ffA9BF8738BF194d5203e3D2E2A48428d <span style=color:#b8860b>state</span><span style=color:#666>=</span><span style=color:#b44>&#34;Accept request&#34;</span> <span style=color:#b8860b>seq</span><span style=color:#666>=</span><span style=color:#666>1</span> <span style=color:#b8860b>number</span><span style=color:#666>=</span><span style=color:#666>1</span> <span style=color:#b8860b>hash</span><span style=color:#666>=</span>23cc4d…b11876
TRACE<span style=color:#666>[</span>09-14|10:56:00.422<span style=color:#666>]</span> Dial error                               <span style=color:#b8860b>task</span><span style=color:#666>=</span><span style=color:#b44>&#34;staticdial c31b4abe77e8a91a 192.168.191.4:30303&#34;</span> <span style=color:#b8860b>err</span><span style=color:#666>=</span><span style=color:#b44>&#34;dial tcp 192.168.191.4:30303: connect: connection refused&#34;</span>
</code></pre></div><p>主要原因估计是PC上的节点装在了虚拟机里，虚拟机又使用桥接模式，导致最后丢包率和延迟都比较高。</p><p><a href=https://www.ywlib.com/archives/109.html>解决Hyper-V内虚拟机网络延迟高的问题(ping延时大)</a></p><h2 id=附录-树莓派安装-quourm-节点>附录 树莓派安装 quourm 节点</h2><p>在熟悉了树莓派并和虚拟机顺利组网以后，首要面临的事情就是在树莓派中安装quorum节点，由于暂时不使用隐私保护功能，不安装隐私管理器<code>Tessera</code>或<code>Constellation</code>。需要安装的只包括：</p><ul><li>quorum的客户端geth</li><li>Istanbul BFT共识配置工具istanbul-tool</li></ul><h3 id=交叉编译20190909>交叉编译（2019.09.09）</h3><p><a href=https://github.com/jpmorganchase/quorum>quorum项目</a>没有提供可用于arm架构的二进制包，只能自己编译。然而，在树莓派中直接进行编译存在两个问题</p><ol><li>会占用很多不必要的空间，quorum项目文件编译后大小在360M以上</li><li>编译istanbul-tool依赖于golang的某些包，需要访问google，很多ip无法访问。</li></ol><p>因此，最终选择了在PC中进行交叉编译，幸运的是，由于quorum的源项目ethereum可以交叉编译，quorum继承了交叉编译的功能。文档仍然需要看<a href=https://github.com/ethereum/go-ethereum/wiki/Cross-compiling-Ethereum>Cross compiling Ethereum</a>。交叉编译依赖于名为<code>xgo</code>的包，而这个包依赖于Docker和Go，因此，交叉编译之前需要先安装它们。</p><p><em>注：交叉编译在Ubuntu18.04系统下进行。</em></p><p>安装golang</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo snap install go --classic
$ go version
</code></pre></div><p><a href=https://docs.docker.com/install/linux/docker-ce/ubuntu/>安装docker(使用脚本)</a></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl -fsSL https://get.docker.com -o get-docker.sh
$ sudo sh get-docker.sh

&lt;output truncated&gt;
<span style=color:#080;font-style:italic># 想在非root用户下运行，需要将用户添加到docker group。执行如下命令</span>
$ sudo usermod -aG docker your-user
</code></pre></div><p>下载quorum</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ git clone https://github.com/jpmorganchase/quorum.git
</code></pre></div><p>执行交叉编译</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ <span style=color:#a2f>cd</span> quorum
$ make geth-linux-arm-7
$ <span style=color:#a2f>cd</span> build/bin
<span style=color:#080;font-style:italic># 在该目录下可以找到编译后的geth文件</span>
</code></pre></div><p>心态爆炸，交叉编译后的geth在树莓派中无法执行，Ubuntu18.04下原本编译完直接放到/usr/local/bin下面即可使用，raspbian中当我放到同样的目录下不起作用，也不知道是交叉编译失败了还是raspbian系统不支持。考虑到raspbian基于Debian，现在不知道Debian应该把可执行文件放在哪里，网上找了很久没找到相关资料。(交叉编译其实可以，直接跳到文章最后可看到方法)</p><h3 id=ubuntu-mate0910-am>Ubuntu mate（09.10 am）</h3><p>quorum的issue中有个项目组的<a href=https://github.com/jpmorganchase/quorum/issues/661>回答</a>，其中说quorum运行在树莓派中是肯定可以的，这一点终于可以放心，还推荐用Ubuntu，那就试试。</p><blockquote><p>“Yes. Whilst I haven&rsquo;t tried it, I&rsquo;m aware that folks have done this and you can find articles on the internet describing how to do it for Ethereum (Quorum will be the same). My suggestion would be to install Ubuntu on the Rasberry and follow the normal steps for building Quorum.”</p></blockquote><p><a href=https://www.raspberrypi.org/downloads/>树莓派官网</a>提供的Ubuntu可用镜像有三种：Ubuntu Mate，Ubuntu Core，Ubuntu Server。看到Ubuntu Mate的种种特性，我动心了，看起来好像是专门定制的。</p><p><a href=https://ubuntu-mate.org/raspberry-pi/>Ubuntu Mate说明及下载</a>，选择的镜像是</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Raspberry Pi(recommended)
For aarch32(ARMv7)computers,like:
- Raspberry Pi Model B 2
- Raspberry Pi Model B 3
- Raspberry Pi Model B 3+
</code></pre></div><p>下载，镜像写入，根目录预先建立<code>ssh</code>和<code>wpa_supplicant.conf</code>文件，插入树莓派，启动运行，扫描不到ip，看起来WiFi没法自动联网。通过网线接到PC上共享网络，ssh访问被拒，接到路由器上一样不行。找资料，关于Ubuntu mate的资料比较少，最终在<a href=https://ubuntu-mate.org/raspberry-pi/>官方下载页-Additional feature</a>找到一个对特性的说明，称Ubuntu mate没有像raspbian的pi账户一样预定义的用户账户，所有的配置需要在第一次启动时手动完成，ssh预先也没有安装，需要启动后自己安装<code>openssh-server</code>并启用。完了，彻底崩溃，本来没有用户账户就无法登录，连ssh都没有，第一次必须得用屏幕了。屏幕，我没有。。。</p><p>考虑到笔记本电脑上有个HDMI接口，买线总比买屏幕便宜，跑到商店买了根双头HDMI线。回来一试，没用，网上说是因为笔记本的HDMI只能输出信号，没法输入，因此不能作为HDMI屏幕使用。转眼又看到了VGA接口，这个怎么样，结果一查，HDMI转VGA也没用，笔记本的VGA同样只有输出功能，平板，手机全都不行，不能作为显示设备，最多只能用ssh连接。</p><p>台式机的显示器总行了吧，资料上说要自带电源，怕烧坏树莓派。没事，台式的显示器本来就接电源线。又去店里换一个HDMI转VGA的线，是店里唯一的线，结果是坏的，把线接到树莓派上没有反应，提示<code>请检查线缆</code>而不是<code>无信号输入</code>，拿笔记本试了一下，果然不行，完全检测不到第二屏幕。换！店里没线了怎么办，本来想换HDMI转DVI的，因为显示器后面还有个DVI接口，但店员小哥不推荐，说是用DVI的少，最后拿了HDMI转VGA母口的线，又多买了一根双头VGA线，亏到爆。</p><p>不过，总算好使了。</p><p>当在显示器上看到Ubuntu mate的界面时我是激动的，太不容易了。初始配置之后还需要进行系统安装，怪不得没法直接进入。但是路由器的WiFi接入不了，或者连接后没法上网，完全没有头绪，只好先用手机开了热点，这倒是没问题。</p><p>把之前交叉编译的<code>geth</code>文件拷贝到了Ubuntu mate，放到<code>/usr/local/bin</code>目录下，运行<code>geth version</code>测试，倒是可以了，可惜屏幕打印的文本乱码。重新启动了一下树莓派，结果无限循环启动。初始界面提示如下</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Driver &#39;sdhost-bcm2835&#39; already registered, aborting...
</code></pre></div><p>论坛上也有人遇到了这个<a href=https://ubuntu-mate.community/t/raspberry-pi-3-model-b-plus-ubuntu-mate-installation-error-driver-sdhost-bcm2835-already-registered-aborting/19300>问题</a>，但从去年11月到今年5月，回帖的所有人都遇到同样的问题而没有办法解决，我已经放弃了。</p><h3 id=raspbian下自编译quorum0910-pm>Raspbian下自编译quorum(09.10 pm)</h3><p>树莓派上编译使用quorum的人不多，但编译ethereum的人绝对不少，现在想起来，终于意识到一件事，大部分人还是在raspbian系统下编译使用的，既然ethereum的<code>geth</code>客户端可以，quorum没道理不行。有可能不是系统的问题，因为raspbian和ubuntu其实都属于基于Debian的发行版，那就是交叉编译问题了。找不到哪里出的错，干脆直接在Raspbian下编译一次quorum吧，空间占用多一点就多一点，还是足够的，唯一的问题只有翻墙，但这是没办法的事情，而且<code>geth</code>的编译暂时还不需要，<code>istanbul-tool</code>才需要。</p><blockquote><p>注：其实raspbian下翻墙试过了，我有surfshark的账号，官方也给了步骤，<a href=https://support.surfshark.com/hc/en-us/articles/360013425373-How-to-set-up-Surfshark-VPN-on-Raspberry-Pi>How to set up Surfshark VPN on Raspberry Pi</a>，但最后一步连接总是出错，错误提示为</p><p>TLS Error: TLS handshake failed</p><p>网上关于这个Error的问题不少，但都没起作用，就放弃了。</p></blockquote><p>重新写入了之前备份的raspbian镜像（备份真的很有用，能省好多事儿）。启动树莓派，使用预定义的静态ip登录，安装go，下载github上的quorum项目(主要是这里直接下载比<code>git clone</code>快多了)。执行编译，注意使用<code>sudo make all</code>，因为编译需要分配存储空间，不给权限过不了。</p><p>树莓派卡死了。。。</p><p>重启了一次，第二次又卡死了，看来不是意外，应该是编译出了问题，果然，等了很久后，编译退出，系统正常了，但出现了错误提示，是一个存储问题。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback> running gcc failed: fork/exec /usr/bin/gcc: cannot allocate memory
</code></pre></div><p>Ethereum的论坛有人在编译时遇到了同样的问题，<a href=https://ethereum.stackexchange.com/questions/12222/installing-geth-on-raspberry-pi-3-cannot-allocate-memory-error>Installing geth on Raspberry Pi 3 - cannot allocate memory error</a>，回帖提到是因为编译所需的内存不够的缘故，建议杀掉内存占用大而且不用的进程。使用<code>free -h</code>查看</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>              total        used        free      shared  buff/cache   available
Mem:          926Mi       119Mi       575Mi       7.0Mi       231Mi       744Mi
Swap:          99Mi          0B        99Mi
</code></pre></div><p>不算少啊，700多M呢，再用<code>top</code>命令看进程，并按<code>M</code>键按内存占用排序，发现杀哪个进程都不合适。回帖中还有人提到可以调整交换空间大小，就是第二行的Swap，树莓派默认100M，可以调大点，问题的说明及解决方案见<a href=https://raspberrypi.stackexchange.com/questions/70/how-to-set-up-swap-space>How to set up swap space</a>。</p><p>树莓派使用<code>dphys-swapfile</code>文件定义交换空间大小，打开配置文件</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$ sudo nano /etc/dphys-swapfile
</code></pre></div><p>启用内容只有一行</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>CONF_SWAPSIZE=100
</code></pre></div><p>代表默认100M交换空间大小，把数值改成合适的内容，我直接改了1024。然后重新启用新的配置文件。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$ sudo /etc/init.d/dphys-swapfile restart
</code></pre></div><p>完成后再用<code>free -h</code>命令查看交换空间大小就变了，此时重新编译，编译速度会大大加快，等待一段时间后，编译顺利执行完毕。将编译得到的文件复制到/usr/local/bin目录下。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo cp build/bin/geth /usr/local/bin
$ sudo cp build/bin/bootnode /usr/local/bin
<span style=color:#080;font-style:italic># 验证</span>
$ geth version
</code></pre></div><p>成功。</p><h3 id=istantul-tool0911-am>istantul-tool(09.11 am)</h3><p>istantul-tool的编译毫无办法，编译过程要访问google，有些ip无法访问，但既然这里编译没有指明针对arm架构，明天把虚拟机编译好的文件拿过来试试。</p><p>Linux编译得到的istanbul文件在树莓派中无法执行，错误提示为</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>-bash: ./istanbul: cannot execute binary file: Exec format error
</code></pre></div><p>使用<code>file istanbul</code>命令查看文件信息</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>istanbul: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64                                                                                                                        .so.2, for GNU/Linux 3.2.0, Go BuildID=Whu77pcg5_4qdJyzC6lH/RiHbDbxGfs3BFqYFYhdk/Uvgfkwy9en1ShuGpCcPB/qCr7Qg3bewybrm4                                                                                                                        vmE3B, BuildID[sha1]=588353ce35513ef4a2d9695f458a338e226093b1, not stripped
</code></pre></div><p>x86-64的，看来还是架构相关，项目本身没有提供对arm的编译功能，没有办法了。不过有可能不需要在树莓派中运行，我们只需要在作为主节点的虚拟机利用它生成各节点数据，然后拷贝到树莓派中就行。</p><h3 id=运行geth文件0911-am>运行geth文件（09.11 am）</h3><p>直接拷贝编译的geth文件到另一个树莓派，并使用<code>cp</code>命令复制到/usr/local/bin目录无法执行，提示</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>-bash: /usr/local/bin/geth: Permission denied
</code></pre></div><p>是因为没有执行权限，使用<code>chmod</code>命令授予权限即可顺利执行</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ <span style=color:#a2f>cd</span> quorum
$ sudo cp build/bin/geth /usr/local/bin
$ sudo chmod +x /usr/local/bin/geth
$ geth version
WARN <span style=color:#666>[</span>09-11|03:13:38.840<span style=color:#666>]</span> Sanitizing cache to Go<span>&#39;</span>s GC limits       <span style=color:#b8860b>provided</span><span style=color:#666>=</span><span style=color:#666>1024</span> <span style=color:#b8860b>updated</span><span style=color:#666>=</span><span style=color:#666>308</span>
Geth
Version: 1.8.18-stable
Quorum Version: 2.2.5
Architecture: arm
Protocol Versions: <span style=color:#666>[</span><span style=color:#666>63</span> 62<span style=color:#666>]</span>
Network Id: <span style=color:#666>1337</span>
Go Version: go1.11.6
Operating System: linux
<span style=color:#b8860b>GOPATH</span><span style=color:#666>=</span>
<span style=color:#b8860b>GOROOT</span><span style=color:#666>=</span>/usr/lib/go-1.11
</code></pre></div><p>这样看来，交叉编译的结果也不是因为系统不支持，应该也是没有执行权限，下面是使用geth version命令测试交叉编译的geth的结果。</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>WARN <span style=color:#666>[</span>09-11|03:27:52.671<span style=color:#666>]</span> Sanitizing cache to Go<span>&#39;</span>s GC limits       <span style=color:#b8860b>provided</span><span style=color:#666>=</span><span style=color:#666>1024</span>                                      <span style=color:#b8860b>updated</span><span style=color:#666>=</span><span style=color:#666>308</span>
Geth
Version: 1.8.18-stable
Git Commit: 7e87e403407fcb3b3c417739eef2fe1dae923add
Quorum Version: 2.2.5
Architecture: arm
Protocol Versions: <span style=color:#666>[</span><span style=color:#666>63</span> 62<span style=color:#666>]</span>
Network Id: <span style=color:#666>1337</span>
Go Version: go1.12
Operating System: linux
<span style=color:#b8860b>GOPATH</span><span style=color:#666>=</span>
<span style=color:#b8860b>GOROOT</span><span style=color:#666>=</span>/usr/local/go
</code></pre></div><p>走了好多弯路。。。原来一开始的结果就可以。</p></div><footer class=post-footer><div class=post-tags><a href=/tags/%e7%a7%91%e7%a0%94%e8%ae%b0%e5%bd%95 rel=tag title=科研记录>#科研记录#</a></div><div class=addthis_inline_share_toolbox></div><div class=post-nav><div class=article-copyright><div class=article-copyright-info><p><span>声明：</span>研究记录4-利用虚拟机搭建实验平台(失败)</p><p><span>链接：</span>https://shuzang.github.io/2019/09/using-virtual-machine-to-build-experimental-platform/</p><p><span>作者：</span>书藏</p><p><span>声明： </span>本博客文章除特别声明外，均采用 <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank style=text-decoration:underline>CC BY-NC-SA 3.0</a>许可协议，转载请注明出处！</p></div></div><div class=clear></div></div><div class=reward-qr-info><div>创作实属不易，如有帮助，那就打赏博主些许茶钱吧 ^_^</div><button id=rewardButton disable=enable onclick="var qr=document.getElementById('QR');if(qr.style.display==='none'){qr.style.display='block';}else{qr.style.display='none'}">
<span>赏</span></button><div id=QR style=display:none><div id=wechat style=display:inline-block><img id=wechat_qr src=/img/wechat-pay.png alt="WeChat Pay"><p>微信打赏</p></div><div id=alipay style=display:inline-block><img id=alipay_qr src=/img/ali-pay.png alt=Alipay><p>支付宝打赏</p></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=https://shuzang.github.io/2019/09/golang-basic-grammar-1-background-and-preliminary-exploration/ rel=next title=Golang语法基础1-背景与初探><i class="fa fa-chevron-left"></i>Golang语法基础1-背景与初探</a></div><div class="post-nav-prev post-nav-item"><a href=https://shuzang.github.io/2019/09/vmware-usage/ rel=prev title=VMware虚拟机使用技巧>VMware虚拟机使用技巧
<i class="fa fa-chevron-right"></i></a></div></div><div id=wcomments></div></footer></article></section></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target=post-toc-wrap>文章目录</li><li class=sidebar-nav-overview data-target=site-overview>站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src=/images/avatar.png alt=书藏><p class=site-author-name itemprop=name>书藏</p><p class="site-description motion-element" itemprop=description></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=/post/><span class=site-state-item-count>334</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>7</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>23</span>
<span class=site-state-item-name>标签</span></a></div></nav><div class="links-of-author motion-element"><span class=links-of-author-item><a href=https://github.com/shuzang/ target=_blank title=GitHub><i class="fa fa-fw fa-github"></i>GitHub</a></span>
<span class=links-of-author-item><a href="https://www.douban.com/people/159916010/?_i=9150521DKS5bK1" target=_blank title=豆瓣><i class="fa fa-fw fa-film"></i>豆瓣</a></span></div><div class="tagcloud-of-blogroll motion-element tagcloud-of-blogroll-inline"><div class=tagcloud-of-blogroll-title><i class="fa fa-fw fa-tags"></i>标签云</div><ul class=tagcloud-of-blogroll-list><li class=tagcloud-of-blogroll-item><a href=/tags/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0>论文笔记</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E4%B9%A6%E8%97%8F%E7%9A%84%E7%94%9F%E6%B4%BB%E5%91%A8%E5%88%8A>书藏的生活周刊</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E7%A7%91%E7%A0%94%E8%AE%B0%E5%BD%95>科研记录</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/go%E8%AF%AD%E6%B3%95>Go语法</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80>计算机基础</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E6%9D%82%E8%B0%88>杂谈</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E5%8C%BA%E5%9D%97%E9%93%BE>区块链</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95>数据结构与算法</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E7%94%9F%E6%B4%BB%E6%8A%80%E8%83%BD>生活技能</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/go%E5%AE%9E%E6%88%98>Go实战</a></li></ul></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class=post-toc><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#一-前言>一. 前言</a></li><li><a href=#二-计算机环境配置>二. 计算机环境配置</a><ul><li><a href=#1-设备和操作系统选择>1. 设备和操作系统选择</a></li><li><a href=#2-静态ip分配>2. 静态ip分配</a></li><li><a href=#3-操作系统设置>3. 操作系统设置</a></li><li><a href=#4-区块链环境配置>4. 区块链环境配置</a></li></ul></li><li><a href=#三-树莓派启动及环境配置>三. 树莓派启动及环境配置</a><ul><li><a href=#1-树莓派启动>1. 树莓派启动</a></li><li><a href=#2-树莓派基本配置>2. 树莓派基本配置</a></li></ul></li><li><a href=#四-私链网络搭建及测试运行>四. 私链网络搭建及测试运行</a></li><li><a href=#五-总结>五. 总结</a></li><li><a href=#附录-树莓派安装-quourm-节点>附录 树莓派安装 quourm 节点</a><ul><li><a href=#交叉编译20190909>交叉编译（2019.09.09）</a></li><li><a href=#ubuntu-mate0910-am>Ubuntu mate（09.10 am）</a></li><li><a href=#raspbian下自编译quorum0910-pm>Raspbian下自编译quorum(09.10 pm)</a></li><li><a href=#istantul-tool0911-am>istantul-tool(09.11 am)</a></li><li><a href=#运行geth文件0911-am>运行geth文件（09.11 am）</a></li></ul></li></ul></nav></div></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=copyright><span class=copyright-year>&copy; 2018 - 2022</span>
<span class=with-love><i class="fa fa-heart"></i></span><span class=copyright-author>书藏的博客</span></div><div class=powered-info><span class=powered-by>Powered by - <a class=powered-link href=//gohugo.io target=_blank title=hugo>Hugo v0.63.2</a></span>
<span class=separator-line>/</span>
<span class=theme-info>Theme by - <a class=powered-link href=//github.com/elkan1788/hugo-theme-next target=_blank>NexT</a></span></div><div class=vistor-info><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><span class=site-uv><i class="fa fa-user"></i><span class=busuanzi-value id=busuanzi_value_site_uv></span></span><span class=separator-line>/</span>
<span class=site-pv><i class="fa fa-eye"></i><span class=busuanzi-value id=busuanzi_value_site_pv></span></span></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i><span id=scrollpercent><span>0</span>%</span></div></div><script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/2.1.4/jquery.min.js></script><script type=text/javascript src=/js/search.js></script><script type=text/javascript src=/js/affix.js></script><script type=text/javascript src=/js/scrollspy.js></script><script type=text/javascript>function detectIE(){var ua=window.navigator.userAgent;var msie=ua.indexOf('MSIE ');var trident=ua.indexOf('Trident/');var edge=ua.indexOf('Edge/');if(msie>0||trident>0||edge>0){return-1;}
return 1;}
function getCntViewHeight(){var docHeight=$('#content').height(),winHeight=$(window).height(),cntViewHeight=(docHeight>winHeight)?(docHeight-winHeight):($(document).height()-winHeight);return cntViewHeight;}
function getScrollbarWidth(){var $div=$('<div />').addClass('scrollbar-measure').prependTo('body');var div=$div[0];var scrollbarWidth=div.offsetWidth-div.clientWidth;$div.remove();return scrollbarWidth;}
function registerBackTop(){var THRESHOLD=50;var $top=$('.back-to-top');$(window).on('scroll',function(){$top.toggleClass('back-to-top-on',window.pageYOffset>THRESHOLD);var scrollTop=$(window).scrollTop();var cntViewHeight=getCntViewHeight();var scrollPercent=(scrollTop)/(cntViewHeight);var scrollPercentRounded=Math.round(scrollPercent*100);var scrollPercentMaxed=(scrollPercentRounded>100)?100:scrollPercentRounded;$('#scrollpercent>span').html(scrollPercentMaxed);});$top.on('click',function(){$("html,body").animate({scrollTop:0,screenLeft:0,},800);});}
function initScrollSpy(){var tocSelector='.post-toc';var $tocElement=$(tocSelector);var activeCurrentSelector='.active-current';$tocElement.on('activate.bs.scrollspy',function(){var $currentActiveElement=$(tocSelector+' .active').last();removeCurrentActiveClass();$currentActiveElement.addClass('active-current');}).on('clear.bs.scrollspy',removeCurrentActiveClass);$('body').scrollspy({target:tocSelector});function removeCurrentActiveClass(){$(tocSelector+' '+activeCurrentSelector).removeClass(activeCurrentSelector.substring(1));}}
function initAffix(){var headerHeight=$('.header-inner').height();var footerOffset=parseInt($('.main').css('padding-bottom'),10);var sidebarTop=headerHeight+10;$('.sidebar-inner').affix({offset:{top:sidebarTop,bottom:footerOffset}});$(document).on('affixed.bs.affix',function(){updateTOCHeight(document.body.clientHeight-100);});}
function initTOCDimension(){var updateTOCHeightTimer;$(window).on('resize',function(){updateTOCHeightTimer&&clearTimeout(updateTOCHeightTimer);updateTOCHeightTimer=setTimeout(function(){var tocWrapperHeight=document.body.clientHeight-100;updateTOCHeight(tocWrapperHeight);},0);});updateTOCHeight(document.body.clientHeight-100);var scrollbarWidth=getScrollbarWidth();$('.post-toc').css('width','calc(100% + '+scrollbarWidth+'px)');}
function updateTOCHeight(height){height=height||'auto';$('.post-toc').css('max-height',height);}
$(function(){var sidebarTop=$('.header-inner').height()+10;$('#sidebar').css({'margin-top':sidebarTop}).show();var sidebarMt=parseInt($('#sidebar').css('margin-top'));var sidebarInHeight=parseInt($('.sidebar-inner').css('height'));var sideHeight=sidebarMt+sidebarInHeight;var contentHeight=$('.content-wrap').height();if(contentHeight<sideHeight){$('.content-wrap').css('min-height',sideHeight);}
$('.site-nav-toggle').on('click',function(){var $siteNav=$('.site-nav');var $toggleLine=$('.toggle');var ON_CLASS_NAME='site-nav-on';var CLOSE_CLASS_NAME='toggle-close';var isSiteNavOn=$siteNav.hasClass(ON_CLASS_NAME);var animateAction=isSiteNavOn?'slideUp':'slideDown';var animateCallback=isSiteNavOn?'removeClass':'addClass';$siteNav.stop()[animateAction]('normal',function(){$siteNav[animateCallback](ON_CLASS_NAME);$toggleLine[animateCallback](CLOSE_CLASS_NAME);});});registerBackTop();initScrollSpy();initAffix();initTOCDimension();$('.sidebar-nav-toc').click(function(){$(this).addClass('sidebar-nav-active');$(this).next().removeClass('sidebar-nav-active');$('.'+$(this).next().attr('data-target')).toggle(500);$('.'+$(this).attr('data-target')).toggle(500);});$('.sidebar-nav-overview').click(function(){$(this).addClass('sidebar-nav-active');$(this).prev().removeClass('sidebar-nav-active');$('.'+$(this).prev().attr('data-target')).toggle(500);$('.'+$(this).attr('data-target')).toggle(500);});});</script><script src=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.js></script><script type=text/javascript>$(function(){$('.post-body').viewer();});</script><script type=text/javascript>$(function(){if(detectIE()>0){$.getScript(document.location.protocol+'//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js',function(){new Waline({el:'#wcomments',visitor:true,avatar:'wavatar',avatarCDN:'https://sdn.geekzu.org/avatar/',avatarForce:!1,wordLimit:'200',placeholder:' 欢迎留下您的宝贵建议，请填写您的昵称和邮箱便于后续交流. ^_^ ',requiredFields:['nick','mail'],serverURL:"Your WalineSerURL",lang:"zh-cn"});});}else{$('#wcomments').html('抱歉，Waline插件不支持IE或Edge，建议使用Chrome浏览器。');}});</script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=Your%20AddthisId"></script><script>(function(){var bp=document.createElement('script');var curProtocol=window.location.protocol.split(':')[0];if(curProtocol==='https'){bp.src='https://zz.bdstatic.com/linksubmit/push.js';}
else{bp.src='http://push.zhanzhang.baidu.com/push.js';}
var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script></body></html>