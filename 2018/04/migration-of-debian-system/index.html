<!doctype html><html lang=zh-cn dir=content/zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=content-security-policy content="upgrade-insecure-requests"><title>系统移植2-Debian系统的移植 - 书藏的博客</title><meta name=keywords content="博客,程序员,区块链，思考,读书,笔记,生活,电影,旅游,"><meta name=author content="书藏"><meta property="og:title" content="系统移植2-Debian系统的移植"><meta property="og:site_name" content="书藏的博客"><meta property="og:image" content="/img/avatar.png"><meta name=title content="系统移植2-Debian系统的移植 - 书藏的博客"><meta name=description content="书藏的个人博客，记录学习的东西，以月刊记录生活"><link rel="shortcut icon" href=/img/favicon.ico><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png><link href=//cdn.bootcdn.net/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css rel=stylesheet type=text/css><link href=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.css rel=stylesheet><link href=/css/main.css rel=stylesheet type=text/css><link href=/css/syntax.css rel=stylesheet type=text/css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-209130979-1"></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-209130979-1 ');</script></head><body itemscope itemtype=http://schema.org/WebPage lang=zh-hans><div class="container one-collumn sidebar-position-left page-home"><div class=headband></div><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle role=button style=opacity:1;top:0><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><div class=multi-lang-switch><i class="fa fa-fw fa-language" style=margin-right:5px></i><a class=lang-link id=zh-cn href=#>中文</a></div><div class=custom-logo-site-title><a href=/ class=brand rel=start><span class=logo-line-before><i></i></span><span class=site-title>书藏的博客</span>
<span class=logo-line-after><i></i></span></a></div><p class=site-subtitle>凡心所向，素履以往</p></div><div class=site-nav-right><div class="toggle popup-trigger" style=opacity:1;top:0><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul id=menu class=menu><li class=menu-item><a href=/ rel=section><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class=menu-item><a href=/post rel=section><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class=menu-item><a href=/about.html rel=section><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于我</a></li><li class="menu-item menu-item-search"><a href=javascript:; class=popup-trigger><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class=site-search><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class=search-icon><i class="fa fa-search"></i></span><span class=popup-btn-close><i class="fa fa-times-circle"></i></span><div class=local-search-input-wrapper><input autocomplete=off placeholder=搜索关键字... spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off></div></div><div id=local-search-result></div></div></div></nav></div></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><section id=posts class=posts-expand><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline"><a class=post-title-link href=https://shuzang.github.io/2018/04/migration-of-debian-system/ itemprop=url>系统移植2-Debian系统的移植</a></h1><div class=post-meta><span class=post-time><i class="fa fa-calendar-o fa-fw"></i><span class=post-meta-item-text>时间：</span>
<time itemprop=dateCreated datetime=2016-03-22T13:04:35+08:00 content="2018-04-11">2018-04-11</time></span>
<span class=post-category>&nbsp; | &nbsp;
<i class="fa fa-folder-o fa-fw"></i><span class=post-meta-item-text>分类：</span>
<span itemprop=about itemscope itemtype=https://schema.org/Thing><a href=/categories/%E7%88%B1%E7%BC%96%E7%A8%8B%E7%88%B1%E6%8A%80%E6%9C%AF%E7%9A%84%E5%AD%A9%E5%AD%90 itemprop=url rel=index style=text-decoration:underline><span itemprop=name>爱编程爱技术的孩子</span></a>
&nbsp;</span></span>
<span>|
<i class="fa fa-file-word-o fa-fw"></i><span class=post-meta-item-text>字数：</span>
<span class=leancloud-world-count>5183 字</span></span>
<span>|
<i class="fa fa-eye fa-fw"></i><span class=post-meta-item-text>阅读：</span>
<span class=leancloud-view-count>11分钟</span></span>
<span id=/2018/04/migration-of-debian-system/ class=leancloud_visitors data-flag-title=系统移植2-Debian系统的移植>|
<i class="fa fa-binoculars fa-fw"></i><span class=post-meta-item-text>阅读次数：</span>
<span class=leancloud-visitors-count></span></span></div></header><div class=post-body itemprop=articleBody><p>Debian 系统的移植总分四部分：u-boot的编译与烧录，Linux内核的编译与烧录，Debian 基本根文件系统的制作、配置与烧录，开发板设置。</p><h2 id=1-u-boot的编译>1. u-boot的编译</h2><p>对应于EMSYM的blurr开发板的u-boot项目使用GitHub进行开源维护，<a href=https://github.com/EMSYM/U-boot>下载地址</a>，我的编译环境为Ubuntu16.04 LTS系统</p><h3 id=11-下载源码>1.1 下载源码</h3><p>方法一：在链接打开后的项目界面依次选择clone or download—>Download ZIP，将源码下载到PC中相应的文件夹（记得解压&mldr;..）</p><p>方法二：采用git命令（须事先安装git）</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ git clone https://github.com/EMSYM/U-boot.git
</code></pre></div><p>注：该链接在选中clone or download后可看到</p><h3 id=12-分支切换>1.2 分支切换</h3><p>在下载好的u-boot项目目录下打开虚拟终端，创建并切换分支</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ git checkout -b v4.1 origin/blurr-4.1.15
</code></pre></div><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_d1bb18bcb403.png alt=创建并切换分支></p><h3 id=13-安装依赖>1.3 安装依赖</h3><p>gcc-arm-linux-gnueabi是我们用到的交叉编译器</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo apt install gcc-arm-linux-gnueabi
$ sudo apt-get install build-essential gcc
</code></pre></div><p>注：Ubuntu缺省情况下，并没有提供C/C++的编译环境，因此还需要手动安装。如果单独安装gcc以及g++比较麻烦，幸运的是，为了能够编译Ubuntu的内核，Ubuntu提供了一个build-essential软件包。因为依赖关系的问题，安装了该软件包，编译c/c++所需要的软件包也都会被安装。因此如果想在Ubuntu中编译c/c++程序，只需要安装该软件包就可以了。</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_8135c2d310f2.png alt=build-essential的依赖关系></p><h3 id=14-开始编译>1.4 开始编译</h3><p>指定核心类型</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ <span style=color:#b8860b>ARCH</span><span style=color:#666>=</span>arm
</code></pre></div><p>生成配置文件（用到Makefile，参阅<a href=https://hacker-yhj.github.io/resources/gun_make.pdf>GNU make中文手册</a>）</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ make mx6dl_blurr_defconfig
</code></pre></div><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_c22b1be42612.png alt=生成配置文件></p><p>指定交叉编译前缀，编译u-boot</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ make <span style=color:#b8860b>CROSS_COMPILE</span><span style=color:#666>=</span>arm-linux-gnueabi- 
</code></pre></div><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_967c5a8d8bba.png alt=编译通过></p><p>执行完上述步骤后，编译即可成功</p><h2 id=2-linux内核编译>2. Linux内核编译</h2><p>同样，对应于blurr开发板的Linux内核项目也在GitHub上开源维护，<a href=https://github.com/EMSYM/linux>项目地址</a></p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_fd26ed77a3ab.png alt=github上的工程></p><h3 id=21-源码下载>2.1 源码下载</h3><p>下载源码的手段与u-boot类似。这里要提醒的是，最好直接Download ZIP，不要clone，因为下载ZIP只有100多M，clone会有一个多G。而这两种手段得到的源码对之后的编译没有影响。（记得解压zip文件）</p><h3 id=22-安装压缩工具lzop>2.2 安装压缩工具lzop</h3><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo apt-get install lzop
</code></pre></div><p>lzop是最后生成时要用到的一个压缩工具，当没有安装此工具就开始编译，过程中会出现一个lozp：not found的错误</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_5665b6610702.png alt="lozp：not fountd"></p><h3 id=23-编译>2.3 编译</h3><p>进入下载好的Linux项目主目录，逐步执行如下命令</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ <span style=color:#a2f>export</span> <span style=color:#b8860b>ARCH</span><span style=color:#666>=</span>arm
$ <span style=color:#a2f>export</span> <span style=color:#b8860b>CROSS_COMPILE</span><span style=color:#666>=</span>arm-linux-gnueabi-
$ make blurr_defconfig
$ make
</code></pre></div><p>前两句的意思是指定芯片的架构以及交叉编译器前缀，然后就开始编译了（之前编译u-boot时已装好交叉编译器），可参考 <a href=http://blog.csdn.net/wl_fln/article/details/7258294>export命令的介绍</a></p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_57171204afb8.png alt=四条指令></p><p>会有一些warning，但不碍事</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/ad7eeaabb67f.png alt=warning></p><p>要等很久&mldr;..</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_cc3a1d8404d3.png alt=编译成功></p><p>完成如上步骤后即可编译完成，我们需要编译得到的zImage文件和imx6dl-blurr.dtb文件位置如下：</p><ul><li><p>zImage：linux-blurr 4.1.15—>arch—>arm—>boot</p></li><li><p>imx6dl-blurr.dtb：linux-blurr 4.1.15—>arch—>arm—>boot—>dts</p></li></ul><p>zImage位置如下图</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_beb1c3962a3d.png alt=zImage></p><p>imx6dl-blurr.dtb直接从上面目录里的dts点进去</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_6488bacf69de.png alt=imx6dl-blurr.dtb></p><h2 id=3-debian-根文件系统的制作与配置>3. Debian 根文件系统的制作与配置</h2><p>该部分内容主要参考官方文档 <a href=https://wiki.debian.org/EmDebian/CrossDebootstrap>EmDebian CrossDebootstrap</a>，方法为QEMU/debootstrap的方法。使用debootstrap工具完成根文件系统的制作，使用QEMU模拟器完成配置工作。</p><h3 id=31-基本说明>3.1 基本说明</h3><p>制作根文件系统的工具常用Debootstrap和Multistrap，制作流程大概分为四个步骤：</p><p>1、从源里下载需要的.deb软件包</p><p>2、解压它们到相应的目标目录</p><p>3、用chroot命令修改该目标目录为根目录</p><p>4、配置脚本，完成安装</p><p>通常，使用debootstrap、cdebootstrap或multistrap完成第一二阶段的工作，QEMU完成第三四阶段的工作。</p><h3 id=32-工具软件安装>3.2 工具软件安装</h3><p>使用如下的命令安装所需要工具软件</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo apt-get install binfmt-support qemu qemu-user-static debootstrap
</code></pre></div><p>debootstrap是根文件系统制作工具，qemu是模拟器，是为了在宿主机上模拟开发板的环境</p><p>接下来的步骤需要以root身份执行，因为debootstrap的工作以及chroot到建好的新系统的目录都需要root权限</p><h3 id=33-根文件系统制作>3.3 根文件系统制作</h3><p>首先选择要引导的目标架构和Debian版本（例如stable、testing或sid）,我们选择开发板对应的arm架构，版本选择Debian9.1,叫做stretch。</p><p>创建一个目录文件，制作好的根文件系统将放在这个目录下。需要提示以后所有对根文件系统的修改都局限在这个目录里，不会影响到宿主机，所以不用担心搞毁你的系统。为了介绍清楚，我们采用“debian_armhf_stretch”作为目录名，但它其实就是rootfs，如果你这样命名的话</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo mkdir debian_armhf_stretch
</code></pre></div><p>制作根文件系统，需要运行debootstrap</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo debootstrap --foreign --arch armhf stretch debian_armhf_stretch http://ftp.debian.org/debian/
</code></pre></div><p>其中<code>debian_armhf_stretch</code>是创建的目录，<code>armhf</code>是目标架构，<code>http://ftp.debian.org/debian</code>是Debian镜像，必需的.deb包将从这里下载。可以随意选择自己喜欢的镜像，只要它有我们要用于的目标架构。<a href=http://www.debian.org/mirror/list>可用的Debian镜像列表</a>，<a href=https://linux.cn/man/man8/debootstrap.8.html>debootstrap命令说明</a></p><p>会运行两次，第一次是从网上下载，第二次就是在debian_armhf_stretch目录下生成bin、sbin这些Linux文件系统目录了。</p><h3 id=34-qemu-配置>3.4 QEMU 配置</h3><p>根文件系统已经创建完成。默认情况下，debootstrap创建的是一个非常小的系统，所以可能需要扩展一下，这个放在后面的配置新系统。</p><p>先复制“qemu-arm-static” 到刚构建的根文件系统中。为了能chroot到目标文件系统，针对目标CPU的qemu模拟器需要从内部访问</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo cp /usr/bin/qemu-arm-static  debian_armhf_stretch/usr/bin
</code></pre></div><p>接下来运行debootstrap的第二个阶段来解压步骤3中安装的所有软件包</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo <span style=color:#b8860b>DEBIAN_FRONTEND</span><span style=color:#666>=</span>noninteractive <span style=color:#b8860b>DEBCONF_NONINTERACTIVE_SEEN</span><span style=color:#666>=</span><span style=color:#a2f>true</span> <span style=color:#b8860b>LC_ALL</span><span style=color:#666>=</span>C <span style=color:#b8860b>LANGUAGE</span><span style=color:#666>=</span>C <span style=color:#b8860b>LANG</span><span style=color:#666>=</span>C chroot debian_armhf_stretch debootstrap/debootstrap --second-stage
</code></pre></div><p>该命令意思是设置一些环境变量,然后切换根目录到debian_armhf_stretch（这个操作是chroot做的，这个命令很有意思），执行目录debian_armhf_stretch/debootstrap下的命令: debootstrap &ndash;second-stage。终端上最后会打印 <code>I: Base system installed successfully.</code>，就说明成功了。</p><p>切换到qemu</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#b8860b>$sudo</span> chroot debian_armhf_stretch
</code></pre></div><p>不过如果这样的话之后的提示都是英文的，想显示中文需要把上面的命令这样输入</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo <span style=color:#b8860b>LANG</span><span style=color:#666>=</span>C.UTF-8 chroot debian_armhf_stretch
</code></pre></div><h2 id=4-新系统配置>4. 新系统配置</h2><p>刚刚创建的新系统需要一些简单的调整以便于你运用它做一些特殊的工作。下面的步骤需要以root权限执行</p><ol><li><p>手动在/etc/apt/sources.list里面添加如下条目</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>deb http://ftp.debian.org/debian/ stretch main contrib non-free
deb-src http://ftp.debian.org/debian/ stretch main contrib non-free
</code></pre></div><p>源的选择是随便的，只要它支持目标平台就行，不过国内<a href=https://lug.ustc.edu.cn/wiki/mirrors/help/debian>中科大的源</a>好用一点，这时候就可以像往常一样使用apt-get install 命令安装其它软件包了。</p></li><li><p>安装xorg和KDE，KDE新版本叫plasma</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo apt-get install xorg
$ sudo apt-get install plasma-desktop
</code></pre></div><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_ff04dfdcef82.png alt=plasma-desktop></p><p>这句执行也是真的久，不要着急，中间可能会自动进入一些配置界面，根据选项自己选就行，如果乱码的话可以选第一个，其实上面设置成中文就没乱码了。</p></li><li><p>安装终端konsole，安装浏览器qupzilla（这是因为Debian9以下不支持chrome），安装文件管理器dolphin，网络管理器plasma-nm</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo apt-get install konsole
$ sudo apt-get install qupzilla
$ sudo apt-get install dolphin
$ sudo apt-get install plasma-nm
</code></pre></div></li><li><p>打开etc文件夹中的fstab文件，在末尾添加</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>/dev/sda / ext4 defaults <span style=color:#666>0</span> <span style=color:#666>1</span>
</code></pre></div></li><li><p>root用户下输入命令</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>chown root:root /usr/bin/sudo
chmod <span style=color:#666>4755</span> /usr/bin
</code></pre></div></li></ol><h2 id=5-烧录工作>5. 烧录工作</h2><p>u-boot，Linux内核和根文件系统都是需要烧录的，下面介绍如何进行这部分工作。首先将SD卡格式化，准备好要烧录的文件</p><ul><li>u-boot：u-boot.imx</li><li>内核：zImage和imx6dl-blurr.dtb</li><li>根文件系统：debian_armhf_stretch</li></ul><h3 id=51-设置sd卡>5.1 设置SD卡</h3><p>SD卡需要创建2个分区，并且在第一个分区之前预留一段空间用于保存u-boot.imx；然后第一个分区设置为fat格式，用于保存内核编译成的两个文件；第二个分区设置为ext4格式，用于保存根文件系统。</p><h4 id=格式化>格式化</h4><p>在分区之前，先将SD卡格式化（可能Windows下格式化方便一点），首先在Linux系统下插入SD卡，查看挂载位置，使用<a href=http://www.linuxidc.com/Linux/2012-06/61872.htm>fdisk</a>命令</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo fdisk -l
</code></pre></div><p>这个命令作用为查看磁盘使用情况的，最后那个即为我们新挂载的SD卡</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_e2b342bb2c91.png alt=查看挂载地址></p><p>从结果输出中可以看到SD卡，挂载位置是/dev/sdb，输入命令</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo fdisk /dev/sdb
</code></pre></div><p>该命令含义为进入分割硬盘模式，这个命令执行结束就可以操作分区了。</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_0b65803507c5.png alt></p><h4 id=删除原有分区>删除原有分区</h4><p>输入m可以获取帮助，显示所有可用命令。先用d 命令删除原来的分区，提示Selected partition，在后面输入要删除的分区号，回车，分区即可删除成功</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_image-20200427153230942.png alt=删除分区></p><p>输入命令p查看此时的分区信息，已变成一整块的磁盘未分区，接下来开始分区</p><h4 id=重新分区>重新分区</h4><p>n命令新建分区，第一次输入p分割为主分区，分区号为1，分区的起始位置和结束位置自己算好填上去，注意分区必以sector为单位，一个sector 为512 bytes，所以不要输不是512整数倍的数。</p><p>n命令新建分区，第二次输入e分割分区，分区号为2，起始位置接着上一个分区的结束位置。</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_bd06ff3756c8.png alt=分区></p><p>p命令查看分区信息，看是否符合预想。w命令保存退出。弹出重新插入SD卡或者重新启动Ubuntu系统，之后再次查看分区信息，这是为了更新分区表给内核，否则看不到分好的区。</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_b3f7856930ad.png alt=再次查看></p><p>格式化新建的分区</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo mkfs.ext4 /dev/sdb2
</code></pre></div><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_81816c5f55ca.png alt></p><p>然后对两个分区格式化</p><p>输入t，选择分区1，将分区1格式化为fat，这里输入6为FAT16，c为FAT32</p><p>输入t，选择分区2，将分区2格式化为ext4格式，输入83即可</p><p>注：这里输入83格式化结束最后查看分区其实显示的是83 Linux，这就已经是ext4格式了，不要觉得自己错了，因为Linux的默认格式就是ext4</p><p>w命令保存</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_823a55d4bfef.png alt=格式化分区></p><h3 id=52-烧录>5.2 烧录</h3><h4 id=u-boot>u-boot</h4><p>执行如下命令，把u-boot弄到SD卡开头预留的那段空间</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo dd <span style=color:#a2f;font-weight:700>if</span><span style=color:#666>=</span>u-boot.imx <span style=color:#b8860b>of</span><span style=color:#666>=</span>/dev/sdb  <span style=color:#b8860b>bs</span><span style=color:#666>=</span><span style=color:#666>512</span> <span style=color:#b8860b>seek</span><span style=color:#666>=</span><span style=color:#666>2</span> ;sync
</code></pre></div><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_image-20200427154449772.png alt></p><p><a href=http://blog.csdn.net/pugu12/article/details/47047341>dd命令的解释</a>，至于为什么要seek=2，跳过头两个块我现在也不懂</p><h4 id=内核>内核</h4><p>把编译好的内核的两个文件zImage和imx6dl-blurr.dtb复制到第一个分区，可以直接鼠标操作</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_image-20200427154551645.png alt></p><h4 id=根文件系统>根文件系统</h4><p>先 fdisk -l 查看第二个分区的位置，是/dev/sdb2。把第二个分区挂载到/mnt下，这里执行成功后把文件放到/mnt下就相当于放到了U盘第二个分区</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo mount /dev/sdb2 /mnt
</code></pre></div><p>然后就在rootfs的当前目录用cp命令复制，意思是将根文件系统的所有内容复制到挂载的目录</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo cp -rf rootfs/.  /mnt
</code></pre></div><p>执行完有必要的话取消挂载</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo umount /mnt
</code></pre></div><h2 id=6-开发板设置>6. 开发板设置</h2><p>确保zImage文件和imx6dl-blurr.dtb文件都已放入SD卡第一个分区，也就是FAT格式的分区中；文件系统解压到SD卡第二个分区，也就是ext4格式的分区中</p><p>注：若之前已经进行到屏幕上出现两只企鹅，此时只需要将解压好文件系统的SD卡插入开发板，上电即可进入命令行界面，若无法进入命令行界面则继续进行下列步骤，</p><ol><li><p>靠近 HDMI接口的地方有个开关，拨动开关到boot一端，设置八位红色开关为0100001</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_image-20200427155128647.png alt></p></li><li><p>将SD卡插入SD3插槽</p></li><li><p>下好窗口调试软件putty（windows或Linux下都可），其它串口调试软件也行，用数据线连接开发板和PC（调试），开发板与屏幕，开发板与电源，开发板与键盘</p></li><li><p>打开设备管理器，找到这个设备，这时候还没有驱动，所以右键更新驱动程序，在网络上查找，第一次可能一直是寻找中，那就关掉重新打开。直到驱动装好，从设备管理器里就可以看到相应的COM口。</p></li><li><p>打开putty，选择serial，将COM1改成上面设备管理器里看到的COM号，speed改为115200，然后最下面点open</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_image-20200427155359810.png alt></p></li><li><p>此时看到串口输出（若没有，请按开发板HDMI口旁边的RESET按钮），按回车进入调试模式，输入如下命令命令</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>setenv bootargs <span style=color:#b44>&#39;console=ttymxc0,115200 root=/dev/mmcblk2p2 init=/sbin/init&#39;</span>
saveenv
<span style=color:#080;font-style:italic>#加载镜像</span>
fatload mmc 1:1 <span style=color:#666>12000000</span> zImage; <span style=color:#080;font-style:italic>#将SD卡分区一的镜像加载到内存地址0x12000000</span>
fatload mmc 1:1 <span style=color:#666>11000000</span> imx6dl-blurr.dtb;
<span style=color:#080;font-style:italic>#加载Device Tree文件</span>
<span style=color:#080;font-style:italic>#启动镜像</span>
bootz <span style=color:#666>12000000</span> - <span style=color:#666>11000000</span>
</code></pre></div><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_image-20200427155557593.png alt></p></li></ol><p>开发板上电，如果SD卡中此时只有u-boot和内核，屏幕上会有两只企鹅，</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_stickpicture.png alt=显示企鹅 style=zoom:33%></p><p>如果根文件系统也已经放进去了，那就会出现登录选项，连接键盘与开发板，输入root，这个是拿到的这个根文件系统就是这个名字，之后即可使用键盘输入各种命令与开发板交互。在命令行使用如下命令可以启动 GUI，然后就进入KDE桌面环境了，Debian系统哦</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_image-20200427160233842.png alt></p><p>注：开发板获得读写权限的方法如下，如果模拟器中已完成此工作则不需要</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ mount rw -o remount /
</code></pre></div><h2 id=7-使用界面>7. 使用界面</h2><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_image-20200427160245617.png alt></p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20180411_image-20200427160256212.png alt></p><h2 id=8-参考>8. 参考</h2><ol><li><p><a href=http://www.cnblogs.com/qiaoqiao2003/p/3738552.html>debian下为arm开发板创建基于debian或emdebian的根文件系统</a></p><p>这篇文章主要是提供一个思路，用工具来制作Debian的根文件系统。</p></li><li><p><a href=http://blog.csdn.net/luoqindong/article/details/42737879>创建基于arm的debian文件系统</a></p><p>主要是因为上面制作的根文件系统直接弄到板子上没网，所以就没法用板子的命令行安装软件，只好借助模拟器在PC上装好一些东西，比如GUI和其它一些软件。这篇文章提供一些模拟器QWMU使用的借鉴</p></li><li><p><a href=http://www.emdebian.org/emdebian/flavours.html>Emdebian</a></p><p>这个就没什么了，主要是区别一下我们用到的嵌入式Debian的源码版本</p></li></ol></div><footer class=post-footer><div class=post-tags><a href=/tags/linux rel=tag title=linux>#linux#</a></div><div class=addthis_inline_share_toolbox></div><div class=post-nav><div class=article-copyright><div class=article-copyright-info><p><span>声明：</span>系统移植2-Debian系统的移植</p><p><span>链接：</span>https://shuzang.github.io/2018/04/migration-of-debian-system/</p><p><span>作者：</span>书藏</p><p><span>声明： </span>本博客文章除特别声明外，均采用 <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank style=text-decoration:underline>CC BY-NC-SA 3.0</a>许可协议，转载请注明出处！</p></div></div><div class=clear></div></div><div class=reward-qr-info><div>创作实属不易，如有帮助，那就打赏博主些许茶钱吧 ^_^</div><button id=rewardButton disable=enable onclick="var qr=document.getElementById('QR');if(qr.style.display==='none'){qr.style.display='block';}else{qr.style.display='none'}">
<span>赏</span></button><div id=QR style=display:none><div id=wechat style=display:inline-block><img id=wechat_qr src=/img/wechat-pay.png alt="WeChat Pay"><p>微信打赏</p></div><div id=alipay style=display:inline-block><img id=alipay_qr src=/img/ali-pay.png alt=Alipay><p>支付宝打赏</p></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=https://shuzang.github.io/2018/04/migration-related-knowledge/ rel=next title=系统移植1-移植相关知识><i class="fa fa-chevron-left"></i>系统移植1-移植相关知识</a></div><div class="post-nav-prev post-nav-item"><a href=https://shuzang.github.io/2018/04/android-system-migration/ rel=prev title=系统移植3-Android系统移植>系统移植3-Android系统移植
<i class="fa fa-chevron-right"></i></a></div></div><div id=wcomments></div></footer></article></section></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target=post-toc-wrap>文章目录</li><li class=sidebar-nav-overview data-target=site-overview>站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src=/images/avatar.png alt=书藏><p class=site-author-name itemprop=name>书藏</p><p class="site-description motion-element" itemprop=description></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=/post/><span class=site-state-item-count>334</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>7</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>23</span>
<span class=site-state-item-name>标签</span></a></div></nav><div class="links-of-author motion-element"><span class=links-of-author-item><a href=https://github.com/shuzang/ target=_blank title=GitHub><i class="fa fa-fw fa-github"></i>GitHub</a></span>
<span class=links-of-author-item><a href="https://www.douban.com/people/159916010/?_i=9150521DKS5bK1" target=_blank title=豆瓣><i class="fa fa-fw fa-film"></i>豆瓣</a></span></div><div class="tagcloud-of-blogroll motion-element tagcloud-of-blogroll-inline"><div class=tagcloud-of-blogroll-title><i class="fa fa-fw fa-tags"></i>标签云</div><ul class=tagcloud-of-blogroll-list><li class=tagcloud-of-blogroll-item><a href=/tags/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0>论文笔记</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E4%B9%A6%E8%97%8F%E7%9A%84%E7%94%9F%E6%B4%BB%E5%91%A8%E5%88%8A>书藏的生活周刊</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E7%A7%91%E7%A0%94%E8%AE%B0%E5%BD%95>科研记录</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/go%E8%AF%AD%E6%B3%95>Go语法</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80>计算机基础</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E6%9D%82%E8%B0%88>杂谈</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E5%8C%BA%E5%9D%97%E9%93%BE>区块链</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95>数据结构与算法</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E7%94%9F%E6%B4%BB%E6%8A%80%E8%83%BD>生活技能</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/go%E5%AE%9E%E6%88%98>Go实战</a></li></ul></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class=post-toc><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#1-u-boot的编译>1. u-boot的编译</a><ul><li><a href=#11-下载源码>1.1 下载源码</a></li><li><a href=#12-分支切换>1.2 分支切换</a></li><li><a href=#13-安装依赖>1.3 安装依赖</a></li><li><a href=#14-开始编译>1.4 开始编译</a></li></ul></li><li><a href=#2-linux内核编译>2. Linux内核编译</a><ul><li><a href=#21-源码下载>2.1 源码下载</a></li><li><a href=#22-安装压缩工具lzop>2.2 安装压缩工具lzop</a></li><li><a href=#23-编译>2.3 编译</a></li></ul></li><li><a href=#3-debian-根文件系统的制作与配置>3. Debian 根文件系统的制作与配置</a><ul><li><a href=#31-基本说明>3.1 基本说明</a></li><li><a href=#32-工具软件安装>3.2 工具软件安装</a></li><li><a href=#33-根文件系统制作>3.3 根文件系统制作</a></li><li><a href=#34-qemu-配置>3.4 QEMU 配置</a></li></ul></li><li><a href=#4-新系统配置>4. 新系统配置</a></li><li><a href=#5-烧录工作>5. 烧录工作</a><ul><li><a href=#51-设置sd卡>5.1 设置SD卡</a></li><li><a href=#52-烧录>5.2 烧录</a></li></ul></li><li><a href=#6-开发板设置>6. 开发板设置</a></li><li><a href=#7-使用界面>7. 使用界面</a></li><li><a href=#8-参考>8. 参考</a></li></ul></nav></div></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=copyright><span class=copyright-year>&copy; 2018 - 2022</span>
<span class=with-love><i class="fa fa-heart"></i></span><span class=copyright-author>书藏的博客</span></div><div class=powered-info><span class=powered-by>Powered by - <a class=powered-link href=//gohugo.io target=_blank title=hugo>Hugo v0.63.2</a></span>
<span class=separator-line>/</span>
<span class=theme-info>Theme by - <a class=powered-link href=//github.com/elkan1788/hugo-theme-next target=_blank>NexT</a></span></div><div class=vistor-info><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><span class=site-uv><i class="fa fa-user"></i><span class=busuanzi-value id=busuanzi_value_site_uv></span></span><span class=separator-line>/</span>
<span class=site-pv><i class="fa fa-eye"></i><span class=busuanzi-value id=busuanzi_value_site_pv></span></span></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i><span id=scrollpercent><span>0</span>%</span></div></div><script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/2.1.4/jquery.min.js></script><script type=text/javascript src=/js/search.js></script><script type=text/javascript src=/js/affix.js></script><script type=text/javascript src=/js/scrollspy.js></script><script type=text/javascript>function detectIE(){var ua=window.navigator.userAgent;var msie=ua.indexOf('MSIE ');var trident=ua.indexOf('Trident/');var edge=ua.indexOf('Edge/');if(msie>0||trident>0||edge>0){return-1;}
return 1;}
function getCntViewHeight(){var docHeight=$('#content').height(),winHeight=$(window).height(),cntViewHeight=(docHeight>winHeight)?(docHeight-winHeight):($(document).height()-winHeight);return cntViewHeight;}
function getScrollbarWidth(){var $div=$('<div />').addClass('scrollbar-measure').prependTo('body');var div=$div[0];var scrollbarWidth=div.offsetWidth-div.clientWidth;$div.remove();return scrollbarWidth;}
function registerBackTop(){var THRESHOLD=50;var $top=$('.back-to-top');$(window).on('scroll',function(){$top.toggleClass('back-to-top-on',window.pageYOffset>THRESHOLD);var scrollTop=$(window).scrollTop();var cntViewHeight=getCntViewHeight();var scrollPercent=(scrollTop)/(cntViewHeight);var scrollPercentRounded=Math.round(scrollPercent*100);var scrollPercentMaxed=(scrollPercentRounded>100)?100:scrollPercentRounded;$('#scrollpercent>span').html(scrollPercentMaxed);});$top.on('click',function(){$("html,body").animate({scrollTop:0,screenLeft:0,},800);});}
function initScrollSpy(){var tocSelector='.post-toc';var $tocElement=$(tocSelector);var activeCurrentSelector='.active-current';$tocElement.on('activate.bs.scrollspy',function(){var $currentActiveElement=$(tocSelector+' .active').last();removeCurrentActiveClass();$currentActiveElement.addClass('active-current');}).on('clear.bs.scrollspy',removeCurrentActiveClass);$('body').scrollspy({target:tocSelector});function removeCurrentActiveClass(){$(tocSelector+' '+activeCurrentSelector).removeClass(activeCurrentSelector.substring(1));}}
function initAffix(){var headerHeight=$('.header-inner').height();var footerOffset=parseInt($('.main').css('padding-bottom'),10);var sidebarTop=headerHeight+10;$('.sidebar-inner').affix({offset:{top:sidebarTop,bottom:footerOffset}});$(document).on('affixed.bs.affix',function(){updateTOCHeight(document.body.clientHeight-100);});}
function initTOCDimension(){var updateTOCHeightTimer;$(window).on('resize',function(){updateTOCHeightTimer&&clearTimeout(updateTOCHeightTimer);updateTOCHeightTimer=setTimeout(function(){var tocWrapperHeight=document.body.clientHeight-100;updateTOCHeight(tocWrapperHeight);},0);});updateTOCHeight(document.body.clientHeight-100);var scrollbarWidth=getScrollbarWidth();$('.post-toc').css('width','calc(100% + '+scrollbarWidth+'px)');}
function updateTOCHeight(height){height=height||'auto';$('.post-toc').css('max-height',height);}
$(function(){var sidebarTop=$('.header-inner').height()+10;$('#sidebar').css({'margin-top':sidebarTop}).show();var sidebarMt=parseInt($('#sidebar').css('margin-top'));var sidebarInHeight=parseInt($('.sidebar-inner').css('height'));var sideHeight=sidebarMt+sidebarInHeight;var contentHeight=$('.content-wrap').height();if(contentHeight<sideHeight){$('.content-wrap').css('min-height',sideHeight);}
$('.site-nav-toggle').on('click',function(){var $siteNav=$('.site-nav');var $toggleLine=$('.toggle');var ON_CLASS_NAME='site-nav-on';var CLOSE_CLASS_NAME='toggle-close';var isSiteNavOn=$siteNav.hasClass(ON_CLASS_NAME);var animateAction=isSiteNavOn?'slideUp':'slideDown';var animateCallback=isSiteNavOn?'removeClass':'addClass';$siteNav.stop()[animateAction]('normal',function(){$siteNav[animateCallback](ON_CLASS_NAME);$toggleLine[animateCallback](CLOSE_CLASS_NAME);});});registerBackTop();initScrollSpy();initAffix();initTOCDimension();$('.sidebar-nav-toc').click(function(){$(this).addClass('sidebar-nav-active');$(this).next().removeClass('sidebar-nav-active');$('.'+$(this).next().attr('data-target')).toggle(500);$('.'+$(this).attr('data-target')).toggle(500);});$('.sidebar-nav-overview').click(function(){$(this).addClass('sidebar-nav-active');$(this).prev().removeClass('sidebar-nav-active');$('.'+$(this).prev().attr('data-target')).toggle(500);$('.'+$(this).attr('data-target')).toggle(500);});});</script><script src=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.js></script><script type=text/javascript>$(function(){$('.post-body').viewer();});</script><script type=text/javascript>$(function(){if(detectIE()>0){$.getScript(document.location.protocol+'//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js',function(){new Waline({el:'#wcomments',visitor:true,avatar:'wavatar',avatarCDN:'https://sdn.geekzu.org/avatar/',avatarForce:!1,wordLimit:'200',placeholder:' 欢迎留下您的宝贵建议，请填写您的昵称和邮箱便于后续交流. ^_^ ',requiredFields:['nick','mail'],serverURL:"Your WalineSerURL",lang:"zh-cn"});});}else{$('#wcomments').html('抱歉，Waline插件不支持IE或Edge，建议使用Chrome浏览器。');}});</script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=Your%20AddthisId"></script><script>(function(){var bp=document.createElement('script');var curProtocol=window.location.protocol.split(':')[0];if(curProtocol==='https'){bp.src='https://zz.bdstatic.com/linksubmit/push.js';}
else{bp.src='http://push.zhanzhang.baidu.com/push.js';}
var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script></body></html>