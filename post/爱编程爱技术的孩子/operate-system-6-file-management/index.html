<!doctype html><html lang=zh-cn dir=content/zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=content-security-policy content="upgrade-insecure-requests"><title>操作系统6-文件管理 - 书藏的博客</title><meta name=keywords content="博客,程序员,区块链，思考,读书,笔记,生活,电影,旅游,"><meta name=author content="书藏"><meta property="og:title" content="操作系统6-文件管理"><meta property="og:site_name" content="书藏的博客"><meta property="og:image" content="/img/author.jpg"><meta name=title content="操作系统6-文件管理 - 书藏的博客"><meta name=description content="书藏的个人博客，记录学习的东西，以月刊记录生活"><link rel="shortcut icon" href=/img/favicon.ico><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=/img/apple-touch-icon.png><link href=//cdn.bootcdn.net/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css rel=stylesheet type=text/css><link href=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.css rel=stylesheet><link href=/css/main.css rel=stylesheet type=text/css><link href=/css/syntax.css rel=stylesheet type=text/css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-209130979-1"></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-209130979-1 ');</script></head><body itemscope itemtype=http://schema.org/WebPage lang=zh-hans><div class="container one-collumn sidebar-position-left page-home"><div class=headband></div><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle role=button style=opacity:1;top:0><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><div class=multi-lang-switch><i class="fa fa-fw fa-language" style=margin-right:5px></i><a class=lang-link id=zh-cn href=#>中文</a></div><div class=custom-logo-site-title><a href=/ class=brand rel=start><span class=logo-line-before><i></i></span><span class=site-title>书藏的博客</span>
<span class=logo-line-after><i></i></span></a></div><p class=site-subtitle>凡心所向，素履以往</p></div><div class=site-nav-right><div class="toggle popup-trigger" style=opacity:1;top:0><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul id=menu class=menu><li class=menu-item><a href=/ rel=section><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class=menu-item><a href=/post rel=section><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class=menu-item><a href=/about.html rel=section><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于我</a></li><li class=menu-item><a href=/404.html rel=section><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益404</a></li><li class="menu-item menu-item-search"><a href=javascript:; class=popup-trigger><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class=site-search><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class=search-icon><i class="fa fa-search"></i></span><span class=popup-btn-close><i class="fa fa-times-circle"></i></span><div class=local-search-input-wrapper><input autocomplete=off placeholder=搜索关键字... spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off></div></div><div id=local-search-result></div></div></div></nav></div></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><section id=posts class=posts-expand><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline"><a class=post-title-link href=https://shuzang.github.io/post/%E7%88%B1%E7%BC%96%E7%A8%8B%E7%88%B1%E6%8A%80%E6%9C%AF%E7%9A%84%E5%AD%A9%E5%AD%90/operate-system-6-file-management/ itemprop=url>操作系统6-文件管理</a></h1><div class=post-meta><span class=post-time><i class="fa fa-calendar-o fa-fw"></i><span class=post-meta-item-text>时间：</span>
<time itemprop=dateCreated datetime=2016-03-22T13:04:35+08:00 content="2020-08-18">2020-08-18</time></span>
<span class=post-category>&nbsp; | &nbsp;
<i class="fa fa-folder-o fa-fw"></i><span class=post-meta-item-text>分类：</span>
<span itemprop=about itemscope itemtype=https://schema.org/Thing><a href=/categories/%E7%88%B1%E7%BC%96%E7%A8%8B%E7%88%B1%E6%8A%80%E6%9C%AF%E7%9A%84%E5%AD%A9%E5%AD%90 itemprop=url rel=index style=text-decoration:underline><span itemprop=name>爱编程爱技术的孩子</span></a>
&nbsp;</span></span>
<span>|
<i class="fa fa-file-word-o fa-fw"></i><span class=post-meta-item-text>字数：</span>
<span class=leancloud-world-count>4174 字</span></span>
<span>|
<i class="fa fa-eye fa-fw"></i><span class=post-meta-item-text>阅读：</span>
<span class=leancloud-view-count>9分钟</span></span>
<span id=/post/%E7%88%B1%E7%BC%96%E7%A8%8B%E7%88%B1%E6%8A%80%E6%9C%AF%E7%9A%84%E5%AD%A9%E5%AD%90/operate-system-6-file-management/ class=leancloud_visitors data-flag-title=操作系统6-文件管理>|
<i class="fa fa-binoculars fa-fw"></i><span class=post-meta-item-text>阅读次数：</span>
<span class=leancloud-visitors-count></span></span></div></header><div class=post-body itemprop=articleBody><p>本篇介绍文件管理相关的内容。包括硬盘结构、文件和目录的概念，以及一个文件系统涉及的其它知识。</p><h2 id=1-硬盘结构>1. 硬盘结构</h2><p>硬盘是计算机最主要的外部存储设备，尽管常见的存储设备还有光盘、U盘等，但最常用的还是硬盘。目前，我们所见的硬盘主要有机械硬盘和固态硬盘两类，前者使用磁性盘片来存储数据，后者使用闪存颗粒存储数据。</p><p>机械硬盘主要的组成包括磁盘片、主轴、磁盘臂、磁头等。如下图所示，硬盘中有大量的磁盘片，所有的盘片通过主轴连接在一起，主轴连接到一个电机，以恒定的速率旋转。每个磁盘片有两面，数据在这两面上持久存储，通过磁头可以读取表面的数据。磁盘转动时，磁头所走过的路径会形成一个圆形，叫做磁道，每个磁盘片都有数百上千的磁道，另外，人们把所有磁盘片的相同磁道称作一个柱面。最后，为了便于读写，人们还将每个磁盘片划分为一些相等大小的扇区，一个扇区 512 字节。不过，操作系统读取硬盘的时候，不会一个个扇区地读取，这样效率太低，而是一次性连续读取多个扇区，即一次性读取一个"块&rdquo;（block）。这种由多个扇区组成的"块&rdquo;，是文件存取的最小单位。&ldquo;块"的大小，最常见的是4KB，即连续八个 sector组成一个 block。</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20200818_1597710757496.jpg alt></p><p>固态硬盘不再使用盘片，而是使用某种存储芯片作为存储介质，基本原理是对电荷的存储。固态硬盘在大部分方面都比机械硬盘表现好。固态硬盘已经没有了磁道、柱面等概念，物理单位是一个个的闪存颗粒，每个闪存颗粒由成千上万大小相同的块（Block）组成，块的大小一般为数百 KB 到数 MB，每一个块的内部又分为若干个大小相同的页（Page），页的大小一般为 4KB 或者 8KB。页是基本的读写单位，块是数据擦除的基本单位。</p><p>更大关于固态硬盘的知识可以参考 <a href=https://zhuanlan.zhihu.com/p/114237145>知乎，详解固态硬盘的有趣知识及其底层原理</a></p><h2 id=2-文件与inode>2. 文件与inode</h2><p>可参考：<a href=http://www.ruanyifeng.com/blog/2011/12/inode.html>阮一峰，理解inode</a></p><p>文件（file）是一个抽象的概念，最底层就是一串二进制0和1，高一点可以看作一个字节序列，其中每个字节都可以读取或写入。在更高一点的层次，我们用一个叫做 inode 的结构记录关于文件的一些元信息，这个结构的定义可以举个例子</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#a2f;font-weight:700>struct</span> stat {
    dev_t st_dev;         <span style=color:#080;font-style:italic>// ID of device containing file
</span><span style=color:#080;font-style:italic></span>    ino_t st_ino;         <span style=color:#080;font-style:italic>// inode number
</span><span style=color:#080;font-style:italic></span>    mode_t st_mode;       <span style=color:#080;font-style:italic>// protection
</span><span style=color:#080;font-style:italic></span>    nlink_t st_nlink;     <span style=color:#080;font-style:italic>// number of hard links
</span><span style=color:#080;font-style:italic></span>    uid_t st_uid;         <span style=color:#080;font-style:italic>// user ID of owner
</span><span style=color:#080;font-style:italic></span>    gid_t st_gid;         <span style=color:#080;font-style:italic>// group ID of owner
</span><span style=color:#080;font-style:italic></span>    dev_t st_rdev;        <span style=color:#080;font-style:italic>// device ID(if special file)
</span><span style=color:#080;font-style:italic></span>    off_t st_size;        <span style=color:#080;font-style:italic>// total size, in bytes
</span><span style=color:#080;font-style:italic></span>    blksize_t st_blksize; <span style=color:#080;font-style:italic>// blocksize for filesystem I/O
</span><span style=color:#080;font-style:italic></span>    blkcnt_t st_blocks;   <span style=color:#080;font-style:italic>// number of blocks allocated
</span><span style=color:#080;font-style:italic></span>    time_t st_atime;      <span style=color:#080;font-style:italic>// time of last access
</span><span style=color:#080;font-style:italic></span>    time_t st_mtime;      <span style=color:#080;font-style:italic>// time of last modification
</span><span style=color:#080;font-style:italic></span>    time_t st_ctime;      <span style=color:#080;font-style:italic>// time of last status change
</span><span style=color:#080;font-style:italic></span>};
</code></pre></div><p>我们可以看到主要包含的内容有：inode 号、保护信息（即文件权限）、链接数、文件拥有者的用户 ID 和所在的组 ID、文件总字节数、I/O 读取的单个 Block 大小、底层数据块的位置、实际信息等。</p><p>使用 <code>stat</code> 命令可以读取到这些信息</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ stat foo
  文件：foo
  大小：6         	块：8          IO 块：4096   普通文件
设备：805h/2053d	Inode：5767595     硬链接：1
权限：<span style=color:#666>(</span>0664/-rw-rw-r--<span style=color:#666>)</span>  Uid：<span style=color:#666>(</span> 1000/ shuzang<span style=color:#666>)</span>   Gid：<span style=color:#666>(</span> 1000/ shuzang<span style=color:#666>)</span>
最近访问：2020-08-22 19:00:39.660722364 -0700
最近更改：2020-08-22 19:00:29.121819131 -0700
最近改动：2020-08-22 19:00:29.121819131 -0700
创建时间：-
</code></pre></div><p>注意，inode 对底层数据块的引用一般是通过指针完成的，每个指针指向一个磁盘块，为了包含更多的数据，指针可以指向另一个完全由指针组成的块，使用间接指针的方式扩大包含的数据量。通常来讲，inode 中会设置一定数量的直接指针和一个间接指针。</p><h3 id=21-inode大小>2.1 inode大小</h3><p>inode 本身的存储也占据硬盘空间，所以硬盘至少会有两个区：数据区存放文件数据，inode 区存放所有 inode。不过我们习惯将存放 inode 的区域称作 inode 表。</p><p>由于 inode 的内容不多且比较固定，所以其大小也是固定的， 一般是128字节或256字节。</p><p>使用 <code>df</code> 命令可以查看每个硬盘分区的 inode 总数和使用情况</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ df -i
文件系统         Inode 已用<span style=color:#666>(</span>I<span style=color:#666>)</span> 可用<span style=color:#666>(</span>I<span style=color:#666>)</span> 已用<span style=color:#666>(</span>I<span style=color:#666>)</span>% 挂载点
udev            <span style=color:#666>493235</span>     <span style=color:#666>477</span>  <span style=color:#666>492758</span>       1% /dev
tmpfs           <span style=color:#666>500276</span>     <span style=color:#666>938</span>  <span style=color:#666>499338</span>       1% /run
/dev/sda5      <span style=color:#666>6520832</span>  <span style=color:#666>233720</span> <span style=color:#666>6287112</span>       4% /
tmpfs           <span style=color:#666>500276</span>       <span style=color:#666>1</span>  <span style=color:#666>500275</span>       1% /dev/shm
tmpfs           <span style=color:#666>500276</span>       <span style=color:#666>5</span>  <span style=color:#666>500271</span>       1% /run/lock
tmpfs           <span style=color:#666>500276</span>      <span style=color:#666>18</span>  <span style=color:#666>500258</span>       1% /sys/fs/cgroup
/dev/loop0        <span style=color:#666>4338</span>    <span style=color:#666>4338</span>       <span style=color:#666>0</span>     100% /snap/code/39
/dev/loop2       <span style=color:#666>12796</span>   <span style=color:#666>12796</span>       <span style=color:#666>0</span>     100% /snap/core/9804
/dev/loop3       <span style=color:#666>10775</span>   <span style=color:#666>10775</span>       <span style=color:#666>0</span>     100% /snap/core18/1885
/dev/loop5       <span style=color:#666>10756</span>   <span style=color:#666>10756</span>       <span style=color:#666>0</span>     100% /snap/core18/1880
/dev/loop1       <span style=color:#666>12862</span>   <span style=color:#666>12862</span>       <span style=color:#666>0</span>     100% /snap/core/9665
/dev/loop4       <span style=color:#666>24339</span>   <span style=color:#666>24339</span>       <span style=color:#666>0</span>     100% /snap/gnome-3-34-1804/33
/dev/loop6       <span style=color:#666>24339</span>   <span style=color:#666>24339</span>       <span style=color:#666>0</span>     100% /snap/gnome-3-34-1804/36
/dev/loop8       <span style=color:#666>10206</span>   <span style=color:#666>10206</span>       <span style=color:#666>0</span>     100% /snap/go/6123
/dev/loop12        <span style=color:#666>463</span>     <span style=color:#666>463</span>       <span style=color:#666>0</span>     100% /snap/snapd/8542
/dev/loop9       <span style=color:#666>62342</span>   <span style=color:#666>62342</span>       <span style=color:#666>0</span>     100% /snap/gtk-common-themes/1506
/dev/loop11      <span style=color:#666>15827</span>   <span style=color:#666>15827</span>       <span style=color:#666>0</span>     100% /snap/snap-store/467
/dev/loop13        <span style=color:#666>465</span>     <span style=color:#666>465</span>       <span style=color:#666>0</span>     100% /snap/snapd/8790
/dev/loop10      <span style=color:#666>15827</span>   <span style=color:#666>15827</span>       <span style=color:#666>0</span>     100% /snap/snap-store/433
/dev/sda1            <span style=color:#666>0</span>       <span style=color:#666>0</span>       <span style=color:#666>0</span>        - /boot/efi
tmpfs           <span style=color:#666>500276</span>      <span style=color:#666>89</span>  <span style=color:#666>500187</span>       1% /run/user/1000
/dev/loop14       <span style=color:#666>4303</span>    <span style=color:#666>4303</span>       <span style=color:#666>0</span>     100% /snap/code/40
/dev/loop15      <span style=color:#666>10206</span>   <span style=color:#666>10206</span>       <span style=color:#666>0</span>     100% /snap/go/6274
</code></pre></div><h3 id=22-inode号>2.2 inode号</h3><p>每个 inode 都有一个 inode 号，它被操作系统用来识别文件。</p><p>我们应该清除的是，文件名只是为了方便用户使用，操作系统对文件的操作本质是通过 inode。举个例子，当我们打开文件的时候，系统首先通过文件名找到 inode 号，然后通过 inode 号获取 inode 信息，最后根据 inode 信息找到文件数据所在的 block，读取数据。</p><p>通过 inode 号找 inode 的例子如下图，假设 inode 表大小为 20KB，由 80 个 inode 组成，inode 区域从 12KB 开始（即超级块从 0KB 开始，inode 位示图在 4KB 位置，数据位示图在 8KB位置）。要读取 inode 号 32，文件系统首先计算 inode 区域偏移量（32×inode大小，即 8192），将它加上磁盘 inode 表的起始地址（12KB），从而得到希望的 inode 块的正确字节地址：20KB。</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20200818_epub_30179184_249.jfif alt></p><p>使用 <code>ls -i</code> 命令可以查看文件名对应的 inode 号</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ls -i foo
<span style=color:#666>5767595</span> foo
</code></pre></div><h2 id=3-目录>3. 目录</h2><p>目录也是一种文件，但它的内容比较具体，存储的是它所包含的文件的文件名和对应的 inode 号。该内容用抽象数据结构来表达如下</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#a2f;font-weight:700>struct</span> dirent {
    <span style=color:#0b0;font-weight:700>char</span> d_name[<span style=color:#666>256</span>];     <span style=color:#080;font-style:italic>// filename
</span><span style=color:#080;font-style:italic></span>    ino_t d_ino;          <span style=color:#080;font-style:italic>// inode number
</span><span style=color:#080;font-style:italic></span>    off_t d_off;          <span style=color:#080;font-style:italic>// offset to the next dirent
</span><span style=color:#080;font-style:italic></span>    <span style=color:#0b0;font-weight:700>unsigned</span> <span style=color:#0b0;font-weight:700>short</span> d_reclen;    <span style=color:#080;font-style:italic>// length of this record
</span><span style=color:#080;font-style:italic></span>    <span style=color:#0b0;font-weight:700>unsigned</span> <span style=color:#0b0;font-weight:700>char</span> d_type;       <span style=color:#080;font-style:italic>// type of file
</span><span style=color:#080;font-style:italic></span>}
</code></pre></div><p>举个例子，foo 文件的 inode 号为 10，则目录的内容中会有一条 （foo, 10） 的记录。但我们要记得，目录也是一个文件，因此目录也有自己的 inode。</p><p>注1：目录的层次结构从根目录（/）开始，由根文件系统产生。</p><p>注2：移动文件或重命名文件，只是改变文件名，不改变 inode 号。</p><p>注3：通常来说，系统无法从inode号码得知文件名</p><h2 id=4-软链接和硬链接>4. 软链接和硬链接</h2><h3 id=41-硬链接>4.1 硬链接</h3><p>一般情况下，文件名和 inode 号之间是一一对应的关系，但我们可以令多个文件名指向同一个 inode 号。这种情况就叫<strong>硬链接</strong>。硬链接的本质是增加了一个对应关系，没有改变 inode 和底层数据，这意味着我们使用不同的文件名访问到的是同一个文件，修改和删除数据也会影响到所有文件名。</p><p>Linux 中使用 <code>ln</code> 命令建立硬链接。</p><p>inode 结构中有一项叫做链接数，每建立一个硬链接，该值就会加一，反过来，删除一个文件名，该值就会减一，只有减到零的情况下，系统才会回收该 inode 号和对应的数据。</p><p>系统创建目录时，默认会生成两个目录项：".&ldquo;和&rdquo;.."。前者的inode号码就是当前目录的inode号码，等同于当前目录的"硬链接&rdquo;；后者的inode号码就是当前目录的父目录的inode号码，等同于父目录的"硬链接&rdquo;。所以，任何一个目录的"硬链接"总数，总是等于2加上它的子目录总数（含隐藏目录）。</p><p>硬链接的缺点是不能创建目录的硬链接，也不能链接到其它文件系统。</p><h3 id=42-软链接>4.2 软链接</h3><p>软链接，也叫符号链接，软链接可以为目录创建，也可以链接到其它文件系统。因为软链接的实质类似于指针，加上存在文件 B，为 B 建立软链接 A，实际上是建立了一个新的文件，A 有自己的 inode，只不过 A 的内容是 B 的路径。当我们访问 A 时，会自动导向文件 B。</p><p>因此，软链接 A 是依赖于 B 存在的，如果删除了文件 B，打开文件 A 就会提示指向的文件或目录不存在。</p><p>使用 <code>ln -s</code> 命令创建软链接。</p><h2 id=5-文件系统实例>5. 文件系统实例</h2><p>文件系统是操作系统中与管理文件有关的软件和数据，负责文件的建立、删除、读写、修改、复制以及按名存取和存取控制。</p><p>我们假设磁盘的基本读写单位是 4KB，每 4KB 为一块，一个磁盘可以分为若干块（假设为 N），这些块的地址从 0 到 N-1，下面的介绍以一个只有 64 块的磁盘为例。</p><h3 id=51-基本结构>5.1 基本结构</h3><p>首先，磁盘中主要存放的一定是 <strong>用户数据</strong>，我们将存放用户数据的磁盘区域称为数据区域，假设将 64 个块的最后 56 个专门留给它们。</p><p>此外，文件系统还必须记录每个文件的基本信息，就是 inode，所有的 inode 存放在一个统一的区域，叫做 <strong>inode 表</strong>。由于 inode 大概 128 或 256 字节，所以不需要预留很大的空间，一个 4KB 的块就可以存放 16 个 inode，这里我们在 64 个块中留了 5 个块来存放 inode。</p><p>然后，我们还需要一个结构来记录 inode 和数据块空闲还是已分配。可选的方法很多，比如空闲块链表，将所有的空闲块链接在一起，当需要空闲块时从链头开始摘取并修改头指针，回收空闲块时插入链表尾。但通常使用的是一种简单有效的结构：<strong>位示图</strong>（inode）。位示图的原理是划分一部分空间，将每个比特位对应一个块，如果该位为0，说明对应的块空闲，如果该位为 1，说明对应的块已分配。数据区域和 inode 表通常使用不同的位示图。</p><p>最后还有一个结构叫做 <strong>超级块</strong>，包含文件系统的基本信息，比如有多少个 inode 和数据块、inode 表的起始位置、文件系统的类型等。</p><p>所以基本的结构有五部分，如下图：超级块、inode 位示图、数据区域位示图、inode表、数据区域。</p><p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20200818_epub_30179184_248.jfif alt></p><p>可以通过 <code>df</code> 命令查看文件系统，然后使用 <code>sudo dumpe2fs /dev/dsa*</code> 查看超级块的信息</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>shuzang@ubuntu:~$ df
文件系统           1K-块     已用     可用 已用% 挂载点
udev             <span style=color:#666>1972940</span>        <span style=color:#666>0</span>  <span style=color:#666>1972940</span>    0% /dev
tmpfs             <span style=color:#666>400224</span>     <span style=color:#666>1892</span>   <span style=color:#666>398332</span>    1% /run
/dev/sda5      <span style=color:#666>102168536</span> <span style=color:#666>10744048</span> <span style=color:#666>86191592</span>   12% /
...

$ sudo dumpe2fs /dev/sda5
dumpe2fs 1.45.5 <span style=color:#666>(</span>07-Jan-2020<span style=color:#666>)</span>
Filesystem volume name:   &lt;none&gt;
Last mounted on:          /
Filesystem UUID:          45e4318b-0433-4e09-a0ea-48e29ac60801
Filesystem magic number:  0xEF53
Filesystem revision <span style=color:#080;font-style:italic>#:    1 (dynamic)</span>
Filesystem features:      has_journal ext_attr resize_inode dir_index filetype needs_recovery extent 64bit flex_bg sparse_super large_file huge_file dir_nlink extra_isize metadata_csum
Filesystem flags:         signed_directory_hash 
Default mount options:    user_xattr acl
Filesystem state:         clean
Errors behavior:          Continue
Filesystem OS type:       Linux
Inode count:              <span style=color:#666>6520832</span>
Block count:              <span style=color:#666>26082560</span>
Reserved block count:     <span style=color:#666>1304128</span>
Free blocks:              <span style=color:#666>22924783</span>
Free inodes:              <span style=color:#666>6286837</span>
First block:              <span style=color:#666>0</span>
Block size:               <span style=color:#666>4096</span>
Fragment size:            <span style=color:#666>4096</span>
Group descriptor size:    <span style=color:#666>64</span>
Reserved GDT blocks:      <span style=color:#666>1024</span>
Blocks per group:         <span style=color:#666>32768</span>
Fragments per group:      <span style=color:#666>32768</span>
Inodes per group:         <span style=color:#666>8192</span>
Inode blocks per group:   <span style=color:#666>512</span>
Flex block group size:    <span style=color:#666>16</span>
Filesystem created:       Tue May <span style=color:#666>19</span> 03:52:48 <span style=color:#666>2020</span>
Last mount time:          Fri Aug <span style=color:#666>21</span> 01:35:42 <span style=color:#666>2020</span>
Last write time:          Fri Aug <span style=color:#666>21</span> 01:35:35 <span style=color:#666>2020</span>
Mount count:              <span style=color:#666>7</span>
Maximum mount count:      -1
Last checked:             Tue May <span style=color:#666>19</span> 03:52:48 <span style=color:#666>2020</span>
Check interval:           <span style=color:#666>0</span> <span style=color:#666>(</span>&lt;none&gt;<span style=color:#666>)</span>
Lifetime writes:          <span style=color:#666>26</span> GB
Reserved blocks uid:      <span style=color:#666>0</span> <span style=color:#666>(</span>user root<span style=color:#666>)</span>
Reserved blocks gid:      <span style=color:#666>0</span> <span style=color:#666>(</span>group root<span style=color:#666>)</span>
First inode:              <span style=color:#666>11</span>
Inode size:	          <span style=color:#666>256</span>
...
</code></pre></div><h3 id=52-挂载>5.2 挂载</h3><p>磁盘通常会划分为不同的分区，每个分区可能使用不同的文件系统，挂载就是将该文件系统粘贴到整个操作系统的文件目录树上，挂载的位置是一个路径，进入该路径就相当于进入了该文件系统。</p><h3 id=53-文件读取>5.3 文件读取</h3><p>已知文件名，读取文件的过程我们大致已经熟悉，即通过文件名获得 inode 号，通过 inode 号获得 inode 信息，通过 inode 信息读取数据。</p><p>但这里还不清楚的一点是如何通过文件名找到 inode。文件系统采取的方式是遍历路径名，所有的遍历都从文件系统的根开始，即 <code>/</code> 。文件系统第一次读取根目录的 inode，根目录的 inode 号是众所周知的，一般是 2，因此文件系统就会读入 inode 号为2的块。一旦读入 inode，文件系统就可以查找指向数据块的指针，数据块中包含了根目录的内容。根目录的内容中存放了所有子文件的文件名和 inode 号的对应，所以根据路径可以找到下一级目录或文件的 inode 号，如果是目录，就继续遵循上面的过程进行递归的读取，最后读取得到文件的数据。</p><p>最后要注意的是，简单的读取并不会对位示图进行改变，只有创建或删除文件数据时才会改变位示图的内容。</p></div><footer class=post-footer><div class=post-tags><a href=/tags/%e8%ae%a1%e7%ae%97%e6%9c%ba%e5%9f%ba%e7%a1%80 rel=tag title=计算机基础>#计算机基础#</a></div><div class=addthis_inline_share_toolbox></div><div class=post-nav><div class=article-copyright><div class=article-copyright-img><img src=/img/qq_qrcode.png width=129px height=129px><div style=text-align:center>QQ扫一扫交流</div></div><div class=article-copyright-info><p><span>声明：</span>操作系统6-文件管理</p><p><span>链接：</span>https://shuzang.github.io/post/%E7%88%B1%E7%BC%96%E7%A8%8B%E7%88%B1%E6%8A%80%E6%9C%AF%E7%9A%84%E5%AD%A9%E5%AD%90/operate-system-6-file-management/</p><p><span>作者：</span>书藏</p><p><span>声明： </span>本博客文章除特别声明外，均采用 <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank style=text-decoration:underline>CC BY-NC-SA 3.0</a>许可协议，转载请注明出处！</p></div></div><div class=clear></div></div><div class=reward-qr-info><div>创作实属不易，如有帮助，那就打赏博主些许茶钱吧 ^_^</div><button id=rewardButton disable=enable onclick="var qr=document.getElementById('QR');if(qr.style.display==='none'){qr.style.display='block';}else{qr.style.display='none'}">
<span>赏</span></button><div id=QR style=display:none><div id=wechat style=display:inline-block><img id=wechat_qr src=/img/wechat-pay.png alt="WeChat Pay"><p>微信打赏</p></div><div id=alipay style=display:inline-block><img id=alipay_qr src=/img/ali-pay.png alt=Alipay><p>支付宝打赏</p></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=https://shuzang.github.io/post/%E7%88%B1%E7%BC%96%E7%A8%8B%E7%88%B1%E6%8A%80%E6%9C%AF%E7%9A%84%E5%AD%A9%E5%AD%90/bash-script-grammer-1/ rel=next title=Bash脚本语法1><i class="fa fa-chevron-left"></i>Bash脚本语法1</a></div><div class="post-nav-prev post-nav-item"><a href=https://shuzang.github.io/post/%E7%88%B1%E7%BC%96%E7%A8%8B%E7%88%B1%E6%8A%80%E6%9C%AF%E7%9A%84%E5%AD%A9%E5%AD%90/operate-system-5-device-management/ rel=prev title=操作系统5-设备管理>操作系统5-设备管理
<i class="fa fa-chevron-right"></i></a></div></div><div id=wcomments></div></footer></article></section></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><section class="site-overview sidebar-panel sidebar-panel-active"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src=/images/avatar.png alt=书藏><p class=site-author-name itemprop=name>书藏</p><p class="site-description motion-element" itemprop=description></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=/post/><span class=site-state-item-count>334</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>7</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>23</span>
<span class=site-state-item-name>标签</span></a></div></nav><div class="links-of-author motion-element"><span class=links-of-author-item><a href=https://github.com/shuzang/ target=_blank title=GitHub><i class="fa fa-fw fa-github"></i>GitHub</a></span></div><div class="tagcloud-of-blogroll motion-element tagcloud-of-blogroll-inline"><div class=tagcloud-of-blogroll-title><i class="fa fa-fw fa-tags"></i>标签云</div><ul class=tagcloud-of-blogroll-list><li class=tagcloud-of-blogroll-item><a href=/tags/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0>论文笔记</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E4%B9%A6%E8%97%8F%E7%9A%84%E7%94%9F%E6%B4%BB%E5%91%A8%E5%88%8A>书藏的生活周刊</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E7%A7%91%E7%A0%94%E8%AE%B0%E5%BD%95>科研记录</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/go%E8%AF%AD%E6%B3%95>Go语法</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80>计算机基础</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E6%9D%82%E8%B0%88>杂谈</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E5%8C%BA%E5%9D%97%E9%93%BE>区块链</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95>数据结构与算法</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E7%94%9F%E6%B4%BB%E6%8A%80%E8%83%BD>生活技能</a></li><li class=tagcloud-of-blogroll-item><a href=/tags/go%E5%AE%9E%E6%88%98>Go实战</a></li></ul></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=copyright><span class=copyright-year>&copy; 2010 - 2022</span>
<span class=with-love><i class="fa fa-heart"></i></span><span class=copyright-author>书藏的博客</span></div><div class=powered-info><span class=powered-by>Powered by - <a class=powered-link href=//gohugo.io target=_blank title=hugo>Hugo v0.63.2</a></span>
<span class=separator-line>/</span>
<span class=theme-info>Theme by - <a class=powered-link href=//github.com/elkan1788/hugo-theme-next target=_blank>NexT</a></span></div><div class=vistor-info><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><span class=site-uv><i class="fa fa-user"></i><span class=busuanzi-value id=busuanzi_value_site_uv></span></span><span class=separator-line>/</span>
<span class=site-pv><i class="fa fa-eye"></i><span class=busuanzi-value id=busuanzi_value_site_pv></span></span></div><div class=license-info><span class=storage-info>Storage by
<a href=https://www.ucloud.cn/ style=font-weight:700 target=_blank>UCloud云存储</a></span>
<span class=separator-line>/</span>
<span class=license-num><a href target=_blank></a></span></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i><span id=scrollpercent><span>0</span>%</span></div></div><script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/2.1.4/jquery.min.js></script><script type=text/javascript src=/js/search.js></script><script type=text/javascript src=/js/affix.js></script><script type=text/javascript src=/js/scrollspy.js></script><script type=text/javascript>function detectIE(){var ua=window.navigator.userAgent;var msie=ua.indexOf('MSIE ');var trident=ua.indexOf('Trident/');var edge=ua.indexOf('Edge/');if(msie>0||trident>0||edge>0){return-1;}
return 1;}
function getCntViewHeight(){var docHeight=$('#content').height(),winHeight=$(window).height(),cntViewHeight=(docHeight>winHeight)?(docHeight-winHeight):($(document).height()-winHeight);return cntViewHeight;}
function getScrollbarWidth(){var $div=$('<div />').addClass('scrollbar-measure').prependTo('body');var div=$div[0];var scrollbarWidth=div.offsetWidth-div.clientWidth;$div.remove();return scrollbarWidth;}
function registerBackTop(){var THRESHOLD=50;var $top=$('.back-to-top');$(window).on('scroll',function(){$top.toggleClass('back-to-top-on',window.pageYOffset>THRESHOLD);var scrollTop=$(window).scrollTop();var cntViewHeight=getCntViewHeight();var scrollPercent=(scrollTop)/(cntViewHeight);var scrollPercentRounded=Math.round(scrollPercent*100);var scrollPercentMaxed=(scrollPercentRounded>100)?100:scrollPercentRounded;$('#scrollpercent>span').html(scrollPercentMaxed);});$top.on('click',function(){$("html,body").animate({scrollTop:0,screenLeft:0,},800);});}
function initScrollSpy(){var tocSelector='.post-toc';var $tocElement=$(tocSelector);var activeCurrentSelector='.active-current';$tocElement.on('activate.bs.scrollspy',function(){var $currentActiveElement=$(tocSelector+' .active').last();removeCurrentActiveClass();$currentActiveElement.addClass('active-current');}).on('clear.bs.scrollspy',removeCurrentActiveClass);$('body').scrollspy({target:tocSelector});function removeCurrentActiveClass(){$(tocSelector+' '+activeCurrentSelector).removeClass(activeCurrentSelector.substring(1));}}
function initAffix(){var headerHeight=$('.header-inner').height();var footerOffset=parseInt($('.main').css('padding-bottom'),10);var sidebarTop=headerHeight+10;$('.sidebar-inner').affix({offset:{top:sidebarTop,bottom:footerOffset}});$(document).on('affixed.bs.affix',function(){updateTOCHeight(document.body.clientHeight-100);});}
function initTOCDimension(){var updateTOCHeightTimer;$(window).on('resize',function(){updateTOCHeightTimer&&clearTimeout(updateTOCHeightTimer);updateTOCHeightTimer=setTimeout(function(){var tocWrapperHeight=document.body.clientHeight-100;updateTOCHeight(tocWrapperHeight);},0);});updateTOCHeight(document.body.clientHeight-100);var scrollbarWidth=getScrollbarWidth();$('.post-toc').css('width','calc(100% + '+scrollbarWidth+'px)');}
function updateTOCHeight(height){height=height||'auto';$('.post-toc').css('max-height',height);}
$(function(){var sidebarTop=$('.header-inner').height()+10;$('#sidebar').css({'margin-top':sidebarTop}).show();var sidebarMt=parseInt($('#sidebar').css('margin-top'));var sidebarInHeight=parseInt($('.sidebar-inner').css('height'));var sideHeight=sidebarMt+sidebarInHeight;var contentHeight=$('.content-wrap').height();if(contentHeight<sideHeight){$('.content-wrap').css('min-height',sideHeight);}
$('.site-nav-toggle').on('click',function(){var $siteNav=$('.site-nav');var $toggleLine=$('.toggle');var ON_CLASS_NAME='site-nav-on';var CLOSE_CLASS_NAME='toggle-close';var isSiteNavOn=$siteNav.hasClass(ON_CLASS_NAME);var animateAction=isSiteNavOn?'slideUp':'slideDown';var animateCallback=isSiteNavOn?'removeClass':'addClass';$siteNav.stop()[animateAction]('normal',function(){$siteNav[animateCallback](ON_CLASS_NAME);$toggleLine[animateCallback](CLOSE_CLASS_NAME);});});registerBackTop();initScrollSpy();initAffix();initTOCDimension();$('.sidebar-nav-toc').click(function(){$(this).addClass('sidebar-nav-active');$(this).next().removeClass('sidebar-nav-active');$('.'+$(this).next().attr('data-target')).toggle(500);$('.'+$(this).attr('data-target')).toggle(500);});$('.sidebar-nav-overview').click(function(){$(this).addClass('sidebar-nav-active');$(this).prev().removeClass('sidebar-nav-active');$('.'+$(this).prev().attr('data-target')).toggle(500);$('.'+$(this).attr('data-target')).toggle(500);});});</script><script src=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.js></script><script type=text/javascript>$(function(){$('.post-body').viewer();});</script><script type=text/javascript>$(function(){if(detectIE()>0){$.getScript(document.location.protocol+'//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js',function(){new Waline({el:'#wcomments',visitor:true,avatar:'wavatar',avatarCDN:'https://sdn.geekzu.org/avatar/',avatarForce:!1,wordLimit:'200',placeholder:' 欢迎留下您的宝贵建议，请填写您的昵称和邮箱便于后续交流. ^_^ ',requiredFields:['nick','mail'],serverURL:"Your WalineSerURL",lang:"zh-cn"});});}else{$('#wcomments').html('抱歉，Waline插件不支持IE或Edge，建议使用Chrome浏览器。');}});</script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=Your%20AddthisId"></script><script>(function(){var bp=document.createElement('script');var curProtocol=window.location.protocol.split(':')[0];if(curProtocol==='https'){bp.src='https://zz.bdstatic.com/linksubmit/push.js';}
else{bp.src='http://push.zhanzhang.baidu.com/push.js';}
var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script></body></html>